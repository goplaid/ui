(function(C,$){typeof exports=="object"&&typeof module<"u"?$(require("vue")):typeof define=="function"&&define.amd?define(["vue"],$):(C=typeof globalThis<"u"?globalThis:C||self,$(C.Vue))})(this,function(C){"use strict";if($===void 0)var $=void 0;if(B===void 0)var B=void 0;(function(){var x={settings:{},post:function(t){return new E("post",t)},get:function(t){return new E("get",t)},request:function(t,e){return new E(t,e)}},E=function(t,e){var i={method:t,url:"",before:function(){},success:function(){},error:function(){},data:!1,async:!0,headers:{}};this.p=this.extend(i,e),this.p=this.extend(this.p,x.settings),this.p.method=this.p.method.toUpperCase(),this.prepareData(),this.xhr=new XMLHttpRequest,this.xhr.open(this.p.method,this.p.url,this.p.async),this.setHeaders(),(typeof this.p.before!="function"||this.p.before(this.xhr))!==!1&&this.send()};E.prototype={extend:function(t,e){if(e)for(var i in e)t[i]=e[i];return t},prepareData:function(){["POST","PUT"].indexOf(this.p.method)===-1||this.isFormData()||(this.p.headers["Content-Type"]="application/x-www-form-urlencoded"),typeof this.p.data!="object"||this.isFormData()||(this.p.data=this.toParams(this.p.data)),this.p.method==="GET"&&(this.p.url=this.p.data?this.p.url+"?"+this.p.data:this.p.url)},setHeaders:function(){for(var t in this.xhr.setRequestHeader("X-Requested-With",this.p.headers["X-Requested-With"]||"XMLHttpRequest"),this.p.headers)this.xhr.setRequestHeader(t,this.p.headers[t])},isFormData:function(){return window.FormData!==void 0&&this.p.data instanceof window.FormData},isComplete:function(){return!(this.xhr.status<200||300<=this.xhr.status&&this.xhr.status!==304)},send:function(){this.p.async?(this.xhr.onload=this.loaded.bind(this),this.xhr.send(this.p.data)):(this.xhr.send(this.p.data),this.loaded.call(this))},loaded:function(){if(this.isComplete()){var t=this.parseResponse();typeof this.p.success=="function"&&this.p.success(t,this.xhr)}else t=this.parseResponse(),typeof this.p.error=="function"&&this.p.error(t,this.xhr,this.xhr.status)},parseResponse:function(){var t=this.xhr.response,e=this.parseJson(t);return e||t},parseJson:function(t){try{var e=JSON.parse(t);if(e&&typeof e=="object")return e}catch{}return!1},toParams:function(t){return Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&")}};function m(t,e){return this.parse(t,e)}var _=[0],F="data"+new Date().getTime(),k="is-hidden",y="is-hidden-mobile";m.ready=function(t){document.readyState!=="loading"?t():document.addEventListener("DOMContentLoaded",t)},m.prototype={get sdom(){return!0},get length(){return this.nodes.length},parse:function(t,e){var i;if(t){if(t.sdom)return this.nodes=t.nodes,t;i=typeof t!="string"?t.nodeType&&t.nodeType===11?t.childNodes:t.nodeType||t===window?[t]:t:/^\s*<(\w+|!)[^>]*>/.test(t)?this.create(t):this._query(t,e)}else i=[];this.nodes=this._slice(i)},create:function(t){if(/^<(\w+)\s*\/?>(?:<\/\1>|)$/.test(t))return[document.createElement(RegExp.$1)];var e=[],i=document.createElement("div"),s=i.childNodes;i.innerHTML=t;for(var n=0,o=s.length;n<o;n++)e.push(s[n]);return e},add:function(t){this.nodes=this.nodes.concat(this._toArray(t))},get:function(t){return this.nodes[t||0]||!1},getAll:function(){return this.nodes},eq:function(t){return new m(this.nodes[t])},first:function(){return new m(this.nodes[0])},last:function(){return new m(this.nodes[this.nodes.length-1])},contents:function(){return this.get().childNodes},each:function(t){for(var e=this.nodes.length,i=0;i<e;i++)t.call(this,this.nodes[i].sdom?this.nodes[i].get():this.nodes[i],i);return this},is:function(t){return 0<this.filter(t).length},filter:function(t){var e;return t===void 0?this:(e=typeof t=="function"?t:function(i){return t instanceof Node?t===i:t&&t.sdom?t.nodes.indexOf(i)!==-1:(i.matches=i.matches||i.msMatchesSelector||i.webkitMatchesSelector,i.nodeType===1&&i.matches(t||"*"))},new m(this.nodes.filter(e)))},not:function(t){return this.filter(function(e){return!new m(e).is(t||!0)})},find:function(t){var e=[];return this.each(function(i){for(var s=this._query(t||"*",i),n=0;n<s.length;n++)e.push(s[n])}),new m(e)},children:function(t){var e=[];return this.each(function(i){if(i.children)for(var s=i.children,n=0;n<s.length;n++)e.push(s[n])}),new m(e).filter(t)},parent:function(t){var e=[];return this.each(function(i){i.parentNode&&e.push(i.parentNode)}),new m(e).filter(t)},parents:function(t,e){e=this._getContext(e);var i=[];return this.each(function(s){for(var n=s.parentNode;n&&n!==e;)t?new m(n).is(t)&&i.push(n):i.push(n),n=n.parentNode}),new m(i)},closest:function(t,e){e=this._getContext(e),t=t.sdom?t.get():t;var i=[],s=t&&t.nodeType;return this.each(function(n){do if(s&&n===t||new m(n).is(t))return i.push(n);while((n=n.parentNode)&&n!==e)}),new m(i)},next:function(t){return this._getSibling(t,"nextSibling")},nextElement:function(t){return this._getSibling(t,"nextElementSibling")},prev:function(t){return this._getSibling(t,"previousSibling")},prevElement:function(t){return this._getSibling(t,"previousElementSibling")},css:function(t,e){if(e!==void 0||typeof t=="object")return this.each(function(s){var n={};for(var o in typeof t=="object"?n=t:n[t]=e,n)s.style&&(s.style[o]=n[o])});var i=this.get();return t==="width"||t==="height"?i.style?this._getHeightOrWidth(t,i,!1)+"px":void 0:i.style?getComputedStyle(i,null)[t]:void 0},attr:function(t,e,i){if(i=i?"data-":"",e!==void 0||typeof t=="object")return this.each(function(n){var o={};for(var a in typeof t=="object"?o=t:o[t]=e,o)n.nodeType!==3&&(a==="checked"?n.checked=o[a]:n.setAttribute(i+a,o[a]))});var s=this.get();return s&&s.nodeType!==3?t==="checked"?s.checked:this._getBooleanFromStr(s.getAttribute(i+t)):void 0},data:function(t,e){if(t!==void 0)return this.attr(t,e,!0);function i(c){return c[1].toUpperCase()}var s=/^data-(.+)$/,n=this.get().attributes,o={};for(var a in n)if(n[a]&&s.test(n[a].nodeName)){var l=n[a].nodeName.match(s)[1],h=n[a].value;l=l.replace(/-([a-z])/g,i),h=this._isObjectString(h)?this._toObject(h):this._isNumber(h)?parseFloat(h):this._getBooleanFromStr(h),o[l]=h}return o},val:function(t){if(t!==void 0)return this.each(function(i){i.value=t});var e=this.get();return e.type&&e.type==="checkbox"?e.checked:e.value},removeAttr:function(t){return this.each(function(e){t.split(" ").forEach(function(i){e.nodeType!==3&&e.removeAttribute(i)})})},removeData:function(t){return this.each(function(e){t.split(" ").forEach(function(i){e.nodeType!==3&&e.removeAttribute("data-"+i)})})},dataset:function(t,e){return this.each(function(i){_[this.dataindex(i)][t]=e})},dataget:function(t){return _[this.dataindex(this.get())][t]},dataindex:function(t){var e=t[F],i=_.length;return e||(e=t[F]=i,_[e]={}),e},addClass:function(t){return this._eachClass(t,"add")},removeClass:function(t){return this._eachClass(t,"remove")},toggleClass:function(t){return this._eachClass(t,"toggle")},hasClass:function(t){return this.nodes.some(function(e){return!!e.classList&&e.classList.contains(t)})},empty:function(){return this.each(function(t){t.innerHTML=""})},html:function(t){return t===void 0?this.get().innerHTML||"":this.empty().append(t)},text:function(t){return t===void 0?this.get().textContent||"":this.each(function(e){e.textContent=t})},after:function(t){return this._inject(t,function(e,i){if(typeof e=="string")i.insertAdjacentHTML("afterend",e);else if(i.parentNode!==null)for(var s=e instanceof Node?[e]:this._toArray(e).reverse(),n=0;n<s.length;n++)i.parentNode.insertBefore(s[n],i.nextSibling);return i})},before:function(t){return this._inject(t,function(e,i){if(typeof e=="string")i.insertAdjacentHTML("beforebegin",e);else for(var s=e instanceof Node?[e]:this._toArray(e),n=0;n<s.length;n++)i.parentNode.insertBefore(s[n],i);return i})},append:function(t){return this._inject(t,function(e,i){if(typeof e=="string"||typeof e=="number")i.insertAdjacentHTML("beforeend",e);else for(var s=e instanceof Node?[e]:this._toArray(e),n=0;n<s.length;n++)i.appendChild(s[n]);return i})},prepend:function(t){return this._inject(t,function(e,i){if(typeof e=="string"||typeof e=="number")i.insertAdjacentHTML("afterbegin",e);else for(var s=e instanceof Node?[e]:this._toArray(e).reverse(),n=0;n<s.length;n++)i.insertBefore(s[n],i.firstChild);return i})},wrap:function(t){return this._inject(t,function(e,i){var s=typeof e=="string"||typeof e=="number"?this.create(e)[0]:e instanceof Node?e:this._toArray(e)[0];return i.parentNode&&i.parentNode.insertBefore(s,i),s.appendChild(i),new m(s)})},unwrap:function(){return this.each(function(t){var e=new m(t);return e.replaceWith(e.contents())})},replaceWith:function(t){return this._inject(t,function(e,i){for(var s=document.createDocumentFragment(),n=typeof e=="string"||typeof e=="number"?this.create(e):e instanceof Node?[e]:this._toArray(e),o=0;o<n.length;o++)s.appendChild(n[o]);var a=s.childNodes[0];return i.parentNode&&i.parentNode.replaceChild(s,i),a})},remove:function(){return this.each(function(t){t.parentNode&&t.parentNode.removeChild(t)})},clone:function(t){var e=[];return this.each(function(i){var s=this._clone(i);t&&(s=this._cloneEvents(i,s)),e.push(s)}),new m(e)},show:function(){return this.each((function(t){if(t.style&&this._hasDisplayNone(t)){var e,i=t.getAttribute("domTargetShow"),s=!!t.classList&&t.classList.contains(k),n=!!t.classList&&t.classList.contains(y);s?(e=k,t.classList.remove(k)):n?(e=y,t.classList.remove(y)):t.style.display=i||"block",e&&t.setAttribute("domTargetHide",e),t.removeAttribute("domTargetShow")}}).bind(this))},hide:function(){return this.each(function(t){if(t.style&&!this._hasDisplayNone(t)){var e=t.style.display,i=t.getAttribute("domTargetHide");i===k?t.classList.add(k):i===y?t.classList.add(y):(e!=="block"&&t.setAttribute("domTargetShow",e),t.style.display="none"),t.removeAttribute("domTargetHide")}})},scrollTop:function(t){var e=this.get(),i=e===window,s=e.nodeType===9,n=s?document.scrollingElement||document.body.parentNode||document.body||document.documentElement:e;if(t===void 0)return s?window.pageYOffset!==void 0?window.pageYOffset:document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop?document.body.scrollTop:0:i?window.pageYOffset:n.scrollTop;i?window.scrollTo(0,t):n.scrollTop=t},offset:function(){return this._getDim("Offset")},position:function(){return this._getDim("Position")},width:function(t,e){return this._getSize("width","Width",t,e)},height:function(t,e){return this._getSize("height","Height",t,e)},outerWidth:function(){return this._getInnerOrOuter("width","outer")},outerHeight:function(){return this._getInnerOrOuter("height","outer")},innerWidth:function(){return this._getInnerOrOuter("width","inner")},innerHeight:function(){return this._getInnerOrOuter("height","inner")},click:function(){return this._triggerEvent("click")},focus:function(){return this._triggerEvent("focus")},trigger:function(t){return this.each(function(e){for(var i=t.split(" "),s=0;s<i.length;s++){var n;try{n=new window.CustomEvent(i[s],{bubbles:!0,cancelable:!0})}catch{(n=document.createEvent("CustomEvent")).initCustomEvent(i[s],!0,!0)}e.dispatchEvent(n)}})},on:function(t,e,i){return this.each(function(s){for(var n=t.split(" "),o=0;o<n.length;o++){var a=this._getEventName(n[o]),l=this._getEventNamespace(n[o]);e=i?this._getOneHandler(e,t):e,s.addEventListener(a,e),s._e=s._e||{},s._e[l]=s._e[l]||{},s._e[l][a]=s._e[l][a]||[],s._e[l][a].push(e)}})},one:function(t,e){return this.on(t,e,!0)},off:function(t,e){function i(a,l,h){return a===h}function s(a,l,h,c){return l===c}function n(a,l,h,c){return a===h&&l===c}function o(){return!0}return t===void 0?this.each(function(a){this._offEvent(a,!1,!1,e,o)}):this.each(function(a){for(var l=t.split(" "),h=0;h<l.length;h++){var c=this._getEventName(l[h]),d=this._getEventNamespace(l[h]);d==="_events"?this._offEvent(a,c,d,e,i):c||d==="_events"?this._offEvent(a,c,d,e,n):this._offEvent(a,c,d,e,s)}})},serialize:function(t){for(var e={},i=this.get().elements,s=0;s<i.length;s++){var n=i[s];if((!/(checkbox|radio)/.test(n.type)||n.checked)&&n.name&&!n.disabled&&n.type!=="file"){if(n.type==="select-multiple")for(var o=0;o<n.options.length;o++){var a=n.options[o];a.selected&&(e[n.name]=a.value)}e[n.name]=this._isNumber(n.value)?parseFloat(n.value):this._getBooleanFromStr(n.value)}}return t?e:this._toParams(e)},ajax:function(t,e){if(E!==void 0){var i=this.attr("method")||"post",s={url:this.attr("action"),data:this.serialize(),success:t,error:e};return new E(i,s)}},_queryContext:function(t,e){return(e=this._getContext(e)).nodeType!==3&&typeof e.querySelectorAll=="function"?e.querySelectorAll(t):[]},_query:function(t,e){if(e)return this._queryContext(t,e);if(/^[.#]?[\w-]*$/.test(t)){if(t[0]!=="#")return t[0]==="."?document.getElementsByClassName(t.slice(1)):document.getElementsByTagName(t);var i=document.getElementById(t.slice(1));return i?[i]:[]}return document.querySelectorAll(t)},_getContext:function(t){return(t=typeof t=="string"?document.querySelector(t):t)&&t.sdom?t.get():t||document},_inject:function(t,e){for(var i=this.nodes.length,s=[];i--;){var n=typeof t=="function"?t.call(this,this.nodes[i]):t,o=i===0?n:this._clone(n),a=e.call(this,o,this.nodes[i]);a&&(a.sdom?s.push(a.get()):s.push(a))}return new m(s)},_cloneEvents:function(t,e){var i=t._e;if(i)for(var s in(e._e=i)._events)for(var n=0;n<i._events[s].length;n++)e.addEventListener(s,i._events[s][n]);return e},_clone:function(t){if(t!==void 0)return typeof t=="string"?t:t instanceof Node||t.nodeType?t.cloneNode(!0):"length"in t?[].map.call(this._toArray(t),function(e){return e.cloneNode(!0)}):void 0},_slice:function(t){return t&&t.length!==0?t.length?[].slice.call(t.nodes||t):[t]:[]},_eachClass:function(t,e){return this.each(function(i){t&&t.split(" ").forEach(function(s){i.classList&&i.classList[e](s)})})},_triggerEvent:function(t){var e=this.get();return e&&e.nodeType!==3&&e[t](),this},_getOneHandler:function(t,e){var i=this;return function(){t.apply(this,arguments),i.off(e)}},_getEventNamespace:function(t){var e=t.split("."),i=e[1]?e[1]:"_events";return e[2]?i+e[2]:i},_getEventName:function(t){return t.split(".")[0]},_offEvent:function(t,e,i,s,n){for(var o in t._e)for(var a in t._e[o])if(n(a,o,e,i))for(var l=t._e[o][a],h=0;h<l.length;h++)s!==void 0&&l[h].toString()!==s.toString()||(t.removeEventListener(a,l[h]),t._e[o][a].splice(h,1),t._e[o][a].length===0&&delete t._e[o][a],Object.keys(t._e[o]).length===0&&delete t._e[o])},_getInnerOrOuter:function(t,e){return this[t](void 0,e)},_getDocSize:function(t,e){var i=t.body,s=t.documentElement;return Math.max(i["scroll"+e],i["offset"+e],s["client"+e],s["scroll"+e],s["offset"+e])},_getSize:function(t,e,i,s){if(i!==void 0)return this.each((function(o){i=parseFloat(i),i+=this._adjustResultHeightOrWidth(t,o,s||"normal"),new m(o).css(t,i+"px")}).bind(this));var n=this.get();return i=n.nodeType===3?0:n.nodeType===9?this._getDocSize(n,e):n===window?window["inner"+e]:this._getHeightOrWidth(t,n,s||"normal"),Math.round(i)},_getHeightOrWidth:function(t,e,i){if(!e)return 0;var s=t.charAt(0).toUpperCase()+t.slice(1),n=0,o=getComputedStyle(e,null),a=new m(e),l=a.parents().filter(function(d){return d.nodeType===1&&getComputedStyle(d,null).display==="none"&&d});if(o.display==="none"&&l.add(e),l.length!==0){var h="visibility: hidden !important; display: block !important;",c=[];l.each(function(d){var u=new m(d),p=u.attr("style");p!==null&&c.push(p),u.attr("style",p!==null?p+";"+h:h)}),n=a.get()["offset"+s]-this._adjustResultHeightOrWidth(t,e,i),l.each(function(d,u){var p=new m(d);c[u]===void 0?p.removeAttr("style"):p.attr("style",c[u])})}else n=e["offset"+s]-this._adjustResultHeightOrWidth(t,e,i);return n},_adjustResultHeightOrWidth:function(t,e,i){if(!e||i===!1)return 0;var s=0,n=getComputedStyle(e,null),o=n.boxSizing==="border-box";return t==="height"?((i==="inner"||i==="normal"&&o)&&(s+=(parseFloat(n.borderTopWidth)||0)+(parseFloat(n.borderBottomWidth)||0)),i==="outer"&&(s-=(parseFloat(n.marginTop)||0)+(parseFloat(n.marginBottom)||0))):((i==="inner"||i==="normal"&&o)&&(s+=(parseFloat(n.borderLeftWidth)||0)+(parseFloat(n.borderRightWidth)||0)),i==="outer"&&(s-=(parseFloat(n.marginLeft)||0)+(parseFloat(n.marginRight)||0))),s},_getDim:function(t){var e=this.get();return e.nodeType===3?{top:0,left:0}:this["_get"+t](e)},_getPosition:function(t){return{top:t.offsetTop,left:t.offsetLeft}},_getOffset:function(t){var e=t.getBoundingClientRect(),i=t.ownerDocument,s=i.documentElement,n=i.defaultView;return{top:e.top+n.pageYOffset-s.clientTop,left:e.left+n.pageXOffset-s.clientLeft}},_getSibling:function(t,e){var i,s=(t=t&&t.sdom?t.get():t)&&t.nodeType;return this.each(function(n){for(;n=n[e];)if(s&&n===t||new m(n).is(t))return void(i=n)}),new m(i)},_toArray:function(t){if(t instanceof NodeList){for(var e=[],i=0;i<t.length;i++)e[i]=t[i];return e}return t===void 0?[]:t.sdom?t.nodes:t},_toParams:function(t){var e="";for(var i in t)e+="&"+this._encodeUri(i)+"="+this._encodeUri(t[i]);return e.replace(/^&/,"")},_toObject:function(t){return new Function("return "+t)()},_encodeUri:function(t){return encodeURIComponent(t).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A").replace(/%20/g,"+")},_isNumber:function(t){return!isNaN(t)&&!isNaN(parseFloat(t))},_isObjectString:function(t){return t.search(/^{/)!==-1},_getBooleanFromStr:function(t){return t==="true"||t!=="false"&&t},_hasDisplayNone:function(t){return t.style.display==="none"||(t.currentStyle?t.currentStyle.display:getComputedStyle(t,null).display)==="none"}};function r(t,e){return A(t,e,[].slice.call(arguments,2))}var S=0;r.app=[],r.version="3.5.1",r.options={},r.modules={},r.services={},r.classes={},r.plugins={},r.mixins={},r.modals={},r.lang={},r.dom=function(t,e){return new m(t,e)},r.ajax=x,r.Dom=m,r.keycodes={BACKSPACE:8,DELETE:46,UP:38,DOWN:40,ENTER:13,SPACE:32,ESC:27,TAB:9,CTRL:17,META:91,SHIFT:16,ALT:18,RIGHT:39,LEFT:37},r.env={plugin:"plugins",module:"modules",service:"services",class:"classes",mixin:"mixins"},B!==void 0&&(B.fn.redactor=function(t){return A(this.toArray(),t,[].slice.call(arguments,1))});var A=function(t,e,i){for(var s,n="redactor",o=Array.isArray(t)?t:t&&t.nodeType?[t]:document.querySelectorAll(t),a=typeof e=="string"||typeof e=="function",l=[],h=0;h<o.length;h++){var c=o[h],d=r.dom(c);if((s=d.dataget(n))||a||(s=new N(c,e,S),d.dataset(n,s),r.app[S]=s,S++),s&&a){var u,p=e==="destroy";(u=typeof(e=p?"stop":e)=="function"?e.apply(s,i):(i.unshift(e),s.api.apply(s,i)))!==void 0&&l.push(u),p&&d.dataset(n,!1)}}return l.length===0||l.length===1?l.length===0?s:l[0]:l};r.add=function(t,e,i){if(r.env[t]!==void 0)if(i.translations&&(r.lang=r.extend(!0,{},r.lang,i.translations)),i.modals&&(r.modals=r.extend(!0,{},r.modals,i.modals)),t==="mixin")r[r.env[t]][e]=i;else{let n=function(){};if((n.prototype=i).mixins)for(var s=0;s<i.mixins.length;s++)r.inherit(n,r.mixins[i.mixins[s]]);r[r.env[t]][e]=n}},r.addLang=function(t,e){r.lang[t]===void 0&&(r.lang[t]={}),r.lang[t]=r.extend(r.lang[t],e)},r.create=function(t){var e=t.split("."),i=[].slice.call(arguments,1),s="classes";r.env[e[0]]!==void 0&&(s=r.env[e[0]],t=e.slice(1).join("."));var n=new r[s][t];if(n.init){var o=n.init.apply(n,i);return o||n}return n},r.inherit=function(t,e){function i(){}i.prototype=e;var s=new i;for(var n in t.prototype)t.prototype.__lookupGetter__(n)?s.__defineGetter__(n,t.prototype.__lookupGetter__(n)):s[n]=t.prototype[n];return t.prototype=s,t.prototype.super=e,t},r.error=function(t){throw t},r.extend=function(){var t={},e=!1,i=0,s=arguments.length;Object.prototype.toString.call(arguments[0])==="[object Boolean]"&&(e=arguments[0],i++);function n(o){for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(e&&Object.prototype.toString.call(o[a])==="[object Object]"?t[a]=r.extend(!0,t[a],o[a]):t[a]=o[a])}for(;i<s;i++)n(arguments[i]);return t},r.opts={animation:!0,lang:"en",direction:"ltr",spellcheck:!0,structure:!1,scrollTarget:!1,styles:!0,stylesClass:"redactor-styles",placeholder:!1,source:!0,showSource:!1,inline:!1,breakline:!1,markup:"p",enterKey:!0,clickToEdit:!1,clickToSave:!1,clickToCancel:!1,focus:!1,focusEnd:!1,minHeight:!1,maxHeight:!1,maxWidth:!1,plugins:[],callbacks:{},preClass:!1,preSpaces:4,tabindex:!1,tabAsSpaces:!1,tabKey:!0,autosave:!1,autosaveName:!1,autosaveData:!1,autosaveMethod:"post",toolbar:!0,toolbarFixed:!0,toolbarFixedTarget:document,toolbarFixedTopOffset:0,toolbarExternal:!1,toolbarContext:!0,air:!1,formatting:["p","blockquote","pre","h1","h2","h3","h4","h5","h6"],formattingAdd:!1,formattingHide:!1,buttons:["html","format","bold","italic","deleted","lists","image","file","link"],buttonsTextLabeled:!1,buttonsAdd:[],buttonsAddFirst:[],buttonsAddAfter:!1,buttonsAddBefore:!1,buttonsHide:[],buttonsHideOnMobile:[],imageUpload:!1,imageUploadParam:"file",imageData:!1,imageEditable:!0,imageCaption:!0,imageLink:!0,imagePosition:!1,imageResizable:!1,imageFloatMargin:"10px",imageFigure:!0,imageObserve:!0,imageSrcData:!1,fileUpload:!1,fileUploadParam:"file",fileData:!1,fileAttachment:!1,uploadData:!1,dragUpload:!0,multipleUpload:!0,clipboardUpload:!0,uploadBase64:!1,linkTarget:!1,linkTitle:!1,linkNewTab:!0,linkNofollow:!1,linkSize:30,linkValidation:!0,cleanOnEnter:!0,cleanInlineOnEnter:!1,paragraphize:!0,removeScript:!0,removeNewLines:!1,removeComments:!0,replaceTags:{b:"strong",i:"em",strike:"del"},pastePlainText:!1,pasteLinkTarget:!1,pasteImages:!0,pasteLinks:!0,pasteClean:!0,pasteKeepStyle:[],pasteKeepClass:[],pasteKeepAttrs:["td","th"],pasteBlockTags:["pre","h1","h2","h3","h4","h5","h6","table","tbody","thead","tfoot","th","tr","td","ul","ol","li","blockquote","p","figure","figcaption"],pasteInlineTags:["a","img","br","strong","ins","code","del","span","samp","kbd","sup","sub","mark","var","cite","small","b","u","em","i","abbr"],activeButtons:{b:"bold",strong:"bold",i:"italic",em:"italic",del:"deleted",strike:"deleted",u:"underline"},activeButtonsAdd:{},activeButtonsObservers:{},autoparse:!0,autoparseStart:!0,autoparsePaste:!0,autoparseLinks:!0,autoparseImages:!0,autoparseVideo:!0,autoparseHttps:!1,shortcodes:{"p.":{format:"p"},"quote.":{format:"blockquote"},"pre.":{format:"pre"},"h1.":{format:"h1"},"h2.":{format:"h2"},"h3.":{format:"h3"},"h4.":{format:"h4"},"h5.":{format:"h5"},"h6.":{format:"h6"},"*.":{format:"ul"}},shortcodesAdd:!1,shortcuts:{"ctrl+shift+m, meta+shift+m":{api:"module.inline.clearformat"},"ctrl+b, meta+b":{api:"module.inline.format",args:"b"},"ctrl+i, meta+i":{api:"module.inline.format",args:"i"},"ctrl+u, meta+u":{api:"module.inline.format",args:"u"},"ctrl+h, meta+h":{api:"module.inline.format",args:"sup"},"ctrl+l, meta+l":{api:"module.inline.format",args:"sub"},"ctrl+k, meta+k":{api:"module.link.open"},"ctrl+alt+0, meta+alt+0":{api:"module.block.format",args:"p"},"ctrl+alt+1, meta+alt+1":{api:"module.block.format",args:"h1"},"ctrl+alt+2, meta+alt+2":{api:"module.block.format",args:"h2"},"ctrl+alt+3, meta+alt+3":{api:"module.block.format",args:"h3"},"ctrl+alt+4, meta+alt+4":{api:"module.block.format",args:"h4"},"ctrl+alt+5, meta+alt+5":{api:"module.block.format",args:"h5"},"ctrl+alt+6, meta+alt+6":{api:"module.block.format",args:"h6"},"ctrl+shift+7, meta+shift+7":{api:"module.list.toggle",args:"ol"},"ctrl+shift+8, meta+shift+8":{api:"module.list.toggle",args:"ul"}},shortcutsAdd:!1,grammarly:!0,notranslate:!1,bufferLimit:100,emptyHtml:"<p></p>",markerChar:"\uFEFF",imageTypes:["image/png","image/jpeg","image/gif"],imageAttrs:["alt","title","src","class","width","height","srcset"],inlineTags:["a","span","strong","strike","b","u","em","i","code","del","ins","samp","kbd","sup","sub","mark","var","cite","small","abbr"],blockTags:["pre","ul","ol","li","p","h1","h2","h3","h4","h5","h6","dl","dt","dd","div","table","tbody","thead","tfoot","tr","th","td","blockquote","output","figcaption","figure","address","section","header","footer","aside","article","iframe"],regex:{youtube:/^https?\:\/\/(?:www\.youtube(?:\-nocookie)?\.com\/|m\.youtube\.com\/|youtube\.com\/)?(?:ytscreeningroom\?vi?=|youtu\.be\/|vi?\/|user\/.+\/u\/\w{1,2}\/|embed\/|watch\?(?:.*\&)?vi?=|\&vi?=|\?(?:.*\&)?vi?=)([^#\&\?\n\/<>"']*)/gi,vimeo:/(http|https)?:\/\/(?:www.|player.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/(?:[^/]*)\/videos\/|album\/(?:\d+)\/video\/|video\/|)(\d+)(?:\/[a-zA-Z0-9_-]+)?/gi,imageurl:/((https?|www)[^\s]+\.)(jpe?g|png|gif)(\?[^\s-]+)?/gi,url:/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z\u00F0-\u02AF0-9()!@:%_+.~#?&//=]*)/gi,aurl1:/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,aurl2:/(^|[^\/])(www\.[\S]+(\b|$))/gim},input:!0,zindex:!1,modes:{inline:{pastePlainText:!0,pasteImages:!1,enterKey:!1,toolbar:!1,autoparse:!1,source:!1,showSource:!1,styles:!1,air:!1},original:{styles:!1}}},r.lang.en={format:"Format",image:"Image",file:"File",link:"Link",bold:"Bold",italic:"Italic",deleted:"Strikethrough",underline:"Underline",superscript:"Superscript",subscript:"Subscript","bold-abbr":"B","italic-abbr":"I","deleted-abbr":"S","underline-abbr":"U","superscript-abbr":"Sup","subscript-abbr":"Sub",lists:"Lists","link-insert":"Insert Link","link-edit":"Edit Link","link-in-new-tab":"Open link in new tab",unlink:"Unlink",cancel:"Cancel",close:"Close",insert:"Insert",save:"Save",delete:"Delete",text:"Text",edit:"Edit",title:"Alt",paragraph:"Normal text",quote:"Quote",code:"Code",heading1:"Heading 1",heading2:"Heading 2",heading3:"Heading 3",heading4:"Heading 4",heading5:"Heading 5",heading6:"Heading 6",filename:"Name",optional:"optional",unorderedlist:"Unordered List",orderedlist:"Ordered List",outdent:"Outdent",indent:"Indent",horizontalrule:"Line",upload:"Upload","upload-label":"Drop files here or click to upload","accessibility-help-label":"Rich text editor",caption:"Caption",bulletslist:"Bullets",numberslist:"Numbers","image-position":"Position",none:"None",left:"Left",right:"Right",center:"Center",undo:"Undo",redo:"Redo"},r.buttons={html:{title:"HTML",icon:!0,api:"module.source.toggle"},undo:{title:"## undo ##",icon:!0,api:"module.buffer.undo"},redo:{title:"## redo ##",icon:!0,api:"module.buffer.redo"},format:{title:"## format ##",icon:!0,dropdown:{p:{title:"## paragraph ##",api:"module.block.format",args:{tag:"p"}},blockquote:{title:"## quote ##",api:"module.block.format",args:{tag:"blockquote"}},pre:{title:"## code ##",api:"module.block.format",args:{tag:"pre"}},h1:{title:"## heading1 ##",api:"module.block.format",args:{tag:"h1"}},h2:{title:"## heading2 ##",api:"module.block.format",args:{tag:"h2"}},h3:{title:"## heading3 ##",api:"module.block.format",args:{tag:"h3"}},h4:{title:"## heading4 ##",api:"module.block.format",args:{tag:"h4"}},h5:{title:"## heading5 ##",api:"module.block.format",args:{tag:"h5"}},h6:{title:"## heading6 ##",api:"module.block.format",args:{tag:"h6"}}}},bold:{title:"## bold-abbr ##",icon:!0,tooltip:"## bold ##",api:"module.inline.format",args:{tag:"b"}},italic:{title:"## italic-abbr ##",icon:!0,tooltip:"## italic ##",api:"module.inline.format",args:{tag:"i"}},deleted:{title:"## deleted-abbr ##",icon:!0,tooltip:"## deleted ##",api:"module.inline.format",args:{tag:"del"}},underline:{title:"## underline-abbr ##",icon:!0,tooltip:"## underline ##",api:"module.inline.format",args:{tag:"u"}},sup:{title:"## superscript-abbr ##",icon:!0,tooltip:"## superscript ##",api:"module.inline.format",args:{tag:"sup"}},sub:{title:"## subscript-abbr ##",icon:!0,tooltip:"## subscript ##",api:"module.inline.format",args:{tag:"sub"}},lists:{title:"## lists ##",icon:!0,observe:"list",dropdown:{observe:"list",unorderedlist:{title:"&bull; ## unorderedlist ##",api:"module.list.toggle",args:"ul"},orderedlist:{title:"1. ## orderedlist ##",api:"module.list.toggle",args:"ol"},outdent:{title:"< ## outdent ##",api:"module.list.outdent"},indent:{title:"> ## indent ##",api:"module.list.indent"}}},ul:{title:"&bull; ## bulletslist ##",icon:!0,api:"module.list.toggle",observe:"list",args:"ul"},ol:{title:"1. ## numberslist ##",icon:!0,api:"module.list.toggle",observe:"list",args:"ol"},outdent:{title:"## outdent ##",icon:!0,api:"module.list.outdent",observe:"list"},indent:{title:"## indent ##",icon:!0,api:"module.list.indent",observe:"list"},image:{title:"## image ##",icon:!0,api:"module.image.open"},file:{title:"## file ##",icon:!0,api:"module.file.open"},link:{title:"## link ##",icon:!0,observe:"link",dropdown:{observe:"link",link:{title:"## link-insert ##",api:"module.link.open"},unlink:{title:"## unlink ##",api:"module.link.unlink"}}},line:{title:"## horizontalrule ##",icon:!0,api:"module.line.insert"}};var N=function(t,e,i){this.module={},this.plugin={},this.instances={},this.started=!1,this.stopped=!1,this.uuid=i,this.rootElement=t,this.rootOpts=e,this.dragInside=!1,this.dragComponentInside=!1,this.keycodes=r.keycodes,this.namespace="redactor",this.$win=r.dom(window),this.$doc=r.dom(document),this.$body=r.dom("body"),this.editorReadOnly=!1,this.opts=r.create("service.options",e,t),this.lang=r.create("service.lang",this),this.buildServices(),this.buildModules(),this.buildPlugins(),this.start()};N.prototype={start:function(){this.stopped=!1,this.broadcast("start"),this.broadcast("startcode"),this.opts.clickToEdit?this.broadcast("startclicktoedit"):(this.broadcast("enable"),this.opts.showSource&&this.broadcast("startcodeshow"),this.broadcast("enablefocus")),this.broadcast("started"),this.started=!0},stop:function(){this.started=!1,this.stopped=!0,this.broadcast("stop"),this.broadcast("disable"),this.broadcast("stopped")},isStarted:function(){return this.started},isStopped:function(){return this.stopped},buildServices:function(){var t=["options","lang"],e=["uuid","keycodes","opts","lang","$win","$doc","$body"],i=[];for(var s in r.services)t.indexOf(s)===-1&&(this[s]=r.create("service."+s,this),i.push(s),e.push(s));for(var n=0;n<i.length;n++)for(var o=i[n],a=0;a<e.length;a++){var l=e[a];o!==l&&(this[o][l]=this[l])}},buildModules:function(){for(var t in r.modules)this.module[t]=r.create("module."+t,this),this.instances[t]=this.module[t]},buildPlugins:function(){for(var t=this.opts.plugins,e=0;e<t.length;e++){var i=t[e];r.plugins[i]!==void 0&&(this.plugin[i]=r.create("plugin."+i,this),this.instances[i]=this.plugin[i])}},isDragInside:function(){return this.dragInside},setDragInside:function(t){this.dragInside=t},isDragComponentInside:function(){return this.dragComponentInside},setDragComponentInside:function(t){this.dragComponentInside=t},getDragComponentInside:function(){return this.dragComponentInside},isReadOnly:function(){return this.editorReadOnly},enableReadOnly:function(){this.editorReadOnly=!0,this.broadcast("enablereadonly"),this.component.clearActive(),this.toolbar.disableButtons()},disableReadOnly:function(){this.editorReadOnly=!1,this.broadcast("disablereadonly"),this.toolbar.enableButtons()},callMessageHandler:function(t,e,i){var s,n=e.split(".");if(n.length===1)typeof t["on"+e]=="function"&&(s=t["on"+e].apply(t,i));else{n[0]="on"+n[0];var o=this.utils.checkProperty(t,n);typeof o=="function"&&(s=o.apply(t,i))}return s},broadcast:function(t){var e,i=[].slice.call(arguments,1);for(var s in this.instances){var n=this.callMessageHandler(this.instances[s],t,i);n!==void 0&&(e=n)}var o=this.callback.trigger(t,i);return e!==void 0?e:o},on:function(t,e){this.callback.add(t,e)},off:function(t,e){this.callback.remove(t,e)},api:function(t){if((this.isStarted()||t==="start")&&(!this.isReadOnly()||t==="disableReadOnly")){this.broadcast("state");var e=[].slice.call(arguments,1),i=t.split("."),s=i.length===1,n=i[0]==="on"||i[0]==="off",o=!n&&i.length===2,a=i[0]==="plugin",l=i[0]==="module";if(s){if(typeof this[i[0]]=="function")return this.callInstanceMethod(this,i[0],e)}else{if(n)return i[0]==="on"?this.on(i[1],e[0]):this.off(i[1],e[0]||void 0);if(o){if(this.isInstanceExists(this,i[0]))return this.callInstanceMethod(this[i[0]],i[1],e);r.error(new Error('Service "'+i[0]+'" not found'))}else if(a){if(this.isInstanceExists(this.plugin,i[1]))return this.callInstanceMethod(this.plugin[i[1]],i[2],e);r.error(new Error('Plugin "'+i[1]+'" not found'))}else if(l){if(this.isInstanceExists(this.module,i[1]))return this.callInstanceMethod(this.module[i[1]],i[2],e);r.error(new Error('Module "'+i[1]+'" not found'))}}}},isInstanceExists:function(t,e){return t[e]!==void 0},callInstanceMethod:function(t,e,i){if(typeof t[e]=="function")return t[e].apply(t,i)}},r.add("mixin","formatter",{buildArgs:function(t){this.args={class:t.class||!1,style:t.style||!1,attr:t.attr||!1},this.args.class||this.args.style||this.args.attr||(this.args=!1)},applyArgs:function(t,e){return t=this.args?this[this.type](this.args,!1,t,e):this._clearAll(t,e)},clearClass:function(t,e){this.selection.save();var i=e?r.dom(e):this.getElements(t,!0);return i.removeAttr("class"),e=this._unwrapSpanWithoutAttr(i.getAll()),this.selection.restore(),e},clearStyle:function(t,e){this.selection.save();var i=e?r.dom(e):this.getElements(t,!0);return i.removeAttr("style"),e=this._unwrapSpanWithoutAttr(i.getAll()),this.selection.restore(),e},clearAttr:function(t,e){this.selection.save();var i=e?r.dom(e):this.getElements(t,!0);return this._removeAllAttr(i),e=this._unwrapSpanWithoutAttr(i.getAll()),this.selection.restore(),e},set:function(t,e,i,s){s!==!1&&this.selection.save();var n=i?r.dom(i):this.getElements(e);return t.class&&(n.removeAttr("class"),n.addClass(t.class)),t.style&&(n.removeAttr("style"),n.css(t.style),n.each(function(o){var a=r.dom(o);a.attr("data-redactor-style-cache",a.attr("style"))})),t.attr&&(this._removeAllAttr(n),n.attr(t.attr)),s!==!1&&this.selection.restore(),n.getAll()},toggle:function(t,e,i,s){s!==!1&&this.selection.save();var n,o=i?r.dom(i):this.getElements(e);return t.class&&(o.toggleClass(t.class),o.each(function(a){a.className===""&&a.removeAttribute("class")})),t.style&&(n=t.style,o.each((function(a){var l=r.dom(a);for(var h in n){var c=n[h],d=l.css(h);d=this.utils.isRgb(d)?this.utils.rgb2hex(d):d.replace(/"/g,""),c=this.utils.isRgb(c)?this.utils.rgb2hex(c):c.replace(/"/g,""),d=this.utils.hex2long(d),(typeof(c=this.utils.hex2long(c))=="string"?c.toLowerCase():c)===(typeof d=="string"?d.toLowerCase():d)?l.css(h,""):l.css(h,c)}this._convertStyleQuotes(l),this.utils.removeEmptyAttr(a,"style")?l.removeAttr("data-redactor-style-cache"):l.attr("data-redactor-style-cache",l.attr("style"))}).bind(this))),t.attr&&(n=t.attr,o.each(function(a){var l=r.dom(a);for(var h in n)l.attr(h)?l.removeAttr(h):l.attr(h,n[h])})),s!==!1&&this.selection.restore(),o.getAll()},add:function(t,e,i,s){s!==!1&&this.selection.save();var n=i?r.dom(i):this.getElements(e);if(t.class&&n.addClass(t.class),t.style){var o=t.style;n.each((function(a){var l=r.dom(a);l.css(o),l.attr("data-redactor-style-cache",l.attr("style")),this._convertStyleQuotes(l)}).bind(this))}return t.attr&&n.attr(t.attr),s!==!1&&this.selection.restore(),n.getAll()},remove:function(t,e,i,s){s!==!1&&this.selection.save();var n=i?r.dom(i):this.getElements(e);if(t.class&&(n.removeClass(t.class),n.each(function(a){a.className===""&&a.removeAttribute("class")})),t.style){var o=t.style;n.each((function(a){var l=r.dom(a);l.css(o,""),this.utils.removeEmptyAttr(a,"style")?l.removeAttr("data-redactor-style-cache"):l.attr("data-redactor-style-cache",l.attr("style"))}).bind(this))}return t.attr&&n.removeAttr(t.attr),i=this._unwrapSpanWithoutAttr(n.getAll()),s!==!1&&this.selection.restore(),i},_removeAllAttr:function(t){t.each(function(e){for(var i=e.attributes.length;0<i--;){var s=e.attributes[i],n=s.name;n!=="style"&&n!=="class"&&e.removeAttributeNode(s)}})},_convertStyleQuotes:function(t){var e=t.attr("style");e&&t.attr("style",e.replace(/"/g,"'"))},_clearAll:function(t,e){e!==!1&&this.selection.save();for(var i=0;i<t.length;i++)for(var s=t[i];0<s.attributes.length;)s.removeAttribute(s.attributes[0].name);return t=this._unwrapSpanWithoutAttr(t),e!==!1&&this.selection.restore(),t},_unwrapSpanWithoutAttr:function(t){for(var e=[],i=0;i<t.length;i++){var s=t[i];s.attributes.length<=0&&s.nodeType!==3&&s.tagName==="SPAN"?r.dom(s).unwrap():e.push(s)}return e}}),r.add("mixin","dom",r.Dom.prototype),r.add("mixin","component",{get cmnt(){return!0}}),r.add("service","options",{init:function(t,e){var i=r.dom(e),s=r.extend({},r.opts,e?i.data():{},r.options);return s=r.extend(!0,s,t)}}),r.add("service","lang",{init:function(t){this.app=t,this.opts=t.opts,this.vars=this._build(this.opts.lang)},rebuild:function(t){this.opts.lang=t,this.vars=this._build(t)},extend:function(t){this.vars=r.extend(this.vars,t)},parse:function(t){if(t===void 0)return"";var e=t.match(/## (.*?) ##/g);if(e)for(var i=0;i<e.length;i++){var s=e[i].replace(/^##\s/g,"").replace(/\s##$/g,"");t=t.replace(e[i],this.get(s))}return t},get:function(t){var e="";return this.vars[t]!==void 0?e=this.vars[t]:this.opts.lang!=="en"&&r.lang.en[t]!==void 0&&(e=r.lang.en[t]),e},_build:function(t){var e=r.lang.en;return t!=="en"&&(e=r.lang[t]!==void 0?r.lang[t]:e),e}}),r.add("service","callback",{init:function(t){this.app=t,this.opts=t.opts,this.callbacks={},this.opts.callbacks&&this._set(this.opts.callbacks,"")},stop:function(){this.callbacks={}},add:function(t,e){this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e)},remove:function(t,e){if(e===void 0)delete this.callbacks[t];else{for(var i=0;i<this.callbacks[t].length;i++)this.callbacks[t].splice(i,1);Object.keys(this.callbacks[t]).length===0&&delete this.callbacks[t]}},trigger:function(t,e){var i=this._loop(t,e,this.callbacks);return i===void 0&&e&&e[0]!==!1?e[0]:i},_set:function(t,e){for(var i in t){var s=e===""?i:e+"."+i;typeof t[i]=="object"?this._set(t[i],s):(this.callbacks[s]=[],this.callbacks[s].push(t[i]))}},_loop:function(t,e,i){var s;for(var n in i)if(t===n)for(var o=0;o<i[n].length;o++)s=i[n][o].apply(this.app,e);return s}}),r.add("service","animate",{init:function(t){this.animationOpt=t.opts.animation},start:function(t,e,i,s){var n={duration:!1,iterate:!1,delay:!1,timing:!1,prefix:"redactor-"};return n=typeof i=="function"?n:r.extend(n,i),new r.AnimatePlay(t,e,n,s=typeof i=="function"?i:s,this.animationOpt)},stop:function(t){this.$el=r.dom(t),this.$el.removeClass("redactor-animated");var e=this.$el.attr("redactor-animate-effect");this.$el.removeClass(e),this.$el.removeAttr("redactor-animate-effect");var i=this.$el.attr("redactor-animate-hide");i&&this.$el.addClass(i).removeAttr("redactor-animate-hide"),this.$el.off("animationend webkitAnimationEnd")}}),(r.AnimatePlay=function(t,e,i,s,n){return this.hidableEffects=["fadeOut","flipOut","slideUp","zoomOut","slideOutUp","slideOutRight","slideOutLeft"],this.prefixes=["","-webkit-"],this.$el=r.dom(t),this.$body=r.dom("body"),this.callback=s,this.animation=n?e:this.buildAnimationOff(e),this.defaults=i,this.animation==="slideUp"&&this.$el.height(this.$el.height()),this.isInanimate()?this.inanimate():this.animate()}).prototype={buildAnimationOff:function(t){return this.isHidable(t)?"hide":"show"},buildHideClass:function(){return"redactor-animate-hide"},isInanimate:function(){return this.animation==="show"||this.animation==="hide"},isAnimated:function(){return this.$el.hasClass("redactor-animated")},isHidable:function(t){return this.hidableEffects.indexOf(t)!==-1},inanimate:function(){var t;return this.defaults.timing="linear",this.animation==="show"?(t=this.buildHideClass(),this.$el.attr("redactor-animate-hide",t),this.$el.removeClass(t)):(t=this.$el.attr("redactor-animate-hide"),this.$el.addClass(t).removeAttr("redactor-animate-hide")),typeof this.callback=="function"&&this.callback(this),this},animate:function(){var t=this.defaults.delay?this.defaults.delay:0;return setTimeout((function(){if(this.$body.addClass("no-scroll-x"),this.$el.addClass("redactor-animated"),!this.$el.attr("redactor-animate-hide")){var e=this.buildHideClass();this.$el.attr("redactor-animate-hide",e),this.$el.removeClass(e)}this.$el.addClass(this.defaults.prefix+this.animation),this.$el.attr("redactor-animate-effect",this.defaults.prefix+this.animation),this.set(this.defaults.duration+"s",this.defaults.iterate,this.defaults.timing),this.complete()}).bind(this),1e3*t),this},set:function(t,e,i){for(var s=this.prefixes.length;s--;)t===!1&&t!==""||this.$el.css(this.prefixes[s]+"animation-duration",t),e===!1&&e!==""||this.$el.css(this.prefixes[s]+"animation-iteration-count",e),i===!1&&i!==""||this.$el.css(this.prefixes[s]+"animation-timing-function",i)},clean:function(){this.$body.removeClass("no-scroll-x"),this.$el.removeClass("redactor-animated"),this.$el.removeClass(this.defaults.prefix+this.animation),this.$el.removeAttr("redactor-animate-effect"),this.set("","","")},complete:function(){this.$el.one("animationend webkitAnimationEnd",(function(){if(this.$el.hasClass(this.defaults.prefix+this.animation)&&this.clean(),this.isHidable(this.animation)){var t=this.$el.attr("redactor-animate-hide");this.$el.addClass(t).removeAttr("redactor-animate-hide")}this.animation==="slideUp"&&this.$el.height(""),typeof this.callback=="function"&&this.callback(this.$el)}).bind(this))}},r.add("service","caret",{init:function(t){this.app=t},setStart:function(t){this._setCaret("Start",t)},setEnd:function(t){this._setCaret("End",t)},setBefore:function(t){this._setCaret("Before",t)},setAfter:function(t){this._setCaret("After",t)},isStart:function(t){return this._isStartOrEnd(t,"First")},isEnd:function(t){return this._isStartOrEnd(t,"Last")},setAtEnd:function(t){var e=this.inspector.parse(t).getTag(),i=document.createRange();if(this._isInPage(t)){if(e==="a"){var s=this.utils.createInvisibleChar();r.dom(t).after(s),i.selectNodeContents(s),i.collapse(!0)}else i.selectNodeContents(t),i.collapse(!1);this.selection.setRange(i)}},setAtStart:function(t){var e=document.createRange(),i=this.inspector.parse(t);if(this._isInPage(t)){if(e.setStart(t,0),e.collapse(!0),i.isInline()){var s=this.utils.createInvisibleChar();e.insertNode(s),e.selectNodeContents(s),e.collapse(!1)}this.selection.setRange(e)}},setAtBefore:function(t){var e=this.inspector.parse(t),i=document.createRange();if(this._isInPage(t)){if(i.setStartBefore(t),i.collapse(!0),e.isInline()){var s=this.utils.createInvisibleChar();t.parentNode.insertBefore(s,t),i.selectNodeContents(s),i.collapse(!1)}this.selection.setRange(i)}},setAtAfter:function(t){var e=document.createRange();if(this._isInPage(t)){e.setStartAfter(t),e.collapse(!0);var i=this.utils.createInvisibleChar();e.insertNode(i),e.selectNodeContents(i),e.collapse(!1),this.selection.setRange(e)}},setAtPrev:function(t){var e=t.previousSibling;(e=e&&(e.nodeType===3&&this._isEmptyTextNode(e)?e.previousElementSibling:e))&&this.setEnd(e)},setAtNext:function(t){var e=t.nextSibling;(e=e&&(e.nodeType===3&&this._isEmptyTextNode(e)?e.nextElementSibling:e))&&this.setStart(e)},_setCaret:function(t,e){var i=this.inspector.parse(e),s=i.getNode();s&&(this.component.clearActive(),this["_set"+t](s,i,i.getTag()))},_setStart:function(t,e,i){if(e.isText())return this.editor.focus(),this.setAtStart(t);if(i==="ul"||i==="ol"){t=e.findFirstNode("li");var s=this.utils.getFirstElement(t),n=this.inspector.parse(s);if(s&&n.isComponent())return this.setStart(n.getComponent())}else if(i==="dl")t=e.findFirstNode("dt");else{if(i==="br"||i==="hr")return this.setBefore(t);if(i==="td"||i==="th"){var o=e.getFirstElement(t);if(o)return this.setStart(o)}else{if(i==="table"||i==="tr")return this.setStart(e.findFirstNode("th, td"));if(e.isComponentType("code")&&!e.isFigcaption()){var a=e.findLastNode("pre, code");return this.editor.focus(),this.setAtStart(a)}if(i==="figure"&&e.isComponentType("table")){var l=e.getTable(),h=this.inspector.parse(l);return this.setStart(h.findFirstNode("th, td"))}if(!e.isComponentType("table")&&e.isComponent()&&!e.isFigcaption())return this.component.setActive(t)}}this.editor.focus(),this._setInline(t,"Start")||this.setAtStart(t)},_setEnd:function(t,e,i){if(e.isText())return this.editor.focus(),this.setAtEnd(t);if(i==="ul"||i==="ol"){t=e.findLastNode("li");var s=this.utils.getLastElement(t),n=this.inspector.parse(s);if(s&&n.isComponent())return this.setEnd(n.getComponent())}else if(i==="dl")t=e.findLastNode("dd");else{if(i==="br"||i==="hr")return this.setAfter(t);if(i==="td"||i==="th"){var o=e.getLastElement();if(o)return this.setEnd(o)}else{if(i==="table"||i==="tr")return this.setEnd(e.findLastNode("th, td"));if(e.isComponentType("code")&&!e.isFigcaption()){var a=e.findLastNode("pre, code");return this.editor.focus(),this.setAtEnd(a)}if(i==="figure"&&e.isComponentType("table")){var l=e.getTable(),h=this.inspector.parse(l);return this.setEnd(h.findLastNode("th, td"))}if(!e.isComponentType("table")&&e.isComponent()&&!e.isFigcaption())return this.component.setActive(t)}}if(this.editor.focus(),!this._setInline(t,"End")){if(this.utils.isEmpty(t))return this.setStart(t);this.setAtEnd(t)}},_setBefore:function(t,e,i){return t.nodeType===3?this.setAtBefore(t):e.isInline()?this.setAtBefore(t):e.isFirstTableCell()?this.setAtPrev(e.getComponent()):i==="td"||i==="th"?this.setAtPrev(t):e.isFirstListItem()?this.setAtPrev(e.getList()):e.isFigcaption()?this.setStart(e.getComponent()):!e.isComponentType("table")&&e.isComponent()?this.setAtPrev(e.getComponent()):e.isBlock()?this.setAtPrev(t):(this.editor.focus(),void this.setAtBefore(t))},_setAfter:function(t,e,i){return t.nodeType===3?this.setAtAfter(t):e.isInline()?this.setAtAfter(t):e.isLastTableCell()?this.setAtNext(e.getComponent()):i==="td"||i==="th"?this.setAtNext(t):e.isFirstListItem()?this.setAtNext(e.getList()):!e.isComponentType("table")&&e.isComponent()?this.setAtNext(e.getComponent()):e.isBlock()?this.setAtNext(t):(this.editor.focus(),void this.setAtAfter(t))},_setInline:function(t,e){var i=this._hasInlineChild(t,e==="Start"?"first":"last");if(i)return e==="Start"?this.setStart(i):this.setEnd(i),!0},_isStartOrEnd:function(t,e){var i=this.utils.getNode(t);if(!i)return!1;var s=this.inspector.parse(i);if((i=this._getStartEndNode(i,s,e))&&i.nodeType!==3&&i.tagName!=="LI"){var n=i.nodeType===3?i.textContent:i.innerHTML;if((n=this.utils.trimSpaces(n))==="")return!0}if(!s.isFigcaption()&&s.isComponent()&&!s.isComponentEditable())return!0;var o=this.offset.get(i,!0);return!!o&&(e==="First"?o.start===0:o.end===this.offset.size(i,!0))},_isInPage:function(t){return!(!t||!t.nodeType)&&t!==document.body&&document.body.contains(t)},_hasInlineChild:function(t,e){var i=this.inspector.parse(t),s=e==="first"?i.getFirstNode():i.getLastNode(),n=r.dom(s);if(s&&s.nodeType!==3&&this.inspector.isInlineTag(s.tagName)&&!n.hasClass("redactor-component")&&!n.hasClass("non-editable"))return s},_isEmptyTextNode:function(t){var e=t.textContent.trim().replace(/\n/,"");return(e=this.utils.removeInvisibleChars(e))===""},_getStartEndNode:function(t,e,i){return e.isFigcaption()?t=e.getFigcaption():e.isTable()?t=e["find"+i+"Node"]("th, td"):e.isList()?t=e["find"+i+"Node"]("li"):e.isComponentType("code")&&(t=e.findLastNode("pre, code")),t}});var L=function(t){return document.getSelection().containsNode(t,!0)};"containsNode"in Selection.prototype||(L=function(t){var e=document.getSelection(),i=e.anchorNode.parentNode,s=e.focusNode.parentNode,n=e.getRangeAt(0).getBoundingClientRect(),o=t.getBoundingClientRect();return!!r.dom(i).closest(t).length||!!r.dom(s).closest(t).length||n.top<o.top&&n.height>o.height}),r.add("service","selection",{init:function(t){this.app=t},is:function(){var t=this.get();if(t){var e=t.anchorNode;return r.dom(e).closest(".redactor-in-"+this.uuid).length!==0||e===this.editor.getElement().get()}return!1},isCollapsed:function(){var t=this.get(),e=this.getRange();return!(!t||!t.isCollapsed)||!(!e||e.toString().length!==0)},isBackwards:function(){var t=!1,e=this.get();if(e&&!e.isCollapsed){var i=document.createRange();i.setStart(e.anchorNode,e.anchorOffset),i.setEnd(e.focusNode,e.focusOffset),t=i.collapsed,i.detach()}return t},isIn:function(t){var e=r.dom(t).get(),i=this.getCurrent();return!(!i||!e)&&e.contains(i)},isText:function(){var t=this.get();if(t){var e=t.anchorNode,i=this.getBlock(e),s=this.getBlocks();if(i&&this.inspector.isTableCellTag(i.tagName)||i===!1&&s.length===0)return!0}return!1},isAll:function(t){var e=this.utils.getNode(t);if(!e)return!1;var i=this.editor.isEditor(e),s=this.inspector.parse(e);if(!s.isFigcaption()&&this.component.isNonEditable(e)&&this.component.isActive(e))return!0;if(i){var n=this.editor.getElement().html().replace(/<p><\/p>$/i,"");if(this.getHtml(!1).length!==n.length)return!1}if(i&&this.editor.isEmpty()||this.isCollapsed())return!1;var o=this.offset.get(e,!0),a=this.offset.size(e,!0);return!i&&s.isComponentType("code")&&(a=this.getText().trim().length),!(!o||o.start!==0||o.end!==a)},hasNonEditable:function(){var t=this.getHtml(),e=r.dom("<div>").html(t);return!this.isCollapsed()&&e.find(".non-editable").length!==0},setRange:function(t){var e=window.getSelection();e.removeAllRanges(),e.addRange(t)},setAll:function(t){var e=this.utils.getNode(t);if(e){var i=this.inspector.parse(e);if(this.component.clearActive(),this.editor.focus(),this.editor.saveScroll(),this.editor.disableNonEditables(),e&&e.tagName==="TABLE"){var s=i.findFirstNode("td, th"),n=i.findLastNode("td, th");r.dom(s).prepend(this.marker.build("start")),r.dom(n).append(this.marker.build("end")),this.restoreMarkers()}else if(!i.isFigcaption()&&this.component.isNonEditable(e))this.component.setActive(e);else{i.isComponentType("code")&&(e=i.getComponentCodeElement()).focus();var o=document.createRange();o.selectNodeContents(e),this.setRange(o)}this.editor.enableNonEditables(),this.editor.restoreScroll()}},get:function(){var t=window.getSelection();return 0<t.rangeCount?t:null},getRange:function(){var t=this.get();return t&&t.getRangeAt(0)?t.getRangeAt(0):null},getTextBeforeCaret:function(t){t=t===void 0?1:t;var e=this.editor.getElement().get(),i=this.getRange(),s=!1;return i&&((i=i.cloneRange()).collapse(!0),i.setStart(e,0),s=i.toString().slice(-t)),s},getTextAfterCaret:function(t){t=t===void 0?1:t;var e=this.editor.getElement().get(),i=this.getRange(),s=!1;if(i){var n=i.cloneRange();n.selectNodeContents(e),n.setStart(i.endContainer,i.endOffset),s=n.toString().slice(0,t)}return s},getPosition:function(){var t=this.getRange(),e={top:0,left:0,width:0,height:0};if(window.getSelection&&t.getBoundingClientRect){var i=(t=t.cloneRange()).startOffset-1;t.setStart(t.startContainer,i<0?0:i);var s=t.getBoundingClientRect();e={top:s.top,left:s.left,width:s.right-s.left,height:s.bottom-s.top}}return e},getCurrent:function(){var t=!1,e=this.get(),i=this.component.getActive();return i?t=i:e&&this.is()&&(t=e.anchorNode!==this.editor.getElement().get()&&e.anchorNode),t},getParent:function(){var t=!1,e=this.getCurrent();if(e){var i=e.parentNode;t=i!==this.editor.getElement().get()&&i}return t},getElement:function(t){for(var e=t||this.getCurrent();e;){var i=this.inspector.parse(e);if(i.isElement()&&i.isInEditor())return e;e=e.parentNode}return!1},getInline:function(t){for(var e=t||this.getCurrent(),i=!1;e;)this._isInlineNode(e)&&(i=e),e=e.parentNode;return i},getInlineFirst:function(t){for(var e=t||this.getCurrent();e;){if(this._isInlineNode(e))return e;e=e.parentNode}return!1},getInlineAll:function(t){for(var e=t||this.getCurrent(),i=[];e;)this._isInlineNode(e)&&i.push(e),e=e.parentNode;return i},getBlock:function(t){for(var e=t||this.getCurrent();e;){var i=this.inspector.parse(e);if(this.inspector.isBlockTag(e.tagName)&&i.isInEditor(e))return e;e=e.parentNode}return!1},getInlinesAllSelected:function(t){if(this.isAll())return[];var e=this.getInlines({all:!0,inside:!0}),i=this.getText().replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&"),s=[];if(i==="")s=e;else if(1<e.length)for(var n=0;n<e.length;n++)this._isTextSelected(e[n],i)&&s.push(e[n]);else e.length===1&&this._isTextSelected(e[0],i)&&(s=e);return s=t&&t.tags?this._filterNodesByTags(s,t.tags):s},getInlines:function(t){for(var e=this.getNodes(),i=[],s=0;s<e.length;s++){var n;if(t&&t.all)for(n=e[s];n;)this._isInlineNode(n)&&!this._isInNodesArray(i,n)&&i.push(n),n=n.parentNode;else(n=this.getInline(e[s]))&&!this._isInNodesArray(i,n)&&i.push(n)}return i=t&&t.tags?this._filterNodesByTags(i,t.tags):i,i=t&&t.inside?this._filterInlinesInside(i,t):i},getBlocks:function(t){var e=this.getNodes(),i=this.getBlock();e=e.length===0&&i?[i]:e;for(var s=[],n=0;n<e.length;n++){var o=this.getBlock(e[n]);r.dom(o).hasClass("non-editable")||o&&!this._isInNodesArray(s,o)&&s.push(o)}return s=t&&t.tags?this._filterNodesByTags(s,t.tags):s,s=t&&t.first?this._filterBlocksFirst(s,t):s},getElements:function(t){var e=this.getNodes({textnodes:!1}),i=this.getBlock();e=e.length===0&&i?[i]:e;for(var s=[],n=0;n<e.length;n++)this._isInNodesArray(s,e[n])||s.push(e[n]);return s=t&&t.tags?this._filterNodesByTags(s,t.tags):s},getNodes:function(t){var e=[],i=this.component.getActive();if(i)e=this._getNodesComponent(i);else if(this.isCollapsed()){var s=this.getCurrent();e=s?[s]:[]}else this.is()&&!i&&(e=this._getRangeSelectedNodes());return e=this._filterServicesNodes(e),e=this._filterEditor(e),e=t&&t.tags?this._filterNodesByTags(e,t.tags):e,e=t&&t.textnodes?this._filterNodesTexts(e,t):e,e=t&&!t.textnodes?this._filterNodesElements(e):e},getText:function(){var t=this.get();return t?this.utils.removeInvisibleChars(t.toString()):""},getHtml:function(t){var e="",i=this.get();if(i){for(var s=document.createElement("div"),n=i.rangeCount,o=0;o<n;++o)s.appendChild(i.getRangeAt(o).cloneContents());e=s.innerHTML,e=(e=t!==!1?this.cleaner.output(e):e).replace(/<p><\/p>$/i,"")}return e},clear:function(){this.component.clearActive(),this.get().removeAllRanges()},collapseToStart:function(){var t=this.get();t&&!t.isCollapsed&&t.collapseToStart()},collapseToEnd:function(){var t=this.get();t&&!t.isCollapsed&&t.collapseToEnd()},saveActiveComponent:function(){var t=this.component.getActive();return!!t&&(this.savedComponent=t,!0)},restoreActiveComponent:function(){return!!this.savedComponent&&(this.component.setActive(this.savedComponent),!0)},save:function(){this._clearSaved();var t=this.getElement();!t||["TD","TH","P","DIV","PRE","H1","H2","H3","H4","H5","H6","LI","BLOCKQUOTE"].indexOf(t.tagName)===-1||t.innerHTML!==""&&t.innerHTML!=="<br>"?this.saveActiveComponent()||(this.saved=this.offset.get()):this.savedElement=t},restore:function(){(this.saved||this.savedComponent||this.savedElement)&&(this.editor.saveScroll(),this.savedElement?this.caret.setStart(this.savedElement):this.restoreActiveComponent()||this.offset.set(this.saved),this._clearSaved(),this.editor.restoreScroll())},saveMarkers:function(){this._clearSaved(),this.saveActiveComponent()||this.marker.insert()},restoreMarkers:function(){this.editor.saveScroll(),this.restoreActiveComponent()||this.marker.restore(),this._clearSaved(),this.editor.restoreScroll()},_getNextNode:function(t){if(t.hasChildNodes())return t.firstChild;for(;t&&!t.nextSibling;)t=t.parentNode;return t?t.nextSibling:null},_getNodesComponent:function(t){var e=this.getCurrent(),i=this.inspector.parse(e);return i.isFigcaption()?[i.getFigcaption()]:[t]},_getRangeSelectedNodes:function(){var t=[],e=this.getRange(),i=e.startContainer,s=e.startContainer,n=e.endContainer,o=this.editor.getElement();if(s===o.get()&&this.isAll())t=this.utils.getChildNodes(o);else if(i===n)t=[i];else{for(;i&&i!==n;)t.push(i=this._getNextNode(i));for(i=e.startContainer;i&&i!==e.commonAncestorContainer;)t.unshift(i),i=i.parentNode}return t},_isInNodesArray:function(t,e){return t.indexOf(e)!==-1},_filterEditor:function(t){for(var e=[],i=0;i<t.length;i++)this.inspector.parse(t[i]).isInEditor()&&e.push(t[i]);return e},_filterServicesNodes:function(t){for(var e=[],i=0;i<t.length;i++){var s=r.dom(t[i]),n=!1;t[i]&&t[i].nodeType===3&&this.utils.isEmpty(t[i])&&(n=!0),(s.hasClass("redactor-script-tag")||s.hasClass("redactor-component-caret")||s.hasClass("redactor-selection-marker")||s.hasClass("non-editable"))&&(n=!0),n||e.push(t[i])}return e},_filterNodesTexts:function(t,e){for(var i=[],s=0;s<t.length;s++)(t[s].nodeType===3||e.keepbr&&t[s].tagName==="BR")&&(this.getInline(t[s])&&e&&e.inline===!1||i.push(t[s]));return i},_filterNodesElements:function(t){for(var e=[],i=0;i<t.length;i++)t[i].nodeType!==3&&e.push(t[i]);return e},_filterNodesByTags:function(t,e,i){for(var s=[],n=0;n<t.length;n++)if(i&&t[n].nodeType===3)s.push(t[n]);else if(t[n].nodeType!==3){var o=t[n].tagName.toLowerCase();e.indexOf(o.toLowerCase())!==-1&&s.push(t[n])}return s},_filterBlocksFirst:function(t){for(var e=[],i=0;i<t.length;i++){var s=r.dom(t[i]),n=s.parent().get(),o=s.parent().hasClass("redactor-in"),a=n&&(n.tagName==="TD"||n.tagName==="TH");(o||a)&&e.push(t[i])}return e},_filterInlinesInside:function(t){for(var e=[],i=0;i<t.length;i++)L(t[i],!0)&&e.push(t[i]);return e},_isTextSelected:function(t,e){var i=t.nodeType!==9?this.utils.removeInvisibleChars(t.textContent):"";return e===i||i.search(e)!==-1||e.search(new RegExp("^"+this.utils.escapeRegExp(i)+"$"))!==-1},_isInlineNode:function(t){var e=this.inspector.parse(t);return this.inspector.isInlineTag(t.tagName)&&e.isInEditor()},_clearSaved:function(){this.saved=!1,this.savedComponent=!1,this.savedElement=!1}}),r.add("service","element",{init:function(t){this.app=t,this.rootElement=t.rootElement,this.$element={},this.type="inline"},start:function(){this._build(),this._buildType()},isType:function(t){return t===this.type},getType:function(){return this.type},getElement:function(){return this.$element},_build:function(){this.$element=r.dom(this.rootElement)},_buildType:function(){var t=this.$element.get().tagName;this.type=t==="TEXTAREA"?"textarea":this.type,this.type=t==="DIV"?"div":this.type,this.type=this.opts.inline?"inline":this.type}}),r.add("service","editor",{init:function(t){this.app=t,this.scrolltop=!1,this.pasting=!1},start:function(){this._build()},focus:function(){this.isFocus()||this._isContenteditableFocus()||(this.saveScroll(),this.$editor.focus(),this.restoreScroll())},startFocus:function(){this.caret.setStart(this.getFirstNode())},endFocus:function(){this.caret.setEnd(this.getLastNode())},isPasting:function(){return this.pasting},enablePasting:function(){this.pasting=!0},disablePasting:function(){this.pasting=!1},saveScroll:function(){this.scrolltop=this._getScrollTarget().scrollTop(),this.opts.maxHeight&&(this.scrolltopin=this.$editor.scrollTop())},restoreScroll:function(){this.scrolltop!==!1&&(this._getScrollTarget().scrollTop(this.scrolltop),this.scrolltop=!1),this.scrolltopin&&(this.$editor.scrollTop(this.scrolltopin),this.scrolltopin=!1)},disableNonEditables:function(){this.$noneditables=this.$editor.find("[contenteditable=false]"),this.$noneditables.attr("contenteditable",!0)},enableNonEditables:function(){this.$noneditables&&setTimeout((function(){this.$noneditables.attr("contenteditable",!1)}).bind(this),1)},getFirstNode:function(){return this.$editor.contents()[0]},getLastNode:function(){var t=this.$editor.contents();return t[t.length-1]},isSourceMode:function(){return this.source.getElement().hasClass("redactor-source-open")},isEditor:function(t){return r.dom(t).get()===this.$editor.get()},isEmpty:function(t){return this.utils.isEmptyHtml(this.$editor.html(),!1,t)},isFocus:function(){var t=r.dom(document.activeElement);return this.$editor.find(".redactor-component-active").length!==0||t.closest(".redactor-in-"+this.uuid).length!==0},setEmpty:function(){this.$editor.html(this.opts.emptyHtml)},getElement:function(){return this.$editor},_build:function(){var t=this.element.getElement(),e=this.element.isType("textarea")?"<div>":t.get();this.$editor=r.dom(e)},_getScrollTarget:function(){var t=this.$doc;return t=this.opts.toolbarFixedTarget!==document?r.dom(this.opts.toolbarFixedTarget):this.opts.scrollTarget?r.dom(this.opts.scrollTarget):t},_isContenteditableFocus:function(){var t=this.selection.getBlock();return(t?r.dom(t).closest("[contenteditable=true]").not(".redactor-in"):[]).length!==0}}),r.add("service","container",{init:function(t){this.app=t},start:function(){this._build()},getElement:function(){return this.$container},_build:function(){var t=this.element.isType("inline")?"<span>":"<div>";this.$container=r.dom(t)}}),r.add("service","source",{init:function(t){this.app=t,this.$source={},this.content=""},start:function(){this._build(),this._buildName(),this._buildStartedContent()},getElement:function(){return this.$source},getCode:function(){return this.$source.val()},getName:function(){return this.$source.attr("name")},getStartedContent:function(){return this.content},setCode:function(t){return this.insertion.set(t,!0,!1)},isNameGenerated:function(){return this.name},rebuildStartedContent:function(){this._buildStartedContent()},_build:function(){var t=this.element.getElement(),e=this.element.isType("textarea")?t.get():"<textarea>";this.$source=r.dom(e)},_buildName:function(){var t=this.element.getElement();this.name=t.attr("name"),this.$source.attr("name",this.name?this.name:"content-"+this.uuid)},_buildStartedContent:function(){var t=this.element.getElement(),e=this.element.isType("textarea")?t.val():t.html();this.content=e.trim()}}),r.add("service","statusbar",{init:function(t){this.app=t,this.$statusbar={},this.items=[]},start:function(){this.$statusbar=r.dom("<ul>"),this.$statusbar.attr("dir",this.opts.direction)},add:function(t,e){return this.update(t,e)},update:function(t,e){var i;return this.items[t]!==void 0?i=this.items[t]:(i=r.dom("<li>"),this.$statusbar.append(i),this.items[t]=i),i.html(e)},get:function(t){return!!this.items[t]&&this.items[t]},remove:function(t){this.items[t]&&(this.items[t].remove(),delete this.items[t])},getItems:function(){return this.items},removeItems:function(){this.items={},this.$statusbar.html("")},getElement:function(){return this.$statusbar}}),r.add("service","toolbar",{init:function(t){this.app=t,this.buttons=[],this.dropdownOpened=!1,this.buttonsObservers={}},start:function(){this.is()&&(this.opts.activeButtons=this.opts.activeButtonsAdd?this._extendActiveButtons():this.opts.activeButtons,this.create())},stopObservers:function(){this.buttonsObservers={}},create:function(){this.$wrapper=r.dom("<div>"),this.$toolbar=r.dom("<div>")},observe:function(){if(this.is()){var t,e;for(var i in this.setButtonsInactive(),this.buttonsObservers)e=this.buttonsObservers[i],t=this.getButton(i),this.app.broadcast("button."+e+".observe",t);var s=this.opts.activeButtons,n=this.selection.getInlinesAllSelected(),o=this.selection.getInline(),a=this.selection.getInlineAll();this.selection.isCollapsed()&&(o&&n.push(o),a.length!==0&&(n=n.concat(a)));var l=this._inlinesToTags(n);for(var h in s)l.indexOf(h)!==-1&&(t=this.getButton(s[h]))&&t.setActive()}},is:function(){return!(!this.opts.toolbar||this.detector.isMobile()&&this.opts.air)},isAir:function(){return!!this.is()&&this.$toolbar.hasClass("redactor-air")},isFixed:function(){return!!this.is()&&this.$toolbar.hasClass("redactor-toolbar-fixed")},isContextBar:function(){return this.$body.find("#redactor-context-toolbar-"+this.uuid).hasClass("open")},isTarget:function(){return this.opts.toolbarFixedTarget!==document},getElement:function(){return this.$toolbar},getWrapper:function(){return this.$wrapper},getDropdown:function(){return this.dropdownOpened},getTargetElement:function(){return r.dom(this.opts.toolbarFixedTarget)},getButton:function(t){var e=this._findButton(".re-"+t);return e.length!==0&&e.dataget("data-button-instance")},getButtons:function(){var t=[];return this._findButtons().each(function(e){var i=r.dom(e);t.push(i.dataget("data-button-instance"))}),t},getButtonsKeys:function(){var t=[];return this._findButtons().each(function(e){var i=r.dom(e);t.push(i.attr("data-re-name"))}),t},addButton:function(t,e,i,s,n){i=i||"end";var o=r.create("toolbar.button",this.app,t,e);if(e.observe&&(this.opts.activeButtonsObservers[t]={observe:e.observe,button:o}),this.is())if(i==="first")this.$toolbar.prepend(o);else if(i==="after")s.after(o);else if(i==="before")s.before(o);else{var a=this.opts.buttons.indexOf(t);if(n!==!0&&a!==-1)if(a===0)this.$toolbar.prepend(o);else{var l=this._findButtons().eq(a-1);0<l.length?l.after(o):this.$toolbar.append(o)}else this.$toolbar.append(o)}return o},addButtonFirst:function(t,e){return this.addButton(t,e,"first")},addButtonAfter:function(t,e,i){var s=this.getButton(t);return s?this.addButton(e,i,"after",s):this.addButton(e,i)},addButtonBefore:function(t,e,i){var s=this.getButton(t);return s?this.addButton(e,i,"before",s):this.addButton(e,i)},addButtonObserver:function(t,e){this.buttonsObservers[t]=e},setButtons:function(t){this.buttons=t},setDropdown:function(t){this.dropdownOpened=t},setButtonsInactive:function(){for(var t=this.getButtons(),e=0;e<t.length;e++)t[e].setInactive()},setButtonsActive:function(){for(var t=this.getButtons(),e=0;e<t.length;e++)t[e].setActive()},disableButtons:function(){for(var t=this.getButtons(),e=0;e<t.length;e++)t[e].disable()},enableButtons:function(){for(var t=this.getButtons(),e=0;e<t.length;e++)t[e].enable()},_findButton:function(t){return this.is()?this.$toolbar.find(t):r.dom()},_findButtons:function(){return this.is()?this.$toolbar.find(".re-button"):r.dom()},_extendActiveButtons:function(){return r.extend({},this.opts.activeButtons,this.opts.activeButtonsAdd)},_inlinesToTags:function(t){for(var e=[],i=0;i<t.length;i++)e.push(t[i].tagName.toLowerCase());return e}}),r.add("class","toolbar.button",{mixins:["dom"],init:function(t,e,i){this.app=t,this.opts=t.opts,this.lang=t.lang,this.$body=t.$body,this.toolbar=t.toolbar,this.detector=t.detector,this.obj=i,this.name=e,this.dropdown=!1,this.tooltip=!1,this._init()},isActive:function(){return this.hasClass("redactor-button-active")},isDisabled:function(){return this.hasClass("redactor-button-disabled")},hasIcon:function(){return this.obj.icon&&!this.opts.buttonsTextLabeled},setDropdown:function(t){this.obj.dropdown=t,this.obj.message=!1,this.dropdown=r.create("toolbar.dropdown",this.app,this.name,this.obj.dropdown),this.attr("data-dropdown",!0)},setMessage:function(t,e){this.obj.message=t,this.obj.args=e,this.obj.dropdown=!1},setApi:function(t,e){this.obj.api=t,this.obj.args=e,this.obj.dropdown=!1},setTitle:function(t){this.obj.title=this.lang.parse(t),this.obj.tooltip=this.obj.title,this.attr({alt:this.obj.tooltip,"aria-label":this.obj.tooltip}),this.attr("data-re-icon")||this.html(this.obj.title)},setTooltip:function(t){this.obj.tooltip=this.lang.parse(t),this.attr({alt:this.obj.tooltip,"aria-label":this.obj.tooltip})},setIcon:function(t){this.opts.buttonsTextLabeled||(this.obj.icon=!0,this.$icon=r.dom(t),this.html(""),this.append(this.$icon),this.attr("data-re-icon",!0),this.addClass("re-button-icon"),this.setTooltip(this.obj.title),this._buildTooltip())},setActive:function(){this.addClass("redactor-button-active")},setInactive:function(){this.removeClass("redactor-button-active")},hideTooltip:function(){this.$body.find(".re-button-tooltip").remove()},getDropdown:function(){return this.dropdown},disable:function(){this.addClass("redactor-button-disabled")},enable:function(){this.removeClass("redactor-button-disabled")},toggle:function(t){t&&t.preventDefault(),this.isDisabled()||(this.obj.dropdown?this.dropdown.toggle(t):this.obj.api?this.app.api(this.obj.api,this.obj.args,this.name):this.obj.message&&this.app.broadcast(this.obj.message,this.obj.args,this.name),this.hideTooltip())},_init:function(){this._parseTitle(),this._parseTooltip(),this._build(),this._buildCallback(),this._buildAttributes(),this._buildObserver(),this.hasIcon()?(this._buildIcon(),this._buildTooltip()):this.html(this.obj.title)},_parseTooltip:function(){this.obj.tooltip=this.obj.tooltip?this.lang.parse(this.obj.tooltip):this.obj.title},_parseTitle:function(){this.obj.title=this.lang.parse(this.obj.title)},_build:function(){this.parse("<a>"),this.addClass("re-button re-"+this.name),this.attr("data-re-name",this.name),this.dataset("data-button-instance",this),this.obj.dropdown&&this.setDropdown(this.obj.dropdown)},_buildCallback:function(){this.on("click",this.toggle.bind(this))},_buildAttributes:function(){var t={href:"#",alt:this.obj.tooltip,rel:this.name,role:"button","aria-label":this.obj.tooltip,tabindex:"-1"};this.attr(t)},_buildObserver:function(){this.obj.observe!==void 0&&this.toolbar.addButtonObserver(this.name,this.obj.observe)},_buildIcon:function(){var t=this.obj.icon,e=/(<([^>]+)>)/gi.test(t);this.$icon=r.dom(e?t:"<i>"),e||this.$icon.addClass("re-icon-"+this.name),this.append(this.$icon),this.attr("data-re-icon",!0),this.addClass("re-button-icon")},_buildTooltip:function(){this.detector.isDesktop()&&(this.tooltip=r.create("toolbar.button.tooltip",this.app,this))}}),r.add("class","toolbar.button.tooltip",{mixins:["dom"],init:function(t,e){this.app=t,this.uuid=t.uuid,this.opts=t.opts,this.$body=t.$body,this.toolbar=t.toolbar,this.$button=e,this.created=!1,this._init()},open:function(){if(!this.$button.hasClass("redactor-button-disabled")&&!this.$button.hasClass("redactor-button-active")){this.created=!0,this.parse("<span>"),this.addClass("re-button-tooltip re-button-tooltip-"+this.uuid),this.$body.append(this),this.html(this.$button.attr("alt"));var t=this.$button.offset(),e=this.$button.height(),i=this.$button.width();this.css({top:t.top+e+4+"px",left:t.left+i/2-this.width()/2+"px",position:"absolute"}),this.show()}},close:function(){this.created&&!this.$button.hasClass("redactor-button-disabled")&&(this.remove(),this.created=!1)},_init:function(){this.$button.on("mouseover",this.open.bind(this)),this.$button.on("mouseout",this.close.bind(this))}}),r.add("class","toolbar.dropdown",{mixins:["dom"],init:function(t,e,i){this.app=t,this.uuid=t.uuid,this.opts=t.opts,this.$win=t.$win,this.$doc=t.$doc,this.$body=t.$body,this.animate=t.animate,this.toolbar=t.toolbar,this.name=e,this.started=!1,this.items=e==="format"?r.extend({},!0,i):i,this.$items=[]},toggle:function(t){this.started||this._build(),this.isOpened()&&this.isActive()?this.close(!1):this.open(t)},isOpened:function(){var t=this.$body.find(".redactor-dropdown-"+this.uuid+".open");return t.length!==0&&t.attr("data-re-name")===this.name},isActive:function(){return this.$body.find("#redactor-dropdown-"+this.uuid+"-"+this.name+".open").length!==0},getName:function(){return this.attr("data-re-name")},getItem:function(t){return this.$items[t]},getItemsByClass:function(t){var e=[];for(var i in this.$items){var s=this.$items[i];typeof s=="object"&&s.attr("data-re-name")&&s.hasClass(t)&&e.push(s)}return e},open:function(t){this._closeAll(),this.$btn=this.toolbar.getButton(this.name),this.app.broadcast("dropdown.open",t,this,this.$btn),this.toolbar.setDropdown(this),this.show(),this.removeClass("redactor-animate-hide"),this.addClass("open"),this._observe(),this.$btn.hideTooltip(),this.$btn.setActive(),this.$doc.on("keyup.redactor.dropdown-"+this.uuid,this._handleKeyboard.bind(this)),this.$doc.on("click.redactor.dropdown-"+this.uuid,this.close.bind(this)),this.updatePosition(),this.app.broadcast("dropdown.opened",t,this,this.$btn)},close:function(t,e){if(t){var i=r.dom(t.target);if(this._isButton(t)||i.hasClass("redactor-dropdown-not-close")||i.hasClass("redactor-dropdown-item-disabled"))return void t.preventDefault()}this.app.broadcast("dropdown.close",this,this.$btn),this.toolbar.setDropdown(!1),this.$btn.setInactive(),e===!1?this._close():this.animate.start(this,"fadeOut",this._close.bind(this))},updatePosition:function(){this.toolbar.isFixed(),this.toolbar.isTarget();var t=this.$btn.height(),e=this.$btn.width(),i=this.$btn.offset(),s=i.left+0,n=parseFloat(this.css("width")),o=s-(this.$win.width()<s+n?n-e:0),a=i.top+t+2;o=o<0?4:o,this.css({maxHeight:"",position:"absolute",top:a+"px",left:o+"px"});var l=this.$win.height()-(a-this.$doc.scrollTop())-10;this.css("max-height",l+"px")},_build:function(){this.parse("<div>"),this.attr("dir",this.opts.direction),this.attr("id","redactor-dropdown-"+this.uuid+"-"+this.name),this.attr("data-re-name",this.name),this.addClass("redactor-dropdown redactor-dropdown-"+this.uuid+" redactor-dropdown-"+this.name),this.dataset("data-dropdown-instance",this),this.items.sdom||typeof this.items=="string"?this._buildDom():this._buildItems(),this.$body.append(this),this.started=!0},_buildDom:function(){this.html("").append(r.dom(this.items))},_buildItems:function(){for(var t in this.items=this.name==="format"?this._buildFormattingItems():this.items,this.items){var e=this.items[t];if(t==="observe")this.attr("data-observe",this.items[t]);else{var i=r.create("toolbar.dropdown.item",this.app,t,e,this);this.$items[t]=i,this.append(i)}}},_buildFormattingItems:function(){for(var t in this.items)this.opts.formatting.indexOf(t)===-1&&delete this.items[t];if(this.opts.formattingHide)for(var t in this.items)this.opts.formattingHide.indexOf(t)!==-1&&delete this.items[t];if(this.opts.formattingAdd)for(var t in this.opts.formattingAdd)this.items[t]=this.opts.formattingAdd[t];return this.items},_handleKeyboard:function(t){t.which===27&&this.close()},_isButton:function(t){return r.dom(t.target).closest(".re-button").get()===this.$btn.get()},_close:function(){this.$btn.setInactive(),this.$doc.off(".redactor.dropdown-"+this.uuid),this.removeClass("open"),this.addClass("redactor-animate-hide"),this.app.broadcast("dropdown.closed",this,this.$btn)},_closeAll:function(){this.$body.find(".redactor-dropdown-"+this.uuid+".open").each(function(t){r.dom(t).dataget("data-dropdown-instance")._close()})},_observe:function(){var t=this.attr("data-observe");t&&this.app.broadcast("dropdown."+t+".observe",this)}}),r.add("class","toolbar.dropdown.item",{mixins:["dom"],init:function(t,e,i,s){this.app=t,this.lang=t.lang,this.dropdown=s,this.name=e,this.obj=i,this._init()},setTitle:function(t){this.$span.html(t)},getTitle:function(){return this.$span.html()},enable:function(){this.removeClass("redactor-dropdown-item-disabled")},disable:function(){this.addClass("redactor-dropdown-item-disabled")},toggle:function(t){t&&t.preventDefault(),this.hasClass("redactor-dropdown-item-disabled")||(this.obj.message?this.app.broadcast(this.obj.message,this.obj.args,this.name):this.obj.api&&this.app.api(this.obj.api,this.obj.args,this.name))},_init:function(){this.parse("<a>"),this.attr("href","#"),this.addClass("redactor-dropdown-item-"+this.name),this.obj.classname&&this.addClass(this.obj.classname),this.attr("data-re-name",this.name),this.on("click",this.toggle.bind(this)),this.$span=r.dom("<span>"),this.append(this.$span),this.setTitle(this.lang.parse(this.obj.title))}}),r.add("service","cleaner",{init:function(t){this.app=t,this.opts=t.opts,this.storedComponents=[],this.storedComments=[],this.storedImages=[],this.storedLinks=[],this.deniedTags=["font","html","head","link","title","body","meta","applet"],this.convertRules={},this.unconvertRules={},this.reComments=/<!--[\s\S]*?-->\n?/g,this.reSpacedEmpty=/^(||\s||<br\s?\/?>||&nbsp;)$/i,this.reScriptTag=/<script(.*?[^>]?)>([\w\W]*?)<\/script>/gi},addConvertRules:function(t,e){this.convertRules[t]=e},addUnconvertRules:function(t,e){this.unconvertRules[t]=e},input:function(t,e,i){t=t.replace(/¤t/gi,"&current");var s=[];t=this.storeComments(t,s),t=this.encodeCode(t);var n=this.utils.buildWrapper(t);n.find("a, b, i, strong, em, img, svg, details, audio").removeAttr("onload onerror ontoggle onwheel onmouseover oncopy"),n.find("a, iframe, embed").each(function(a){var l=r.dom(a),h=l.attr("href"),c=l.attr("src");h&&h.trim().search(/^data|javascript:/i)!==-1&&l.attr("href",""),c&&c.trim().search(/^data|javascript:/i)!==-1&&l.attr("src","")});var o=["alt","title","src","class","width","height","srcset","style","usemap"];return n.find("img").each((function(a){if(0<a.attributes.length)for(var l=a.attributes,h=l.length-1;0<=h;h--){var c=l[h].name.search(/^data-/)===-1&&o.indexOf(l[h].name)===-1,d=l[h].name==="src"&&l[h].value.search(/^data|javascript:/i)!==-1;this.opts.imageSrcData&&(d=!1),(c||d)&&a.removeAttribute(l[h].name)}}).bind(this)),t=(t=(t=this.utils.getWrapperHtml(n)).replace(/\$/g,"&#36;")).replace(/&amp;/g,"&"),t=r.create("cleaner.figure",this.app).convert(t,this.convertRules),t=this.storeComponents(t),t=this.replaceTags(t,this.opts.replaceTags),t=this._setSpanAttr(t),t=this._setStyleCache(t),t=this.removeTags(t,this.deniedTags),t=this.opts.removeScript?this._removeScriptTag(t):this._replaceScriptTag(t),t=this.opts.removeComments?this.removeComments(t):t,t=this._isSpacedEmpty(t)?this.opts.emptyHtml:t,t=this.restoreComponents(t),t=this._cleanWrapped(t),t=this.restoreComments(t,s),t=e?this.paragraphize(t):t},output:function(t,e){return t=this.removeInvisibleSpaces(t),this.opts.breakline&&(t=(t=t.replace(/<\/(span|strong|b|i|em)><br\s?\/?><\/div>/gi,"</$1></div>")).replace(/<br\s?\/?><\/(span|strong|b|i|em)><\/div>/gi,"</$1></div>")),t=t.replace(/&#36;/g,"$"),this._isSpacedEmpty(t)||this._isParagraphEmpty(t)?"":(t=this.removeServiceTagsAndAttrs(t,e),t=this.storeComponents(t),t=this.removeSpanWithoutAttributes(t),t=this.removeFirstBlockBreaklineInHtml(t),t=this.opts.removeScript?t:this._unreplaceScriptTag(t),t=this.opts.preClass?this._setPreClass(t):t,t=this.opts.linkNofollow?this._setLinkNofollow(t):t,t=this.opts.removeNewLines?this.cleanNewLines(t):t,t=this.restoreComponents(t),t=r.create("cleaner.figure",this.app).unconvert(t,this.unconvertRules),t=this.removeEmptyAttributes(t,["style","class","rel","alt","title"]),t=this.cleanSpacesInPre(t),t=(t=this.tidy(t)).replace(/&amp;/g,"&"),this.opts.breakline&&(t=(t=t.replace(/<br\s?\/?>/gi,`<br>
`)).replace(/<br\s?\/?>\n+/gi,`<br>
`)),t=t.replace(/\n/g,"")===""?"":t)},paste:function(t){t=(t=this.storeComponents(t)).replace(/<!--[\s\S]*?-->/g,"");var e=this.deniedTags.concat(["iframe"]);t=(t=(t=(t=this.removeTags(t,e)).replace(new RegExp("<!doctype([\\s\\S]+?)>","gi"),"")).replace(new RegExp("<style([\\s\\S]+?)</style>","gi"),"")).replace(new RegExp("</p><br /><p","gi"),"</p><p");var i=this._isHtmlMsWord(t);if(t=i?t:this._cleanGDocs(t),t=i?this._cleanMsWord(t):t,!this.opts.pasteClean)return t=this.restoreComponents(t);if(this.opts.pastePlainText)return t=this.restoreComponents(t),this.pastePlainText(t);(n=this.utils.buildWrapper(t)).find("*").removeAttr("style"),n.find("[data-redactor-tag]").each((function(d){var u=r.dom(d);u.removeAttr("data-redactor-tag"),this.utils.isEmptyHtml(u.html())?u.html("<br>").unwrap():d.lastChild&&d.lastChild.tagName==="BR"?u.unwrap():u.append("<br>").unwrap()}).bind(this)),t=(t=(t=this.utils.getWrapperHtml(n)).replace(/<br\s?\/?>$/,"")).replace(/<br\s?\/?><\/(td|th)>/,"</$1>");var s=this.opts.pasteBlockTags.concat(this.opts.pasteInlineTags);t=this.removeTagsExcept(t,s),t=this.opts.pasteLinks?t:this.removeTags(t,["a"]),t=this.opts.pasteImages?t:this.removeTags(t,["img"]);var n,o=(n=this.utils.buildWrapper(t)).find("*"),a=this.opts.pasteKeepStyle.length!==0?","+this.opts.pasteKeepStyle.join(","):"";o.not("[data-redactor-style-cache]"+a).removeAttr("style");var l=this.opts.pasteKeepClass.length!==0?","+this.opts.pasteKeepClass.join(","):"";o.not("[data-redactor-style-cache], span.redactor-component"+l).removeAttr("class");var h=this.opts.pasteKeepAttrs.length!==0?","+this.opts.pasteKeepAttrs.join(","):"";o.not("img, a, span.redactor-component, [data-redactor-style-cache]"+h).each(function(d){for(var u=d.attributes,p=u.length-1;0<=p;p--)d.attributes[p].name!=="class"&&d.attributes[p].name!=="dir"&&d.removeAttribute(u[p].name)}),this.opts.pasteLinks&&this.opts.pasteLinkTarget!==!1&&n.find("a").attr("target",this.opts.pasteLinkTarget),n.find("[data-redactor-style-cache]").each(function(d){var u=d.getAttribute("data-redactor-style-cache");d.setAttribute("style",u)});var c=this.opts.imageAttrs;return n.find("img").each(function(d){if(0<d.attributes.length)for(var u=d.attributes,p=u.length-1;0<=p;p--)c.indexOf(u[p].name)===-1&&d.removeAttribute(u[p].name)}),n.find("span").each(function(d){d.attributes.length===0&&r.dom(d).unwrap()}),n.find(this.opts.inlineTags.join(",")).each((function(d){d.attributes.length===0&&this.utils.isEmptyHtml(d.innerHTML)&&r.dom(d).unwrap()}).bind(this)),n.find("ul, ol").each(function(d){var u=d.previousSibling;if(u&&u.tagName==="LI"){var p=r.dom(u);p.find("p").unwrap(),p.append(d)}}),t=(t=(t=(t=(t=this.utils.getWrapperHtml(n)).replace(/<li><p>/gi,"<li>")).replace(/<\/p><\/li>/gi,"</li>")).replace(/^<li/gi,"<ul><li")).replace(/<\/li>$/gi,"</li></ul>"),this.opts.breakline&&(t=t.replace(/\n/g,"<br>")),t=(t=t.replace(/<p>&nbsp;<\/p>/gi,"<p></p>")).replace(/<p><br\s?\/?><\/p>/gi,"<p></p>"),i&&(t=(t=(t=t.replace(/<p><\/p>/gi,"")).replace(/<p>\s<\/p>/gi,"")).replace(/<td\n/gi,"<td ")),t=this.restoreComponents(t)},pastePlainText:function(t){return t=this.opts.pasteLinks?this.storeLinks(t):t,t=this.opts.pasteImages?this.storeImages(t):t,t=this.getPlainText(t),t=this._replaceNlToBr(t),t=this.opts.pasteLinks?this.restoreLinks(t):t,t=this.opts.pasteImages?this.restoreImages(t):t},tidy:function(t){return t},paragraphize:function(t){return t=r.create("cleaner.paragraphize",this.app).convert(t)},storeComments:function(t,e){var i=t.match(new RegExp("<!--([\\w\\W]*?)-->","gi"));if(i!==null)for(var s=0;s<i.length;s++)t=t.replace(i[s],"#####xstarthtmlcommentzz"+s+"xendhtmlcommentzz#####"),e.push(i[s]);return t},restoreComments:function(t,e){for(var i=0;i<e.length;i++)t=t.replace("#####xstarthtmlcommentzz"+i+"xendhtmlcommentzz#####",e[i]);return t},getFlatText:function(t){var e=r.dom("<div>");return t.nodeType||t.dom?e.append(t):(t=(t=t.toString()).trim(),e.html(t)),(t=e.get().textContent||e.get().innerText||"")===void 0?"":t},getPlainText:function(t){t=(t=(t=(t=(t=(t=t.replace(/<!--[\s\S]*?-->/gi,"")).replace(/<style[\s\S]*?style>/gi,"")).replace(/<p><\/p>/g,"")).replace(/<\/div>|<\/li>|<\/td>/gi,`
`)).replace(/<\/p>/gi,`

`)).replace(/<\/H[1-6]>/gi,`

`);var e=document.createElement("div");return e.innerHTML=t,(t=e.textContent||e.innerText).trim()},replaceTags:function(t,e){if(e){var i=this,s=Object.keys(e),n=this.utils.buildWrapper(t);n.find(s.join(",")).each(function(o){i.utils.replaceToTag(o,e[o.tagName.toLowerCase()])}),t=this.utils.getWrapperHtml(n)}return t},replaceNbspToSpaces:function(t){return t.replace("&nbsp;"," ")},replaceBlocksToBr:function(t){return t=(t=(t=t.replace(/<div[^>]*><\/div>/gi,"")).replace(/<td[^>]*><\/td>/gi,"")).replace(/<\/div>|<\/li>|<\/td>|<\/p>|<\/H[1-6]>/gi,"<br>")},cleanNewLines:function(t){return t.replace(/\r?\n/g,"")},cleanSpacesInPre:function(t){return t.replace("&nbsp;&nbsp;&nbsp;&nbsp;","    ")},removeInvisibleSpaces:function(t){return t=(t=this.utils.removeInvisibleChars(t)).replace(/&#65279;/gi,"")},removeNl:function(t){return t=(t=t.replace(/\n/g," ")).replace(/\s+/g,"s")},removeBrAtEnd:function(t){return t=(t=t.replace(/<br\s?\/?>$/gi," ")).replace(/<br\s?\/?><li/gi,"<li")},removeTags:function(t,e){var i=e?/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi:/(<([^>]+)>)/gi,s=e?function(n,o){return e.indexOf(o.toLowerCase())===-1?n:""}:"";return t.replace(i,s)},removeTagsExcept:function(t,e){return e===void 0?t.replace(/(<([^>]+)>)/gi,""):t.replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,function(i,s){return e.indexOf(s.toLowerCase())===-1?"":i})},removeComments:function(t){return t.replace(this.reComments,"")},removeServiceTagsAndAttrs:function(t,e){var i=this.utils.buildWrapper(t),s=this;return e!==!1&&i.find(".redactor-selection-marker").each(function(n){var o=r.dom(n);return s.utils.removeInvisibleChars(o.text())===""?o.remove():o.unwrap()}),i.find("[data-redactor-style-cache]").removeAttr("data-redactor-style-cache"),this.utils.getWrapperHtml(i)},removeSpanWithoutAttributes:function(t){var e=this.utils.buildWrapper(t);return e.find("span").removeAttr("data-redactor-span data-redactor-style-cache").each(function(i){i.attributes.length===0&&r.dom(i).unwrap()}),this.utils.getWrapperHtml(e)},removeFirstBlockBreaklineInHtml:function(t){return t.replace(new RegExp("</li><br\\s?/?>","gi"),"</li>")},removeEmptyAttributes:function(t,e){for(var i=this.utils.buildWrapper(t),s=0;s<e.length;s++)i.find("["+e[s]+'=""]').removeAttr(e[s]);return this.utils.getWrapperHtml(i)},encodeHtml:function(t){return t=(t=(t=(t=(t=(t=t.replace(/<br\s?\/?>/g,`
`)).replace(/&nbsp;/g," ")).replace(/”/g,'"')).replace(/“/g,'"')).replace(/‘/g,"'")).replace(/’/g,"'"),t=(t=this.encodeEntities(t)).replace(/\$/g,"&#36;"),this.opts.preSpaces&&(t=t.replace(/\t/g,new Array(this.opts.preSpaces+1).join(" "))),t},encodeCode:function(t){return t=(t=(t=(t=(t=(t=(t=(t=this.encodeAttrSings(t)).replace(/<\s/gi,"&lt; ")).replace(/<([^>]+)</gi,"&lt;$1<")).replace(/<(.*?)>/gi,"xtagstartz$1xtagendz")).replace(/xtagstartzpre(.*?)xtagendz/g,"<pre$1>")).replace(/xtagstartzcode(.*?)xtagendz/g,"<code$1>")).replace(/xtagstartz\/codextagendz/g,"</code>")).replace(/xtagstartz\/prextagendz/g,"</pre>"),t=(t=(t=this._encodeCode(t)).replace(/xtagstartz([\w\W]*?)xtagendz/g,"<$1>")).replace(/xtagstartz\/(.*?)xtagendz/g,"</$1>"),t=this.decodeAttrSings(t)},_encodeCode:function(t){var e=this.utils.buildWrapper(t);return e.find("pre code, pre, code").each(this._encodeNode.bind(this)),this.utils.getWrapperHtml(e)},_encodeNode:function(t){var e=t.firstChild,i=t.innerHTML;if(t.tagName!=="PRE"||!e||e.tagName!=="CODE"){i=(i=i.replace(/xtagstartz/g,"<")).replace(/xtagendz/g,">");var s=this.decodeEntities(i);t.textContent=this._encodeNodeHtml(s)}},_encodeNodeHtml:function(t){return t=t.replace(/&nbsp;/g," ").replace(/<br\s?\/?>/g,`
`),t=this.opts.preSpaces?t.replace(/\t/g,new Array(this.opts.preSpaces+1).join(" ")):t},encodeAttrSings:function(t){var e=t.match(/="(.*?)"/g);if(e!==null){for(var i=0;i<e.length;i++)if(e[i].search(/^"</)===-1&&e[i].search(/>"$/)===-1){var s=e[i].replace(">","xmoresignz");s=s.replace("<","xlesssignz"),t=t.replace(e[i],s)}}return t},encodeEntities:function(t){return t=(t=this.decodeEntities(t)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},encodePhpCode:function(t){return t=(t=(t=t.replace("<?php","&lt;?php")).replace("<?","&lt;?")).replace("?>","?&gt;")},decodeAttrSings:function(t){return t=(t=t.replace(/xmoresignz/gi,">")).replace(/xlesssignz/gi,"<")},decodeEntities:function(t){return String(t).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},storeComponents:function(t){var e=this.utils.getElementsFromHtml(t,"figure","table");return this._storeMatched(t,e,"Components","figure")},restoreComponents:function(t){return this._restoreMatched(t,"Components","figure")},storeLinks:function(t){var e=this.utils.getElementsFromHtml(t,"a");return this._storeMatched(t,e,"Links","a")},storeImages:function(t){var e=this.utils.getElementsFromHtml(t,"img");return this._storeMatched(t,e,"Images","img")},restoreLinks:function(t){return this._restoreMatched(t,"Links","a")},restoreImages:function(t){return this._restoreMatched(t,"Images","img")},_cleanWrapped:function(t){return t=t.replace(new RegExp("<p><figure([\\w\\W]*?)</figure></p>","gi"),"<figure$1</figure>")},_cleanGDocs:function(t){return t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2")).replace(/<b(.*?)id="docs-internal-guid(.*?)">([\w\W]*?)<\/b>/gi,"$3")).replace(/<span[^>]*(font-style:\s?italic;\s?font-weight:\s?bold|font-weight:\s?bold;\s?font-style:\s?italic)[^>]*>([\w\W]*?)<\/span>/gi,"<b><i>$2</i></b>")).replace(/<span[^>]*(font-style:\s?italic;\s?font-weight:\s?600|font-weight:\s?600;\s?font-style:\s?italic)[^>]*>([\w\W]*?)<\/span>/gi,"<b><i>$2</i></b>")).replace(/<span[^>]*(font-style:\s?italic;\s?font-weight:\s?700|font-weight:\s?700;\s?font-style:\s?italic)[^>]*>([\w\W]*?)<\/span>/gi,"<b><i>$2</i></b>")).replace(/<span[^>]*font-style:\s?italic[^>]*>([\w\W]*?)<\/span>/gi,"<i>$1</i>")).replace(/<span[^>]*font-weight:\s?bold[^>]*>([\w\W]*?)<\/span>/gi,"<b>$1</b>")).replace(/<span[^>]*font-weight:\s?700[^>]*>([\w\W]*?)<\/span>/gi,"<b>$1</b>")).replace(/<span[^>]*font-weight:\s?600[^>]*>([\w\W]*?)<\/span>/gi,"<b>$1</b>")},_cleanMsWord:function(t){t=(t=(t=(t=(t=t.replace(/<!--[\s\S]+?-->/gi,"")).replace(/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|img|meta|link|style|\w:\w+)(?=[\s\/>]))[^>]*>/gi,"")).replace(/<(\/?)s>/gi,"<$1strike>")).replace(/&nbsp;/gi," ")).replace(/<span\s+style\s*=\s*"\s*mso-spacerun\s*:\s*yes\s*;?\s*"\s*>([\s\u00a0]*)<\/span>/gi,function(a,l){return 0<l.length?l.replace(/./," ").slice(Math.floor(l.length/2)).split("").join(" "):""});var e=this.utils.buildWrapper(t);e.find(".MsoFootnoteText").each(function(a){var l=r.dom(a),h=l.parent();h.length!==0&&h.attr("style").search(/mso-element:footnote/)!==-1&&l.find("a").attr("id","_"+h.attr("id"))}),e.find(".MsoFootnoteReference").each(function(a){var l=r.dom(a).parent();l.length!==0&&l.get().tagName==="A"&&l.attr("id",l.attr("name"))}),e.find("p").each(function(a){var l=r.dom(a),h=l.attr("style"),c=/mso-list:\w+ \w+([0-9]+)/.exec(h);c&&l.attr("data-listLevel",parseInt(c[1],10))}),this._parseWordLists(e),e.find("[align]").removeAttr("align"),e.find("[name]").removeAttr("name"),e.find("span").each(function(a){var l=r.dom(a),h=l.attr("style");/mso-list:Ignore/.exec(h)?l.remove():l.unwrap()}),e.find("[style]").removeAttr("style"),e.find("[class^='Mso']").removeAttr("class"),e.find("a").filter(function(a){return!a.hasAttribute("href")}).unwrap();for(var i="",s=(t=(t=(t=(t=(t=this.utils.getWrapperHtml(e)).replace(/<p[^>]*><\/p>/gi,"")).replace(/<li>·/gi,"<li>")).trim()).replace(/\/(p|ul|ol|h1|h2|h3|h4|h5|h6|blockquote)>\s+<(p|ul|ol|h1|h2|h3|h4|h5|h6|blockquote)/gi,`/$1>
<$2`)).split(/\n/),n=0;n<s.length;n++){var o=s[n]!==""&&s[n].search(/>$/)===-1?" ":`
`;i+=s[n]+o}return i},_parseWordLists:function(t){var e=0,i=null,s=null,n=null;t.find("p").each(function(o){var a=r.dom(o),l=a.attr("data-listLevel");if(l===null&&a.hasClass("MsoListParagraphCxSpMiddle")&&(l=1),l!==null){var h=a.text(),c=/^\s*\w+\./.test(h)?"<ol></ol>":"<ul></ul>";if(a.hasClass("MsoListParagraphCxSpFirst")||a.hasClass("MsoNormal")?(s=r.dom(c),a.before(s)):e<l&&e!==0&&(n=r.dom(c),i.append(n),s=n),l<e)for(var d=e-l+1,u=0;u<d;u++)s=s.parent();a.find("span").first().unwrap(),i=r.dom("<li>"+a.html().trim()+"</li>"),s===null&&(a.before(c),s=a.prev()),s.append(i),a.remove(),e=l}else s=null,e=0})},_isSpacedEmpty:function(t){return t.search(this.reSpacedEmpty)!==-1},_isParagraphEmpty:function(t){return t.search(/^<p><\/p>$/i)!==-1},_isHtmlMsWord:function(t){return t.match(/class="?Mso|style="[^"]*\bmso-|style='[^'']*\bmso-|w:WordDocument/i)},_setSpanAttr:function(t){var e=this.utils.buildWrapper(t);return e.find("span").attr("data-redactor-span",!0),this.utils.getWrapperHtml(e)},_setStyleCache:function(t){var e=this.utils.buildWrapper(t);return e.find("[style]").each(function(i){var s=r.dom(i);s.attr("data-redactor-style-cache",s.attr("style"))}),this.utils.getWrapperHtml(e)},_setPreClass:function(t){var e=this.utils.buildWrapper(t);return e.find("pre").addClass(this.opts.preClass),this.utils.getWrapperHtml(e)},_setLinkNofollow:function(t){var e=this.utils.buildWrapper(t);return e.find("a").attr("rel","nofollow"),this.utils.getWrapperHtml(e)},_replaceScriptTag:function(t){return t.replace(this.reScriptTag,'<script class="redactor-script-tag" $1>$2<\/script>')},_unreplaceScriptTag:function(t){return t.replace(/<script class="redactor-script-tag"(.*?[^>]?)>([\w\W]*?)<\/script>/gi,"<script$1>$2<\/script>")},_replaceNlToBr:function(t){return t.replace(/\n/g,"<br />")},_removeScriptTag:function(t){return t.replace(this.reScriptTag,"")},_storeMatched:function(t,e,i,s){if(this["stored"+i]=[],e)for(var n=0;n<e.length;n++)this["stored"+i][n]=e[n],t=t.replace(e[n],"####"+s+n+"####");return t},_restoreMatched:function(t,e,i){if(this["stored"+e])for(var s=0;s<this["stored"+e].length;s++)t=t.replace("####"+i+s+"####",this["stored"+e][s]);return t}}),r.add("class","cleaner.figure",{init:function(t){this.app=t,this.opts=t.opts,this.utils=t.utils,this.detector=t.detector},convert:function(t,e){var i=this.utils.buildWrapper(t);return i.find("img").each(this._convertImage.bind(this)),i.find("hr").each(this._convertLine.bind(this)),i.find("iframe").each(this._convertIframe.bind(this)),i.find("table").each(this._convertTable.bind(this)),i.find("form").each(this._convertForm.bind(this)),i.find("figure pre").each(this._convertCode.bind(this)),i.find("[data-redactor-type=variable]").addClass("redactor-component"),i.find("figure").not(".redactor-component, .redactor-figure-code").each(this._convertWidget.bind(this)),i.find("figure pre").each(this._setContenteditableCode.bind(this)),i.find(".redactor-component, .non-editable").attr("contenteditable",!1),this.detector.isIe()&&i.find("[data-redactor-type=table]").removeAttr("contenteditable"),i.find("figcaption, td, th").attr("contenteditable",!0),i.find(".redactor-component, figcaption").attr("tabindex","-1"),this._acceptExtraRules(i,e),this.utils.getWrapperHtml(i)},unconvert:function(t,e){t=(t=t.replace(/<\/([^>]+)><div data-redactor-tag/g,`</$1>
<div data-redactor-tag`)).replace(/<\/([^>]+)><p/g,`</$1>
<p`);var i=this.utils.buildWrapper(t);return i.find("th, td, figcaption, figure, pre, code, .redactor-component").removeAttr("contenteditable tabindex"),i.find("figure").removeClass("redactor-component redactor-component-active redactor-uploaded-figure"),i.find("[data-redactor-type=variable]").removeClass("redactor-component redactor-component-active"),i.find("figure[data-redactor-type=line]").unwrap(),i.find("figure[data-redactor-type=widget]").each(this._unconvertWidget.bind(this)),i.find("figure[data-redactor-type=form]").each(this._unconvertForm.bind(this)),i.find("figure[data-redactor-type=table]").each(this._unconvertTable.bind(this)),i.find("figure[data-redactor-type=image]").removeAttr("rel").each(this._unconvertImages.bind(this)),i.find("img").removeAttr("data-redactor-type").removeClass("redactor-component"),i.find(".non-editable").removeAttr("contenteditable"),i.find("figure").each(this._removeTypes.bind(this)),i.find("span.redactor-component-caret").remove(),i=this._unconvertBreakTag(i),this._acceptExtraRules(i,e),t=(t=(t=this.utils.getWrapperHtml(i)).replace(/<br\s?\/?>$/,"")).replace(/<br\s?\/?><\/(td|th)>/,"</$1>")},_convertImage:function(t){var e=r.dom(t);if(!this._isNonEditable(e)){this.opts.imageObserve&&!e.attr("data-image")&&e.attr("data-image",this.utils.getRandomId());var i=e.closest("a"),s=e.closest("figure");if(s.children().not("a, img, br, figcaption").length===0){if(s.length===0){var n=i.length!==0?i.closest("p"):e.closest("p");this.opts.imageFigure===!1&&n.length!==0?(s=this.utils.replaceToTag(n,"figure")).addClass("redactor-replace-figure"):(n.length!==0&&n.unwrap(),s=i.length!==0?i.wrap("<figure>"):e.wrap("<figure>"))}else s.hasClass("redactor-uploaded-figure")?s.removeClass("redactor-uploaded-figure"):s.addClass("redactor-keep-figure");this._setFigure(s,"image")}}},_convertTable:function(t){if(!this._isNonEditable(t)){var e=this._wrapFigure(t);this._setFigure(e,"table")}},_convertLine:function(t){if(!this._isNonEditable(t)){var e=this._wrapFigure(t);this._setFigure(e,"line")}},_convertForm:function(t){if(!this._isNonEditable(t)){var e=this.utils.replaceToTag(t,"figure");this._setFigure(e,"form")}},_convertIframe:function(t){if(!this._isNonEditable(t)&&r.dom(t).closest(".redactor-component").length===0){var e=t.getAttribute("src"),i=e&&(e.match(this.opts.regex.youtube)||e.match(this.opts.regex.vimeo)),s=this._wrapFigure(t);i&&this._setFigure(s,"video")}},_convertCode:function(t){if(!this._isNonEditable(t)){var e=this._wrapFigure(t);this._setFigure(e,"code")}},_convertWidget:function(t){if(!this._isNonEditable(t)){var e=r.dom(t);e.addClass("redactor-component"),e.attr("data-redactor-type","widget"),e.attr("data-widget-code",encodeURI(t.innerHTML.trim()))}},_unconvertBreakTag:function(t){return t.find("[data-redactor-tag]").each((function(e){var i=r.dom(e);if(i.removeAttr("data-redactor-tag"),e.attributes.length===0)if(e.lastChild&&e.lastChild.tagName==="BR")i.unwrap();else{var s=i.nextElement();s.length!==0&&s.attr("data-redactor-tag")&&e.appendChild(document.createElement("br")),i.unwrap()}else e.lastChild&&e.lastChild.tagName==="BR"&&r.dom(e.lastChild).remove()}).bind(this)),t},_unconvertForm:function(t){this.utils.replaceToTag(t,"form")},_unconvertTable:function(t){r.dom(t).unwrap()},_unconvertWidget:function(t){var e=r.dom(t);e.html(decodeURI(e.attr("data-widget-code"))),e.removeAttr("data-widget-code")},_unconvertImages:function(t){var e=r.dom(t);e.removeClass("redactor-component");var i=e.closest("li").length!==0,s=e.closest("table").length!==0,n=e.find("figcaption").length!==0,o=e.attr("style"),a=!(o===null||o===""),l=e.attr("class")!=="";!i&&(!s||n||a||l)||e.unwrap()},_removeTypes:function(t){var e=r.dom(t),i=e.attr("data-redactor-type");i&&["image","widget","line","video","code","form","table"].indexOf(i)!==-1&&e.removeAttr("data-redactor-type"),e.hasClass("redactor-keep-figure")?e.removeClass("redactor-keep-figure"):i==="image"&&this.opts.imageFigure===!1&&(e.find("figcaption").length!==0||(e.hasClass("redactor-replace-figure")&&e.removeClass("redactor-replace-figure"),this.utils.replaceToTag(e,"p"))),e.removeClass("redactor-replace-figure")},_wrapFigure:function(t){var e=r.dom(t),i=e.closest("figure");return i.length===0?e.wrap("<figure>"):i},_setFigure:function(t,e){t.addClass("redactor-component"),t.attr("data-redactor-type",e)},_setContenteditableCode:function(t){if(!this._isNonEditable(t)){var e=r.dom(t),i=e.children("code").first();(i.length!==0?i:e).attr("contenteditable",!0).attr("tabindex","-1")}},_acceptExtraRules:function(t,e){for(var i in e)typeof e[i]=="function"&&e[i](t)},_isNonEditable:function(t){return r.dom(t).closest(".non-editable").length!==0}}),r.add("class","cleaner.paragraphize",{init:function(t){this.app=t,this.opts=t.opts,this.utils=t.utils,this.cleaner=t.cleaner,this.element=t.element,this.stored=[],this.remStart="#####replace",this.remEnd="#####",this.paragraphizeTags=["table","div","pre","form","ul","ol","h1","h2","h3","h4","h5","h6","dl","blockquote","figcaption","address","section","header","footer","aside","article","object","style","script","iframe","select","input","textarea","button","option","map","area","math","hr","fieldset","legend","hgroup","nav","figure","details","menu","summary","p"]},convert:function(t){var e=this._isConverted(t);return e=e===!0?this._convert(t):e,e=this._convertTable(e)},_convert:function(t,e){var i=this.opts.breakline||e?"sdivtag":this.opts.markup,s=e?"tbr":"br";t=this._storeTags(t);var n=[];t=(t=this.cleaner.storeComments(t,n)).trim(),t=this._trimLinks(t);var o=this.opts.inlineTags.join("|");t=(t=(t=(t=(t=t.replace(new RegExp("<("+o+`)(.*?[^>]?)>
</(`+o+")>","gi"),"<$1$2></$3>")).replace(/xparagraphmarkerz(?:\r\n|\r|\n)$/g,"")).replace(/xparagraphmarkerz$/g,"")).replace(/xparagraphmarkerz(?:\r\n|\r|\n)/g,`
`)).replace(/xparagraphmarkerz/g,`
`);for(var a="",l=(t=this.opts.breakline?(t=(t=t.replace(/<br\s?\/?>(?:\r\n|\r|\n)/gi,`xbreakmarkerz
`)).replace(/<br\s?\/?>/gi,`xbreakmarkerz
`)).replace(/xbreakmarkerz\n<\//gi,"xbreakmarkerz</"):t.replace(/[\n]+/g,`
`)).split(`
`),h=0;h<l.length;h++)a+="<"+i+">"+l[h]+"</"+i+`>
`;return t=(t=(t=(t=a.replace(/\n$/,"")).replace(new RegExp("<"+i+">\\s+#####","gi"),"#####")).replace(new RegExp("<"+i+">#####","gi"),"#####")).replace(new RegExp("#####</"+i+">","gi"),"#####"),t=this.opts.breakline?t.replace(/xbreakmarkerz/gi,"<br>"):t,t=this._restoreTags(t),t=this.cleaner.restoreComments(t,n),this.opts.breakline&&(t=t.replace(new RegExp("<"+i+"></"+i+">","gi"),"<"+i+"><br></"+i+">")),t=(t=(t=t.replace(new RegExp("<sdivtag>","gi"),'<div data-redactor-tag="'+s+'">')).replace(new RegExp("sdivtag","gi"),"div")).replace(/<\/([^>]+)><div data-redactor-tag/g,`</$1>
<div data-redactor-tag`)},_convertTable:function(t){var e=this.utils.buildWrapper(t);return e.find("td, th").each(this._convertCell.bind(this)),t=this.utils.getWrapperHtml(e)},_convertCell:function(t){var e=r.dom(t);this.stored=[];var i=this._convert(e.html(),!0);e.html(i)},_storeTags:function(t){var e=this,i=this.utils.buildWrapper(t);return i.find(this.paragraphizeTags.join(", ")).each(function(s,n){var o=document.createTextNode(e.remStart+n+e.remEnd+"xparagraphmarkerz");e.stored.push(s.outerHTML),s.parentNode.replaceChild(o,s)}),this.utils.getWrapperHtml(i)},_restoreTags:function(t){for(var e=0;e<this.stored.length;e++)this.stored[e]=this.stored[e].replace(/\$/g,"&#36;"),t=t.replace(this.remStart+e+this.remEnd,this.stored[e]);return t},_trimLinks:function(t){var e=this.utils.buildWrapper(t);return e.find("a").each(this._trimLink.bind(this)),t=this.utils.getWrapperHtml(e)},_trimLink:function(t){var e=r.dom(t);e.html(e.html().trim())},_isConverted:function(t){return this._isDisabled(t)?t:!this._isEmptyHtml(t)||this.opts.emptyHtml},_isDisabled:function(){return this.opts.paragraphize===!1||this.element.isType("inline")},_isEmptyHtml:function(t){return t===""||t==="<p></p>"||t==="<div></div>"}}),r.add("service","detector",{init:function(t){this.app=t,this.userAgent=navigator.userAgent.toLowerCase()},isWebkit:function(){return/webkit/.test(this.userAgent)},isFirefox:function(){return-1<this.userAgent.indexOf("firefox")},isIe:function(t){return document.documentMode||/Edge/.test(navigator.userAgent)?"edge":RegExp("msie"+(isNaN(t)?"":"\\s"+t),"i").test(navigator.userAgent)||!!navigator.userAgent.match(/Trident.*rv[ :]*11\./)},isMobile:function(){return/(iPhone|iPod|Android)/.test(navigator.userAgent)},isDesktop:function(){return!/(iPhone|iPod|iPad|Android)/.test(navigator.userAgent)},isIpad:function(){return/iPad/.test(navigator.userAgent)}}),r.add("service","offset",{init:function(t){this.app=t},get:function(t,e){var i={start:0,end:0},s=this.utils.getNode(t);if(!s)return!1;var n=this.editor.isEditor(s),o=!!n||this.selection.isIn(s),a=this.selection.getRange();if(n||o){if(this.selection.is()&&o){var l=r.dom(a.startContainer).hasClass("redactor-component")?a.startOffset:0,h=a.cloneRange();h.selectNodeContents(s),h.setEnd(a.startContainer,a.startOffset);var c=this._getString(a,e);i.start=this._getString(h,e).length-l,i.end=i.start+c.length+l}}else i=!1;return i},set:function(t,e){if(!this._setComponentOffset(e)){this.component.clearActive();var i=this.utils.getNode(e);if(i){var s=this.size(i),n=0,o=document.createRange();t.end=t.end>s?s:t.end,o.setStart(i,0),o.collapse(!0);for(var a=[i],l=!1,h=!1;!h&&(i=a.pop());)if(i.nodeType===3){var c=n+i.length;!l&&!this._isFigcaptionNext(i)&&t.start>=n&&t.start<=c&&(o.setStart(i,t.start-n),l=!0),l&&t.end>=n&&t.end<=c&&(o.setEnd(i,t.end-n),h=!0),n=c}else for(var d=i.childNodes.length;d--;)a.push(i.childNodes[d]);this.selection.setRange(o)}}},size:function(t,e){var i=this.utils.getNode(t);if(i){var s=document.createRange().cloneRange();return s.selectNodeContents(i),this._getString(s,e).length}return 0},_getString:function(t,e){var i=t.toString();return i=this.editor.isEmpty()?i.replace(/\uFEFF/g,""):i,i=e?i.trim():i},_setComponentOffset:function(t){return!!this.component.isNonEditable(t)&&this.component.setActive(t)},_isFigcaptionNext:function(t){var e=t.nextSibling;return t.nodeValue.trim()===""&&e&&e.tagName==="FIGCAPTION"}}),r.add("service","inspector",{init:function(t){this.app=t},parse:function(t){return r.create("inspector.parser",this.app,this,t)},isText:function(t){if(typeof t=="string"&&!/^\s*<(\w+|!)[^>]*>/.test(t))return!0;var e=r.dom(t).get();return e&&e.nodeType===3},isInlineTag:function(t,e){var i=this._extendTags(this.opts.inlineTags,e);return this._isTag(t)&&i.indexOf(t.toLowerCase())!==-1},isBlockTag:function(t,e){var i=this._extendTags(this.opts.blockTags,e);return this._isTag(t)&&i.indexOf(t.toLowerCase())!==-1},isTableCellTag:function(t){return["td","th"].indexOf(t.toLowerCase())!==-1},isHeadingTag:function(t){return["h1","h2","h3","h4","h5","h6"].indexOf(t.toLowerCase())!==-1},_isTag:function(t){return t!==void 0&&t},_extendTags:function(t,e){if(t=t.concat(t),e)for(var i=0;i<e.length;i++)t.push(e[i]);return t}}),r.add("class","inspector.parser",{init:function(t,e,i){this.app=t,this.uuid=t.uuid,this.opts=t.opts,this.utils=t.utils,this.editor=t.editor,this.selection=t.selection,this.inspector=e;var s=this.editor.getElement();this.el=i,this.$el=r.dom(this.el,s),this.node=this.$el.get(),this.node&&this.node.nodeType===8&&(this.node=!1),this.$component=this.$el.closest(".redactor-component",s)},isEditor:function(){return this.node===this.editor.getElement().get()},isInEditor:function(){return this.$el.parents(".redactor-in-"+this.uuid).length!==0},isComponent:function(){return this.$component.length!==0},isComponentType:function(t){return this.getComponentType()===t},isComponentActive:function(){return this.isComponent()&&this.$component.hasClass("redactor-component-active")},isComponentEditable:function(){var t=this.getComponentType();return this.isComponent()&&["code","table"].indexOf(t)!==-1},isFigcaption:function(){return this.getFigcaption()},isPre:function(){return this.getPre()},isCode:function(){var t=this.$el.closest("code"),e=t.parent("pre");return t.length!==0&&e.length===0},isList:function(){return this.getList()},isFirstListItem:function(){return this._getLastOrFirstListItem("first")},isLastListItem:function(){return this._getLastOrFirstListItem("last")},isFirstTableCell:function(){return this._getLastOrFirstTableCell("first")},isLastTableCell:function(){return this._getLastOrFirstTableCell("last")},isTable:function(){return this.isComponentType("table")||this.getTable()},isHeading:function(){return this.getHeading()},isBlockquote:function(){return this.getBlockquote()},isDl:function(){return this.getDl()},isParagraph:function(){return this.getParagraph()},isLink:function(){return this.getLink()},isFile:function(){return this.getFile()},isText:function(){return this.inspector.isText(this.el)},isInline:function(){var t=this.opts.inlineTags;return!!this.isElement()&&t.indexOf(this.node.tagName.toLowerCase())!==-1},isBlock:function(){var t=this.opts.blockTags;return!!this.isElement()&&t.indexOf(this.node.tagName.toLowerCase())!==-1},isElement:function(){return this.node&&this.node.nodeType&&this.node.nodeType!==3},hasParent:function(t){return this.$el.closest(t.join(",")).length!==0},getNode:function(){return this.node},getTag:function(){return!!this.isElement()&&this.node.tagName.toLowerCase()},getComponent:function(){return!!this.isComponent()&&this.$component.get()},getComponentType:function(){return!!this.isComponent()&&this.$component.attr("data-redactor-type")},getFirstNode:function(){return this.utils.getFirstNode(this.node)},getLastNode:function(){return this.utils.getLastNode(this.node)},getFirstElement:function(){return this.utils.getFirstElement(this.node)},getLastElement:function(){return this.utils.getLastElement(this.node)},getFigcaption:function(){return this._getClosestNode("figcaption")},getPre:function(){return this._getClosestNode("pre")},getCode:function(){return this._getClosestNode("code")},getList:function(){return this._getClosestNode("ul, ol")},getParentList:function(){return this._getClosestUpNode("ul, ol")},getListItem:function(){return this._getClosestNode("li")},getTable:function(){return this.getComponentType("table")?this.$component.find("table").get():this._getClosestNode("table")},getTableCell:function(){var t=this.$el.closest("td, th");return t.length!==0&&t.get()},getComponentCodeElement:function(){return!!this.isComponentType("code")&&this.$component.find("pre code, pre").last().get()},getImageElement:function(){return!!this.isComponentType("image")&&this.$component.find("img").get()},getParagraph:function(){return this._getClosestNode("p")},getHeading:function(){return this._getClosestNode("h1, h2, h3, h4, h5, h6")},getDl:function(){return this._getClosestNode("dl")},getBlockquote:function(){return this._getClosestNode("blockquote")},getLink:function(){var t=this.isComponent()&&!this.isFigcaption();if(!this.isComponentType("table")&&t)return!1;var e=this._getClosestElement("a");return!(!e||e.attr("data-file"))&&e.get()},getFile:function(){var t=this.isComponent();if(!this.isComponentType("table")&&t)return!1;var e=this._getClosestElement("a");return!(!e||!e.attr("data-file"))&&e.get()},findFirstNode:function(t){return this.$el.find(t).first().get()},findLastNode:function(t){return this.$el.find(t).last().get()},_getLastOrFirstListItem:function(t){var e=this.getList(),i=this.getTag();if(e&&i==="li"){var s=r.dom(e).find("li")[t]().get();if(s&&this.node===s)return!0}return!1},_getLastOrFirstTableCell:function(t){var e=this.getTable(),i=this.getTag();if(e&&(i==="td"||i==="th")){var s=r.dom(e).find("td, th")[t]().get();if(s&&this.node===s)return!0}return!1},_getClosestUpNode:function(t){var e=this.editor.getElement(),i=this.$el.parents(t,e).last();return i.length!==0&&i.get()},_getClosestNode:function(t){var e=this.editor.getElement(),i=this.$el.closest(t,e);return i.length!==0&&i.get()},_getClosestElement:function(t){var e=this.editor.getElement(),i=this.$el.closest(t,e);return i.length!==0&&i}}),r.add("service","marker",{init:function(t){this.app=t},build:function(t,e){var i=document.createElement("span");return i.id="selection-marker-"+this._getPos(t),i.className="redactor-selection-marker",i.innerHTML=this.opts.markerChar,e?i.outerHTML:i},buildHtml:function(t){return this.build(t,!0)},insert:function(t){this.remove();var e=t!=="both"&&(t==="start"||this.selection.isCollapsed());this.selection.is()||this.editor.focus();var i=this.selection.getRange();if(i){var s=this.build("start"),n=this.build("end"),o=i.cloneRange();return e||(o.collapse(!1),o.insertNode(n)),o.setStart(i.startContainer,i.startOffset),o.collapse(!0),o.insertNode(s),i.setStartAfter(s),e||i.setEndBefore(n),this.selection.setRange(i),s}},find:function(t,e){var i=this.editor.getElement(),s=(e||i).find("span#selection-marker-"+this._getPos(t));return s.length!==0&&s.get()},restore:function(){var t=this.find("start"),e=this.find("end"),i=this.selection.getRange();if(i&&this.selection.is()||(this.editor.focus(),i=document.createRange()),t){var s=!!e&&e.previousSibling,n=t.nextSibling;n=(!n||n.nodeType!==3||n.textContent.replace(/[\n\t]/g,"")!=="")&&n,e?n&&n.id==="selection-marker-end"?this._restoreInject(i,t):s&&n?(i.selectNodeContents(s),i.collapse(!1),i.setStart(n,0)):s&&!n?(i.selectNodeContents(s),i.collapse(!1),i.setStartAfter(t)):(i.setStartAfter(t),i.setEndBefore(e)):n?(i.selectNodeContents(n),i.collapse(!0)):this._restoreInject(i,t),this.selection.setRange(i),t&&t.parentNode.removeChild(t),e&&e.parentNode.removeChild(e)}},remove:function(){var t=this.find("start"),e=this.find("end");t&&t.parentNode.removeChild(t),e&&e.parentNode.removeChild(e)},_getPos:function(t){return t===void 0?"start":t},_restoreInject:function(t,e){var i=this.utils.createInvisibleChar();r.dom(e).after(i),t.selectNodeContents(i),t.collapse(!1)}}),r.add("service","component",{init:function(t){this.app=t,this.activeClass="redactor-component-active"},create:function(t,e){return r.create(t+".component",this.app,e)},build:function(t){var e,i=r.dom(t).attr("data-redactor-type");return i&&(e=this.create(i,t)),e||t},remove:function(t,e){var i=r.dom(t).closest(".redactor-component"),s=i.attr("data-redactor-type"),n=i.parent(),o=this.inspector.parse(n),a=this.utils.findSiblings(i,"prev"),l=this.utils.findSiblings(i,"next");if(this.app.broadcast(s+".delete",i)!==!1){if(i.remove(),this.app.broadcast(s+".deleted",i),this.app.broadcast("contextbar.close"),this.app.broadcast("imageresizer.stop"),e!==!1){var h=o.getTableCell();h&&this.utils.isEmptyHtml(h.innerHTML)?this.caret.setStart(h):l?this.caret.setStart(l):a?this.caret.setEnd(a):this.editor.startFocus()}this.editor.isEmpty()&&(this.editor.setEmpty(),this.editor.startFocus(),this.app.broadcast("empty"))}},isNonEditable:function(t){var e=this.inspector.parse(t);return e.isComponent()&&!e.isComponentEditable()},isActive:function(t){if(t){var e=this.inspector.parse(t);return r.dom(e.getComponent()).hasClass(this.activeClass)}return this._find().length!==0},getActive:function(t){var e=this._find();return e.length!==0&&(t?e:e.get())},setActive:function(t){this.clearActive(),this.editor.focus();var e=this.inspector.parse(t),i=e.getComponent(),s=r.dom(i);if(!e.isFigcaption()){var n=s.find(".redactor-component-caret");n.length===0&&(n=this._buildCaret(),s.prepend(n)),this.caret.setAtStart(n.get())}s.addClass(this.activeClass)},clearActive:function(){var t=this._find();t.removeClass(this.activeClass),t.find(".redactor-component-caret").remove(),this.app.broadcast("imageresizer.stop")},setOnEvent:function(t,e){this.clearActive();var i=this.inspector.parse(t.target);i.isFigcaption()||i.isComponentEditable()||i.isComponent()&&(this.setActive(t.target),e!==!0&&t.preventDefault())},executeScripts:function(t){if(t===void 0)t=this.editor.getElement().find("[data-redactor-type]").find("script").getAll(),this.executeScripts.call(this,t);else for(var e=0;e<t.length;e++)if(t[e].src!==""){var i=t[e].src;this.$doc.find('head script[src="'+i+'"]').remove();var s=r.dom("<script>");s.attr("src",i),s.attr("async defer"),s.get().onload=(function(){i.search("instagram")!==-1&&window.instgrm.Embeds.process(),this.executeScripts(t.slice(e+1))}).bind(this);var n=document.getElementsByTagName("head")[0];n&&n.appendChild(s.get());break}},_find:function(){return this.editor.getElement().find("."+this.activeClass)},_buildCaret:function(){var t=r.dom("<span>");return t.addClass("redactor-component-caret"),t.attr("contenteditable",!0),t}}),r.add("service","insertion",{init:function(t){this.app=t},set:function(t,e,i){return t===null&&(t=""),t=e!==!1?this.cleaner.input(t):t,t=e!==!1?this.cleaner.paragraphize(t):t,this.editor.getElement().html(t),i!==!1&&this.editor.endFocus(),t},insertNode:function(t,e){this.editor.focus();var i=this.utils.isFragment(t)?t:this.utils.createFragment(t);return this._collapseSelection(),this._insertFragment(i),this._setCaret(e,i),this._sendNodes(i.nodes)},insertBreakLine:function(){return this.insertNode(document.createElement("br"),"after")},insertNewline:function(){return this.insertNode(document.createTextNode(`
`),"after")},insertText:function(t){return this.insertHtml(this.cleaner.getFlatText(t))},insertChar:function(t){return this.insertNode(t,"after")},insertRaw:function(t){return this.insertHtml(t,!1)},insertToEnd:function(t,e){if(t){t.nodeType===3&&t.nodeValue.search(/^\n/)!==-1&&(t=t.previousElementSibling);var i=r.dom(t);if(i.attr("data-redactor-type")===e){var s=this.opts.breakline?"<br>":"<p>",n=r.dom(s);i.after(n),this.caret.setStart(n)}}},insertPoint:function(t){var e,i=this.marker.build("start"),s=!1,n=t.clientX,o=t.clientY;if(document.caretPositionFromPoint){var a=document.caretPositionFromPoint(n,o),l=document.getSelection();this.inspector.parse(a.offsetNode).isInEditor()&&((e=l.getRangeAt(0)).setStart(a.offsetNode,a.offset),e.collapse(!0),e.insertNode(i),s=!0)}else document.caretRangeFromPoint&&(e=document.caretRangeFromPoint(n,o),this.inspector.parse(e.startContainer).isInEditor()&&(e.insertNode(i),s=!0));return s},insertToPoint:function(t,e,i,s){if(!(i===!0||this.insertPoint(t))){var n=this.editor.getLastNode();r.dom(n).after(this.marker.build("start"))}return this.component.clearActive(),this.selection.restoreMarkers(),this.insertHtml(e,s)},insertToOffset:function(t,e){return this.offset.set({start:t,end:t}),this.insertHtml(e)},insertHtml:function(t,e){if(this.opts.input){var i=this.utils.parseHtml(t);if(this.selection.isAll())return this._insertToAllSelected(i);if(!this.selection.is()){var s=r.dom("<p>");this.editor.getElement().append(s),this.caret.setStart(s)}var n=this.selection.isCollapsed(),o=this.selection.isText(),a=this.selection.getCurrent(),l=this.selection.getBlock(),h=this.inspector.parse(a);this._collapseSelection(),i=this._getCleanedInput(i,h,e);var c,d,u=this._isFigure(i.html),p=this._isComponentSpan(i.html),f=this.inspector.isText(i.html);if(this.editor.isEmpty())return this._insertToEmptyEditor(i.html);if(h.isComponent()&&!h.isComponentEditable())return this._insertToWidget(a,h,i.html);if(p)return this.insertNode(i.nodes,"end");if(u&&!o&&!h.isList())return h.isInline()?this._insertToInline(a,i):(c=this.utils.createFragment(i.html),this.utils.splitNode(a,c),this.caret.setEnd(c.last),this._sendNodes(c.nodes));if(h.isCode())return this._insertToCode(i,a,e);if(h.isPre())return this._insertToPre(i,e);if(h.isHeading()||h.isFigcaption())return i.html=e!==!1?this.cleaner.removeTagsExcept(i.html,["a"]):i.html,i.html=e!==!1?this.cleaner.replaceNbspToSpaces(i.html):i.html,c=this.utils.createFragment(i.html),this.insertNode(c,"end");if(this.opts.breakline&&l&&l.tagName==="DIV"){if(this._isPlainHtml(i.html))return this.insertNode(i.nodes,"end");i.html=e!==!1?this.cleaner.paragraphize(i.html):i.html,c=this.utils.createFragment(i.html);var v=this.selection.getRange();return v&&!this.selection.isCollapsed()&&v.deleteContents(),this.utils.splitNode(a,c),this.caret.setEnd(c.last),this._sendNodes(c.nodes)}if(f)return!o&&this.opts.markup!=="br"&&this._hasBlocksAndImages(i.nodes)?(i.html=e!==!1?this.cleaner.paragraphize(i.html):i.html,c=this.utils.createFragment(i.html),this.utils.splitNode(a,c),this.caret.setEnd(c.last),this._sendNodes(c.nodes)):(i.html=e!==!1?i.html.replace(/\n/g,"<br>"):i.html,c=this.utils.createFragment(i.html),this.insertNode(c.nodes,"end"));if(!n&&!u)return this._isPlainHtml(i.html)?this.insertNode(i.nodes,"end"):(i.html=e!==!1?this.cleaner.paragraphize(i.html):i.html,c=this.utils.createFragment(i.html),this.insertNode(c,"end"));if(h.isInline()&&!this._isPlainHtml(i.html))return this._insertToInline(a,i);if(h.isBlockquote()||h.isDl())return(d=this.opts.inlineTags).concat(["br"]),i.html=e!==!1?this.cleaner.replaceBlocksToBr(i.html):i.html,i.html=e!==!1?this.cleaner.removeTagsExcept(i.html,d):i.html,c=this.utils.createFragment(i.html),this.insertNode(c,"end");if(h.isParagraph())return this._isPlainHtml(i.html)?this.insertNode(i.nodes,"end"):(i.html=e!==!1?this.cleaner.paragraphize(i.html):i.html,c=this.utils.createFragment(i.html),this.utils.splitNode(a,c),this.caret.setEnd(c.last),this._sendNodes(c.nodes));if(h.isList()&&(d=(d=this.opts.inlineTags).concat(["br","li","ul","ol","img"]),i.html=e!==!1?this.cleaner.replaceBlocksToBr(i.html):i.html,i.html=e!==!1?this.cleaner.removeTagsExcept(i.html,d):i.html,i.html=e!==!1?this.cleaner.removeBrAtEnd(i.html):i.html,c=this.utils.createFragment(i.html),i.nodes=c.nodes,this._containsTags(i.html,["ul","ol","li"]))){var g=this.selection.getElement(a);if(g&&g.tagName==="LI"&&this.caret.isStart(g)){i.nodes=r.dom(c.nodes).unwrap("ul, ol").getAll(),r.dom(g).before(i.nodes);var b=i.nodes[i.nodes.length-1];return this.caret.setEnd(b),this._sendNodes(i.nodes)}return this._isPlainHtml(i.html)?this.insertNode(c,"end"):(c=this._buildList(i,g,c),this.utils.splitNode(a,c,!0),this.caret.setEnd(c.last),this._sendNodes(c.nodes))}return this.insertNode(i.nodes,"end")}},_insertToAllSelected:function(t){var e=this.set(t.html),i=this.utils.parseHtml(e);return this._sendNodes(i.nodes)},_insertToEmptyEditor:function(t){t=this.cleaner.paragraphize(t);var e=this.utils.createFragment(t),i=this.editor.getElement();return i.html(""),i.append(e.frag),this.caret.setEnd(e.last),this._sendNodes(e.nodes)},_insertToInline:function(t,e){var i=this.utils.createFragment(e.html);return this.utils.splitNode(t,i,!1,!0),this.caret.setEnd(i.last),this._sendNodes(i.nodes)},_insertToCode:function(t,e,i){t.html=i!==!1?this.cleaner.encodeHtml(t.html):t.html,t.html=i!==!1?this.cleaner.removeNl(t.html):t.html;var s=this.utils.createFragment(t.html),n=this.insertNode(s,"end");return this.utils.normalizeTextNodes(e),n},_insertToPre:function(t,e){t.html=e!==!1?this.cleaner.encodeHtml(t.html):t.html;var i=this.utils.createFragment(t.html);return this.insertNode(i,"end")},_insertToWidget:function(t,e,i){i=this._isComponentSpan(i)?i:this.cleaner.paragraphize(i);var s=this.utils.createFragment(i),n=e.getComponent(),o=r.dom(n);return o.after(s.frag),o.remove(),this.caret.setEnd(s.last),this._sendNodes(s.nodes)},_insertFragment:function(t){var e=this.selection.getRange();if(e){if(this.selection.isCollapsed()){var i=e.startContainer;i.nodeType!==3&&i.tagName==="BR"&&(this.caret.setAfter(i),i.parentNode.removeChild(i))}else e.deleteContents();e.insertNode(t.frag)}},_sendNodes:function(t){for(var e=0;e<t.length;e++){var i=t[e],s=i.nodeType!==3&&typeof i.getAttribute=="function"&&i.getAttribute("data-redactor-type");s&&this.app.broadcast(s+".inserted",this.component.build(i))}return this.detector.isIe()&&this.editor.getElement().find("[data-redactor-type=table]").attr("contenteditable",!0),this.app.broadcast("inserted",t),this.component.executeScripts(),t},_setCaret:function(t,e){var i=this._isLastInline(e);t?(t=i&&t==="end"?"after":t,this.caret["set"+this.utils.ucfirst(t)](e.last)):t!==!1&&i&&this.caret.setAfter(e.last)},_isLastInline:function(t){return!!t.last&&this.inspector.parse(t.last).isInline()},_getCleanedInput:function(t,e,i){var s=e.isCode()||e.isPre();return t.html=t.html.replace(/&nbsp;/g," "),t.html=s||i===!1?t.html:this.cleaner.input(t.html),t=s||i===!1?t:this.utils.parseHtml(t.html)},_getContainer:function(t){return r.dom(this.utils.createTmpContainer(t))},_buildList:function(t,e,i){var s=t.nodes[0];if(s&&s.nodeType!==3&&s.tagName==="li"){var n=r.dom(e).get().tagName.toLowerCase(),o=r.dom("<"+n+" />");return o.append(i.nodes),this.utils.createFragment(o.get().outerHTML)}return i},_containsTags:function(t,e){return this._getContainer(t).find(e.join(",")).length!==0},_collapseSelection:function(){},_hasFigureOrTable:function(t){return this._getContainer(t).find("figure, table").length!==0},_hasBlocks:function(t){return this._getContainer(t).find(this.opts.blockTags.join(",")).length!==0},_hasBlocksAndImages:function(t){return this._getContainer(t).find(this.opts.blockTags.join(",")+",img").length!==0},_isPlainHtml:function(t){return this._getContainer(t).find(this.opts.blockTags.join(",")+", img").length===0},_isFigure:function(t){if(this._isHtmlString(t))return r.dom(t).closest("figure").length!==0},_isComponentSpan:function(t){if(this._isHtmlString(t))return r.dom(t).closest("span.redactor-component").length!==0},_isHtmlString:function(t){return!(typeof t=="string"&&!/^\s*<(\w+|!)[^>]*>/.test(t))}}),r.add("service","block",{init:function(t){this.app=t,this.tags=["p","div","blockquote","pre","h1","h2","h3","h4","h5","h6"]},format:function(t){return this.params={args:!1},this.params.type=t.type?t.type:"set",this.params.tag=typeof t=="string"?t:t.tag||this.opts.markup,this.params.tag=this.params.tag.toLowerCase(),this.params.args={class:t.class||!1,style:t.style||!1,attr:t.attr||!1},t.class||t.style||t.attr||(this.params.args=!1),this._format()},add:function(t,e,i){return this._apply("add",t,e,!0,i)},set:function(t,e){return this._apply("set",t,e)},toggle:function(t,e){return this._apply("toggle",t,e)},remove:function(t,e){return this._apply("remove",t,e)},clearFormat:function(t){return this._clear(t,"all")},clearStyle:function(t){return this._clear(t,"style")},clearClass:function(t){return this._clear(t,"class")},clearAttr:function(t){return this._clear(t,"attr")},_format:function(){var t=[];this.collapsed=this.selection.isCollapsed(),this.selection.save(),this.selection.getBlock();var e=this._getBlocks(),i=this._isToggleFormatType(e)?"toggle":"set",s=this._getReplacedTag(i);return t=this._replaceBlocks(e,s),t=this._buildNodes(t),this._restoreSelection(t),t},_clear:function(t,e,i,s){i!==!1&&this.selection.save();var n=this._getElements(t,s);return e==="all"?this._removeAllAttr(n,!1):e==="style"?(n.removeAttr("style"),n.removeAttr("data-redactor-style-cache")):e==="class"?n.removeAttr("class"):e==="attr"&&this._removeAllAttr(n),s=n.getAll(),i!==!1&&this._restoreSelection(s),s},_getElements:function(t,e){return r.dom(e||this._getBlocks(t))},_getBlocks:function(t){for(var e=this.selection.getBlocks({tags:t||this.tags}),i=[],s=0;s<e.length;s++)e[s].tagName==="DIV"&&!e[s].getAttribute("data-redactor-tag")||i.push(e[s]);return i},_getReplacedTag:function(t){return this.opts.breakline?t==="toggle"||this.params.tag==="p"?"div":this.params.tag:t==="toggle"?this.opts.markup:this.params.tag},_isStandardParagraph:function(){return!this.opts.breakline&&this.opts.markup==="p"},_isStandardDiv:function(){return!this.opts.breakline&&this.opts.markup==="div"},_isBreaklineBlock:function(t){return t&&t.tagName==="DIV"&&t.getAttribute("data-redactor-tag")==="br"},_isToggleFormatType:function(t){for(var e=0,i=t.length,s=0;s<i;s++)t[s]&&this.params.tag===t[s].tagName.toLowerCase()&&e++;return e===i},_isCurrentBlockOneAndEmpty:function(t){return this.collapsed&&t.length===1&&this.utils.isEmpty(t[0])},_buildNodes:function(t){return 0<t.length&&(t=this._applyArgs(t,!1),t=this._combinePre(t),t=this._cleanBlocks(t)),t},_replaceBlocks:function(t,e){for(var i=[],s=0;s<t.length;s++){var n=this.utils.replaceToTag(t[s],e);i.push(n.get())}return i},_combinePre:function(t){for(var e=[],i=0;i<t.length;i++){var s=t[i].nextElementSibling;if(s&&t[i].tagName==="PRE"&&s.tagName==="PRE"){var n=r.dom(t[i]),o=r.dom(s),a=document.createTextNode(`
`);n.append(a),n.append(o),o.unwrap("pre")}e.push(t[i])}return e},_cleanBlocks:function(t){for(var e=["h1","h2","h3","h4","h5","h6"],i=this.opts.inlineTags,s=0;s<t.length;s++){var n=t[s].tagName.toLowerCase(),o=r.dom(t[s]);e.indexOf(n)!==-1?o.find("span").not(".redactor-component, .non-editable, .redactor-selection-marker").unwrap():n==="pre"&&o.find(i.join(",")).not(".redactor-selection-marker").unwrap(),this.params.args===!1&&this.params.tag==="p"&&o.removeAttr("class"),this.opts.breakline&&n==="div"?o.attr("data-redactor-tag","br"):o.removeAttr("data-redactor-tag"),this.utils.normalizeTextNodes(t[s])}return t},_cleanEmptyClass:function(t){t.each(function(e){e.className===""&&e.removeAttribute("class")})},_cleanEmptyStyle:function(t){this.utils.removeEmptyAttr(t.get(),"style")?t.removeAttr("data-redactor-style-cache"):t.attr("data-redactor-style-cache",t.attr("style"))},_apply:function(t,e,i,s,n){s!==!1&&this.selection.save();var o=this._getElements(i,n);if(e.class&&(t==="set"?(o.removeAttr("class"),o.addClass(e.class)):t==="add"?o.addClass(e.class):t==="toggle"?o.toggleClass(e.class):t==="remove"&&o.removeClass(e.class),this._cleanEmptyClass(o)),e.attr&&(t==="set"?(this._removeAllAttr(o),o.attr(e.attr)):t==="add"?o.attr(e.attr):t==="toggle"?(a=e.attr,o.each(function(h){var c=r.dom(h);for(var d in a)c.attr(d)?c.removeAttr(d):c.attr(d,a[d])})):t==="remove"&&o.removeAttr(e.attr)),e.style){if(t==="set")o.removeAttr("style"),o.css(e.style),o.each(function(h){var c=r.dom(h);c.attr("data-redactor-style-cache",c.attr("style"))});else if(t==="add"){var a=e.style;o.each((function(h){var c=r.dom(h);c.css(a),c.attr("data-redactor-style-cache",c.attr("style")),this._convertStyleQuotes(c)}).bind(this))}else if(t==="toggle")a=e.style,o.each((function(h){var c=r.dom(h);for(var d in a){var u=a[d],p=c.css(d);p=this.utils.isRgb(p)?this.utils.rgb2hex(p):p.replace(/"/g,""),u=this.utils.isRgb(u)?this.utils.rgb2hex(u):u.replace(/"/g,""),p=this.utils.hex2long(p),(typeof(u=this.utils.hex2long(u))=="string"?u.toLowerCase():u)===(typeof p=="string"?p.toLowerCase():p)?c.css(d,""):c.css(d,u)}this._convertStyleQuotes(c),this._cleanEmptyStyle(c)}).bind(this));else if(t==="remove"){var l=e.style;o.each((function(h){var c=r.dom(h);c.css(l,""),this._cleanEmptyStyle(c)}).bind(this))}}return n=o.getAll(),s!==!1&&this._restoreSelection(n),n},_applyArgs:function(t){return t=this.params.args?this._apply(this.params.type,this.params.args,!1,!1,t):this._clear(!1,"all",!1,t)},_removeAllAttr:function(t,e){t.each(function(i){var s=["data-redactor-tag","data-redactor-style-cache"];e===!1&&(s.push("style"),s.push("class"));for(var n=i.attributes.length;0<n--;){var o=i.attributes[n],a=o.name;s.indexOf(a)===-1&&i.removeAttributeNode(o)}})},_restoreSelection:function(t){this._isCurrentBlockOneAndEmpty(t)?this.caret.setStart(t[0]):setTimeout((function(){this.selection.restore()}).bind(this),1)},_convertStyleQuotes:function(t){var e=t.attr("style");e&&t.attr("style",e.replace(/"/g,"'"))}}),r.add("service","inline",{mixins:["formatter"],init:function(t){this.app=t,this.count=0},format:function(t){if(!this._isFormat())return[];this.type=t.type?t.type:"set",this.tag=typeof t=="string"?t:t.tag,this.tag=this.tag.toLowerCase(),this.tag=this.arrangeTag(this.tag),typeof t=="string"?this.args=!1:this.buildArgs(t),this.detector.isIe()||this.editor.disableNonEditables();var e=this.selection.isCollapsed()?this.formatCollapsed():this.formatUncollapsed();return this.detector.isIe()||this.editor.enableNonEditables(),e},_isFormat:function(){var t=this.selection.getCurrent(),e=this.inspector.parse(t),i=e.isComponent()&&!e.isComponentType("table")&&!e.isFigcaption();return!(t!==!1||!this.selection.isAll())||!(!t||e.isPre()||e.isCode()||i)},arrangeTag:function(t){var e=this.opts.replaceTags;for(var i in e)t===i&&(t=e[i]);return t},formatCollapsed:function(){var t,e,i,s,n=[],o=this.selection.getInlineFirst(),a=this.selection.getInlines({all:!0}),l=r.dom(o);if(o){var h=this.inspector.parse(o);if(this.utils.isEmptyHtml(o.innerHTML))if(o.tagName.toLowerCase()===this.tag)if(this.hasSameArgs(o)){this.caret.setAfter(o),l.remove();var c=this.selection.getElement();this.utils.normalizeTextNodes(c)}else this.tag==="span"?(n=this.applyArgs([o],!1),this.caret.setStart(o)):n=this.insertInline(n);else h.hasParent([this.tag])?(e=(t=l.closest(this.tag)).get(),this.hasSameArgs(e)?(t.unwrap(),this.caret.setStart(o)):n=this.insertInline(n)):n=this.insertInline(n);else if(o.tagName.toLowerCase()===this.tag)this.hasSameArgs(o)?(s=this.utils.extractHtmlFromCaret(o),i=r.dom("<"+this.tag+" />"),i=this.utils.cloneAttributes(o,i),l.after(i.append(s)),i.html().trim()===""&&i.remove(),this.caret.setAfter(o)):n=this.insertInline(n);else if(h.hasParent([this.tag]))if(e=(t=l.closest(this.tag)).get(),this.hasSameArgs(e)){var d,u;s=this.utils.extractHtmlFromCaret(e,e),i=r.dom("<"+this.tag+" />"),i=this.utils.cloneAttributes(e,i);var p=0;a=a.reverse();for(var f=0;f<a.length;f++)a[f]!==e&&(u=r.dom("<"+a[f].tagName.toLowerCase()+">"),p===0?d=u:d.append(u),p++);t.after(i.append(s)),t.after(d),this.caret.setStart(u)}else n=this.insertInline(n);else n=this.insertInline(n)}else n=this.insertInline(n);return n},insertInline:function(t){var e=document.createElement(this.tag);return t=this.insertion.insertNode(e,"start"),this.applyArgs(t,!1)},hasSameArgs:function(t){if(t.attributes.length===0&&this.args===!1)return!0;var e=!0;if(this.args){var i=0;for(var s in this.args){var n=r.dom(t),o=this.args[s],a=this.utils.toParams(o),l=n.attr(s);if(o)if(s==="style"){a=a.trim().replace(/;$/,"");for(var h=this.utils.styleToObj(n.attr("style")),c=a.split(";"),d=0,u=0;u<c.length;u++){var p=c[u].split(":"),f=p[0].trim(),v=p[1].trim();if(f.search(/color/)!==-1){var g=n.css(f);!g||g!==v&&this.utils.rgb2hex(g)!==v||d++}else n.css(f)===v&&d++}d===c.length&&Object.keys(h).length===c.length&&i++}else l===a&&i++;else l&&l!==""||i++}e=i===Object.keys(this.args).length}return e},formatUncollapsed:function(){var t=this.selection.getInlines({all:!0,inside:!0});this.detector.isIe()?this.selection.saveMarkers():this.selection.save(),this._convertTags("u"),this._convertTags("del"),this._convertToStrike(t),this.detector.isIe()?this.selection.restoreMarkers():this.selection.restore(),document.execCommand("strikethrough"),this._clearDecoration(),this.selection.save();var e=this._revertToInlines();e=this.applyArgs(e,!1);for(var i=0;i<e.length;i++){var s=e[i],n=s.tagName.toLowerCase(),o=s.attributes.length;n===this.tag&&o===0&&this.args&&(r.dom(s).unwrap(),e.splice(i,1))}return this.selection.restore(),this._clearEmptyStyle(),e=this._normalizeBlocks(e)},_convertTags:function(t){this.tag!==t&&this.editor.getElement().find(t).each((function(e){this.utils.replaceToTag(e,"span").addClass("redactor-convertable-"+t)}).bind(this))},_revertTags:function(t){this.editor.getElement().find("span.redactor-convertable-"+t).each((function(e){var i=this.utils.replaceToTag(e,t);i.removeClass("redactor-convertable-"+t),this.utils.removeEmptyAttr(i,"class")&&i.removeAttr("class")}).bind(this))},_convertToStrike:function(t){for(var e=this.selection.getText().replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&"),i=0;i<t.length;i++){var s=this.arrangeTag(t[i].tagName.toLowerCase()),n=t[i],o=r.dom(n),a=this.hasSameArgs(n);if(s===this.tag)if(this.tag==="span"&&this._isTextSelected(n,e))o.addClass("redactor-convertable-apply");else if(a&&this.tag!=="a")this._replaceToStrike(o);else if(this.tag==="span"){if(this.args&&this.args.style)for(var l in this.args.style)o.css(l,"");this.utils.removeEmptyAttr(o.get(),"style")?o.addClass("redactor-convertable-apply"):o.addClass("redactor-unconvertable-apply")}else a||o.addClass("redactor-convertable-apply")}},_replaceToStrike:function(t){t.replaceWith(function(){return r.dom("<strike>").append(t.contents())})},_revertToInlines:function(){var t=[],e=this.editor.getElement();return this.tag!=="u"&&e.find("u").unwrap(),e.find(".redactor-convertable-u").each(function(i){t.push(i)}),e.find(".redactor-convertable-apply").each((function(i){var s=r.dom(i);s.find("strike").unwrap(),this._forceRemoveClass(s,"redactor-convertable-apply"),t.push(i)}).bind(this)),e.find("span.redactor-unconvertable-apply").each((function(i){var s=r.dom(i);this._forceRemoveClass(s,"redactor-unconvertable-apply")}).bind(this)),e.find("strike").each((function(i){var s=this.utils.replaceToTag(i,this.tag);t.push(s.get())}).bind(this)),this._revertTags("u"),this._revertTags("del"),t},_normalizeBlocks:function(t){var e=this.opts.inlineTags,i=this.selection.getBlocks();if(i)for(var s=0;s<i.length;s++)i[s].tagName==="PRE"&&r.dom(i[s]).find(e.join(",")).not(".redactor-selection-marker").each((function(n){t.indexOf(n)!==-1&&(t=this.utils.removeFromArrayByValue(t,n)),r.dom(n).unwrap()}).bind(this));return t},_clearDecoration:function(){this.editor.getElement().find(this.opts.inlineTags.join(",")).each(function(t){if(t.style.textDecoration==="line-through"||t.style.textDecorationLine==="line-through"){var e=r.dom(t);e.css("textDecorationLine",""),e.css("textDecoration",""),e.wrap("<strike>")}})},_clearEmptyStyle:function(){for(var t=this.getInlines(),e=0;e<t.length;e++){this._clearEmptyStyleAttr(t[e]);var i=t[e].childNodes;if(i)for(var s=0;s<i.length;s++)this._clearEmptyStyleAttr(i[s])}},_clearEmptyStyleAttr:function(t){t.nodeType!==3&&this.utils.removeEmptyAttr(t,"style")&&(t.removeAttribute("style"),t.removeAttribute("data-redactor-style-cache"))},_forceRemoveClass:function(t,e){t.removeClass(e),this.utils.removeEmptyAttr(t,"class")&&t.removeAttr("class")},_isTextSelected:function(t,e){var i=this.utils.removeInvisibleChars(t.textContent);return e===i||e.search(new RegExp("^"+this.utils.escapeRegExp(i)+"$"))!==-1},getInlines:function(t){return t?this.selection.getInlines({tags:t,all:!0}):this.selection.getInlines({all:!0})},getElements:function(t){return r.dom(this.getInlines(t))},clearFormat:function(){this.selection.save();for(var t=this.selection.getInlines({all:!0}),e=0;e<t.length;e++){var i=r.dom(t[e]);this.selection.getInline(t[e])&&i.unwrap()}this.selection.restore()}}),r.add("service","autoparser",{init:function(t){this.app=t,this.cleaner=this.app.cleaner},observe:function(){var t=this.editor.getElement().find(".redactor-autoparser-object").each(function(e){var i=r.dom(e);i.removeClass("redactor-autoparser-object"),i.attr("class")===""&&i.removeAttr("class")});0<t.length&&t.each((function(e){var i,s=!1,n=e.tagName;n==="A"?i="link":n==="IMG"?i="image":n==="IFRAME"&&(i="video"),i&&(s=r.create(i+".component",this.app,e),this.app.broadcast(i+".inserted",s),this.app.broadcast("autoparse",i,s))}).bind(this))},format:function(t,e){this._isKey(e)&&this._format(e===this.keycodes.ENTER)},parse:function(t){var e=["figure","html","form","pre","object","video","iframe","code","a","img"],i=[],s=0,n=[];t=this.cleaner.storeComments(t,n),t=(t=(t=this.cleaner.encodeCode(t)).replace(/\$/g,"&#36;")).replace(/&amp;/g,"&");for(var o=0;o<e.length;o++){var a=e[o]==="img"?"<"+e[o]+"[^>]*>":"<"+e[o]+"([\\w\\W]*?)</"+e[o]+">";if((f=t.match(new RegExp(a,"gi")))!==null)for(var l=0;l<f.length;l++)t=t.replace(f[l],"#####replaceparse"+s+"#####"),i.push(f[l]),s++}if(this.opts.autoparseImages&&t.match(this.opts.regex.imageurl)){var h=t.match(this.opts.regex.imageurl);for(o=0;o<h.length;o++)t=t.replace(h[o],'<img class="redactor-autoparser-object" src="'+h[o]+'">')}if(this.opts.autoparseVideo&&(t.match(this.opts.regex.youtube)||t.match(this.opts.regex.vimeo))){var c,d,u=this.opts.autoparseHttps?"https:":"";t.match(this.opts.regex.youtube)?(c=u+"//www.youtube.com/embed/$1",d=this.opts.regex.youtube):t.match(this.opts.regex.vimeo)&&(c=u+"//player.vimeo.com/video/$2",d=this.opts.regex.vimeo);var p=this.component.create("video",'<iframe width="500" height="281" src="'+c+'" frameborder="0" allowfullscreen></iframe>');t=t.replace(d,p.get().outerHTML)}for(o=0;o<e.length;o++){var f;if(a=e[o]==="img"?"<"+e[o]+"[^>]*>":"<"+e[o]+"([\\w\\W]*?)</"+e[o]+">",(f=t.match(new RegExp(a,"gi")))!==null)for(l=0;l<f.length;l++)t=t.replace(f[l],"#####replaceparse"+s+"#####"),i.push(f[l]),s++}return this.opts.autoparseLinks&&t.match(this.opts.regex.url)&&(t=this._formatLinks(t)),t=this._restoreReplaced(i,t),t=this._restoreReplaced(i,t),t=this.cleaner.restoreComments(t,n)},_isKey:function(t){return t===this.keycodes.ENTER||t===this.keycodes.SPACE},_format:function(t){var e=this.selection.getParent(),i=r.dom(e);if(!(e&&i.closest("figure, pre, code, img, a, iframe").length!==0)&&this.selection.isCollapsed()){var s=this.utils.createInvisibleChar();this.selection.getRange().insertNode(s);var n=this.selection.getCurrent(),o=this.inspector.parse(n),a=r.dom(n);if(s.parentNode.removeChild(s),n&&n.nodeType===3){var l,h=n.textContent;if(this.opts.autoparseImages&&h.match(this._convertToRegExp(this.opts.regex.imageurl))){var c=o.isList(),d=h.match(this.opts.regex.imageurl),u=c?void 0:"<figure><img></figure>",p=this.component.create("image",u);p.setSrc(d[0]),p.addClass("redactor-autoparser-object"),h=h.replace(d[0],p.get().outerHTML),l="image"}else if(this.opts.autoparseVideo&&(h.match(this._convertToRegExp(this.opts.regex.youtube))||h.match(this._convertToRegExp(this.opts.regex.vimeo)))){var f,v;h.match(this.opts.regex.youtube)?(f="//www.youtube.com/embed/$1",v=this.opts.regex.youtube):h.match(this.opts.regex.vimeo)&&(f="//player.vimeo.com/video/$2",v=this.opts.regex.vimeo);var g=this.component.create("video",'<iframe width="500" height="281" src="'+f+'" frameborder="0" allowfullscreen></iframe>');g.addClass("redactor-autoparser-object"),h=h.replace(v,g.get().outerHTML),l="video"}else this.opts.autoparseLinks&&h.match(this._convertToRegExp(this.opts.regex.url))&&(h=this._formatLinks(h,t),l="link");if(l){t?(this.selection.save(),a.replaceWith(h),this.selection.restore()):a.replaceWith(h);var b=this.editor.getElement().find(".redactor-autoparser-object").removeClass("redactor-autoparser-object");if(b=l==="link"?r.create("link.component",this.app,b):b,l==="link")t||this.caret.setAfter(b),this.app.broadcast("link.inserted",b);else{this.caret.setAfter(b);var T=b.clone();b.remove(),b=this.insertion.insertHtml(T),b=this.component.build(b)}this.app.broadcast("autoparse",l,b)}}}},_formatLinks:function(t){var e=this.opts.pasteLinkTarget!==!1?' target="'+this.opts.pasteLinkTarget+'"':"",i=' class="redactor-autoparser-object"',s=this;return t=(t=t.replace(this.opts.regex.aurl1,function(n){return'<a href="'+n+'"'+e+i+">"+s._subLinkText(n)+"</a>"})).replace(this.opts.regex.aurl2,function(n,o,a){return o+'<a href="http://'+a+'"'+e+i+">"+s._subLinkText(a)+"</a>"})},_subLinkText:function(t){return t=(t=t.length>this.opts.linkSize?t.substring(0,this.opts.linkSize)+"...":t).search("%")===-1?decodeURIComponent(t):t},_restoreReplaced:function(t,e){for(var i=0;i<t.length;i++)e=e.replace("#####replaceparse"+i+"#####",t[i]);return e},_convertToRegExp:function(t){return new RegExp(String(t).replace(/^\//,"").replace(/\/ig$/,"").replace(/\/gi$/,"")+"$","gi")}}),r.add("service","storage",{init:function(t){this.app=t,this.data=[]},observeImages:function(){this.opts.imageObserve&&this.editor.getElement().find("[data-image]").each(this._addImage.bind(this))},observeFiles:function(){this.editor.getElement().find("[data-file]").each(this._addFile.bind(this))},setStatus:function(t,e){this.data[t].status=e},getChanges:function(){var t=this.editor.getElement();for(var e in this.data){var i=this.data[e],s=t.find("[data-"+i.type+'="'+i.id+'"]');this.setStatus(i.id,s.length!==0)}return this.data},add:function(t,e){var i=r.dom(e),s=i.attr("data-"+t);this.data[s]={type:t,status:!0,node:i.get(),id:i.attr("data-"+t)}},_addImage:function(t){this.add("image",t)},_addFile:function(t){this.add("file",t)}}),r.add("service","utils",{init:function(t){this.app=t},isEmpty:function(t){var e=!1;return(t=r.dom(t).get())&&(e=t.nodeType===3?t.textContent.trim().replace(/\n/,"")==="":t.innerHTML===""),e},isEmptyHtml:function(t,e,i){return t=(t=(t=(t=(t=(t=this.removeInvisibleChars(t)).replace(/&nbsp;/gi,"")).replace(/<\/?br\s?\/?>/g,e?"br":"")).replace(/\s/g,"")).replace(/^<p>[^\W\w\D\d]*?<\/p>$/i,"")).replace(/^<div>[^\W\w\D\d]*?<\/div>$/i,""),i&&(t=(t=t.replace(/<ul(.*?[^>])>$/i,"ul")).replace(/<ol(.*?[^>])>$/i,"ol")),(t=(t=(t=(t=(t=(t=t.replace(/<hr(.*?[^>])>$/i,"hr")).replace(/<iframe(.*?[^>])>$/i,"iframe")).replace(/<source(.*?[^>])>$/i,"source")).replace(/<[^\/>][^>]*><\/[^>]+>/gi,"")).replace(/<[^\/>][^>]*><\/[^>]+>/gi,"")).trim())===""},trimSpaces:function(t){return this.removeInvisibleChars(t.trim())},createInvisibleChar:function(){return document.createTextNode(this.opts.markerChar)},searchInvisibleChars:function(t){return t.search(/^\uFEFF$/g)},removeInvisibleChars:function(t){return t.replace(/\uFEFF/g,"")},trimInvisibleChars:function(t){if(this.selection.isCollapsed()){var e=this.selection.getCurrent(),i=t==="left"?this.selection.getTextBeforeCaret():this.selection.getTextAfterCaret();if(e&&e.nodeType===3&&this.searchInvisibleChars(i)===0)if(t==="left")r.dom(e).replaceWith(e.textContent.trim());else{var s=this.offset.get();this.offset.set({start:s.start+1,end:s.end+1})}}},buildWrapper:function(t){return r.dom("<div>").html(t)},getWrapperHtml:function(t){var e=t.html();return t.remove(),e},createTmpContainer:function(t){var e=r.dom("<div>");return typeof t=="string"?e.html(t):e.append(r.dom(t).clone(!0)),e.get()},createFragment:function(t){for(var e,i,s,n=this.createTmpContainer(t),o=document.createDocumentFragment(),a=[],l=0;e=n.firstChild;){l++;var h=o.appendChild(e);l===1&&(i=h),a.push(h),s=h}return{frag:o,first:i,last:s,nodes:a}},isFragment:function(t){return typeof t=="object"&&t.frag},parseHtml:function(t){var e=this.createTmpContainer(t);return{html:e.innerHTML,nodes:e.childNodes}},splitNode:function(t,e,i,s){var n;e=this.isFragment(e)?e.frag:e,n=s?this.inspector.isInlineTag(t.tagName)?t:this.selection.getInline(t):this.inspector.isBlockTag(t.tagName)?t:this.selection.getBlock(t);var o=r.dom(n);if(!s&&this.isEmptyHtml(n.innerHTML,!0))return o.after(e),o.remove(),e;var a=o.get().tagName.toLowerCase(),l=this.caret.isEnd(n),h=this.caret.isStart(n);if(!l&&!h){var c=this.extractHtmlFromCaret(s),d=r.dom("<"+a+" />");d=this.cloneAttributes(n,d),o.after(d.append(c))}if(h)return o.before(e);if(i)return o.append(e);e=o.after(e);var u=o.html();return(u=(u=this.removeInvisibleChars(u)).replace(/&nbsp;/gi,""))===""&&o.remove(),e},extractHtmlFromCaret:function(t,e){var i=this.selection.getRange();if(i&&(e=e||(t?this.selection.getInline():this.selection.getBlock()))){var s=i.cloneRange();return s.selectNodeContents(e),s.setStart(i.endContainer,i.endOffset),s.extractContents()}},createMarkup:function(t){var e=document.createElement(this.opts.markup);this.opts.breakline&&e.setAttribute("data-redactor-tag","br"),r.dom(t).after(e),this.caret.setStart(e)},createMarkupBefore:function(t){var e=document.createElement(this.opts.markup);this.opts.breakline&&e.setAttribute("data-redactor-tag","br"),r.dom(t).before(e),this.caret.setEnd(e)},getNode:function(t){var e=r.dom(t).get(),i=this.editor.getElement().get();return t===void 0?i:e||!1},findSiblings:function(t,e){for(t=r.dom(t).get(),e=e==="next"?"nextSibling":"previousSibling";t=t[e];)if((t.nodeType!==3||t.textContent.trim()!=="")&&t.tagName!=="BR")return t;return!1},getElementsFromHtml:function(t,e,i){var s=document.createElement("div");s.innerHTML=t;var n=s.querySelectorAll(e);return(function(o,a){if(typeof this.length=="number"&&typeof o=="function"){var l=[];if(typeof this=="object")for(var h=0;h<this.length;h++){if(!(h in this))return;l[h]=o.call(a||this,this[h],h,this)}return l}}).call(n,function(o){var a=o.getAttribute("data-redactor-type");if(!i||!a||a!==i)return o.outerHTML})},getChildNodes:function(t,e,i){var s=(t=t&&t.nodeType&&t.nodeType===11?t:r.dom(t).get()).childNodes,n=[];if(s){for(var o=0;o<s.length;o++)if(!(i===!0&&s[o].nodeType===3||s[o].nodeType===3&&this.isEmpty(s[o])||(n.push(s[o]),e===!1))){var a=this.getChildNodes(s[o],i);0<a.length&&(n=n.concat(a))}}return n},getChildElements:function(t){return this.getChildNodes(t,!0,!0)},getFirstNode:function(t){return this._getFirst(this.getChildNodes(t,!1))},getLastNode:function(t){return this._getLast(this.getChildNodes(t,!1))},getFirstElement:function(t){return this._getFirst(this.getChildNodes(t,!1,!0))},getLastElement:function(t){return this._getLast(this.getChildNodes(t,!1,!0))},replaceToTag:function(t,e){return r.dom(t).replaceWith(function(i){var s=r.dom("<"+e+">").append(r.dom(i).contents());if(i.attributes)for(var n=i.attributes,o=0;o<n.length;o++)s.attr(n[o].nodeName,n[o].value);return s})},ucfirst:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},removeFromArrayByValue:function(t,e){for(var i,s=arguments,n=s.length;1<n&&t.length;)for(e=s[--n];(i=t.indexOf(e))!==-1;)t.splice(i,1);return t},removeEmptyAttr:function(t,e){var i=r.dom(t);return i.attr(e)===void 0||i.attr(e)===null||i.attr(e)===""&&(i.removeAttr(e),!0)},cloneAttributes:function(t,e){t=r.dom(t).get(),e=r.dom(e);for(var i=t.attributes,s=i.length;s--;){var n=i[s];e.attr(n.name,n.value)}return e},toParams:function(t){if(typeof t!="object")return t;var e=Object.keys(t);if(!e.length)return"";for(var i="",s=0;s<e.length;s++){var n=e[s];i+=n+":"+t[n]+";"}return i},styleToObj:function(t){var e={};if(t)for(var i=t.replace(/;$/,"").split(";"),s=0;s<i.length;s++){var n=i[s].split(":");e[n[0].trim()]=n[1].trim()}return e},checkProperty:function(t){for(var e=arguments[1]&&Array.isArray(arguments[1])?arguments[1]:[].slice.call(arguments,1),i=0;i<e.length;i++){if(!t||t[e[i]]===void 0)return!1;t=t[e[i]]}return t},extendData:function(t,e){for(var i in e)i==="elements"?r.dom(e[i]).each((function(s){var n=r.dom(s);if(s.tagName==="FORM"){var o=n.serialize(!0);for(var a in o)t=this._setData(t,a,o[a])}else{var l=n.attr("name")?n.attr("name"):n.attr("id");t=this._setData(t,l,n.val())}}).bind(this)):t=this._setData(t,i,e[i]);return t},_setData:function(t,e,i){return t instanceof FormData?t.append(e,i):t[e]=i,t},normalizeTextNodes:function(t){(t=r.dom(t).get())&&t.normalize()},isRgb:function(t){return t.search(/^rgb/i)===0},rgb2hex:function(t){return(t=t.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i))&&t.length===4?"#"+("0"+parseInt(t[1],10).toString(16)).slice(-2)+("0"+parseInt(t[2],10).toString(16)).slice(-2)+("0"+parseInt(t[3],10).toString(16)).slice(-2):""},hex2long:function(t){return t.search(/^#/)!==-1&&t.length===4&&(t="#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]),t},escapeRegExp:function(t){return t.replace(/[-\/\\^$*~+?.()|[\]{}]/g,"\\$&")},getRandomId:function(){for(var t="",e="abcdefghijklmnopqrstuvwxyz0123456789",i=0;i<12;i++)t+=e.charAt(Math.floor(Math.random()*e.length));return t},_getFirst:function(t){return t.length!==0&&t[0]},_getLast:function(t){return t.length!==0&&t[t.length-1]}}),r.add("service","progress",{init:function(t){this.app=t,this.$box=null,this.$bar=null},show:function(){this._is()||this._build(),this.$box.show()},hide:function(){this._is()&&this.animate.start(this.$box,"fadeOut",this._destroy.bind(this))},update:function(t){this.show(),this.$bar.css("width",t+"%")},_is:function(){return this.$box!==null},_build:function(){this.$bar=r.dom("<span />"),this.$box=r.dom('<div id="redactor-progress" />'),this.$box.append(this.$bar),this.$body.append(this.$box)},_destroy:function(){this._is()&&this.$box.remove(),this.$box=null,this.$bar=null}}),r.add("module","starter",{init:function(t){this.app=t,this.opts=t.opts,this.plugin=t.plugin,this.module=t.module},onstart:function(){this._startStop("start",this.app,["element","container","source","editor","statusbar","toolbar"]),this._startStop("start",this.module,["element","container","source","editor","statusbar","contextbar","input"])},onstop:function(){this._startStop("stop",this.module,["observer","element","container","source","editor","contextbar"])},onenable:function(){var t=this.opts.plugins;this._startStop("start",this.module,["observer","toolbar"]),this._startStop("start",this.plugin,t)},ondisable:function(){var t=this.opts.plugins;this._startStop("stop",this.module,["observer","toolbar"]),this._startStop("stop",this.plugin,t)},_startStop:function(t,e,i){for(var s=0;s<i.length;s++)e[i[s]]!==void 0&&this.app.callInstanceMethod(e[i[s]],t)}}),r.add("module","element",{init:function(t){this.app=t,this.uuid=t.uuid,this.opts=t.opts,this.namespace=t.namespace,this.element=t.element,this.rootOpts=r.extend({},!0,r.options,t.rootOpts)},start:function(){this._build(),this._buildModes(),this._buildMarkup()},stop:function(){this.element.getElement().removeData(this.namespace+"-uuid")},_build:function(){this.element.getElement().data(this.namespace+"-uuid",this.uuid)},_buildModes:function(){var t=this.element.getType();t==="inline"&&this._redefineOptions(this.opts.modes.inline),t==="div"&&this._redefineOptions(this.opts.modes.original),t!=="inline"&&(this._isRootOption("styles")&&this.rootOpts.styles&&(this.opts.styles=!0),this._isRootOption("source")&&!this.rootOpts.source&&(this.opts.showSource=!1))},_buildMarkup:function(){this.element.getType()==="inline"?this.opts.emptyHtml="":this.opts.breakline?(this.opts.markup="div",this.opts.emptyHtml='<div data-redactor-tag="br">'+this.opts.markerChar+"</div>"):this.opts.emptyHtml="<"+this.opts.markup+"></"+this.opts.markup+">"},_redefineOptions:function(t){for(var e in t)this.opts[e]=t[e]},_isRootOption:function(){return this.rootOpts.styles!==void 0}}),r.add("module","editor",{init:function(t){this.app=t,this.uuid=t.uuid,this.opts=t.opts,this.editor=t.editor,this.source=t.source,this.element=t.element,this.component=t.component,this.container=t.container,this.inspector=t.inspector,this.autoparser=t.autoparser,this.placeholder=!1,this.events=!1},onenable:function(){this.enable()},ondisable:function(){this.disable()},onenablefocus:function(){this._enableFocus()},oncontextmenu:function(t){this.component.setOnEvent(t,!0)},onclick:function(t){this.component.setOnEvent(t)},onkeyup:function(t){this.inspector.parse(t.target).isComponent()||this.component.clearActive()},onenablereadonly:function(){this._enableReadOnly()},ondisablereadonly:function(){this._disableReadOnly()},onautoparseobserve:function(){this.autoparser.observe()},onplaceholder:{build:function(){this._buildPlaceholder()},toggle:function(){this._togglePlacehodler()}},start:function(){this._build(),this._buildEvents(),this._buildOptions(),this._buildAccesibility()},stop:function(){var t=this.editor.getElement(),e=this.container.getElement(),i=["redactor-in","redactor-in-"+this.uuid,"redactor-structure","redactor-placeholder","notranslate"];this.opts.stylesClass!==""&&i.push(this.opts.stylesClass),t.removeAttr("spellcheck"),t.removeAttr("dir"),t.removeAttr("contenteditable"),t.removeAttr("placeholder"),t.removeAttr("data-gramm_editor"),t.removeClass(i.join(" ")),e.removeClass(["redactor-focus","redactor-blur","redactor-over","redactor-styles-on","redactor-styles-off","redactor-toolbar-on","redactor-text-labeled-on","redactor-source-view"].join(" ")),this._destroyEvents(),t.get().classList.length===0&&t.removeAttr("class")},enable:function(){var t=this.editor.getElement(),e=this.container.getElement();t.addClass("redactor-in redactor-in-"+this.uuid),t.attr({contenteditable:!0}),this.opts.structure&&t.addClass("redactor-structure"),!this.opts.toolbar||this.opts.air||this.opts.toolbarExternal||e.addClass("redactor-toolbar-on"),this._disableBrowsersEditing()},disable:function(){var t=this.editor.getElement(),e=this.container.getElement();t.removeClass("redactor-in redactor-in-"+this.uuid),t.removeClass("redactor-structure"),t.removeAttr("contenteditable"),e.addClass("redactor-toolbar-on")},_build:function(){var t=this.editor.getElement(),e=this.element.getElement(),i=this.container.getElement();i.addClass("redactor-blur"),this.opts.grammarly||t.attr("data-gramm_editor",!1),this.opts.notranslate&&t.addClass("notranslate"),this.opts.styles?(t.addClass(this.opts.stylesClass),i.addClass("redactor-styles-on")):i.addClass("redactor-styles-off"),this.opts.buttonsTextLabeled&&i.addClass("redactor-text-labeled-on"),this.element.isType("textarea")&&e.before(t)},_buildEvents:function(){this.events=r.create("editor.events",this.app)},_buildOptions:function(){var t=this.editor.getElement();t.attr("dir",this.opts.direction),this.opts.spellcheck||t.attr("spellcheck",!1),this.opts.tabindex&&t.attr("tabindex",this.opts.tabindex),this.opts.minHeight&&t.css("min-height",this.opts.minHeight),this.opts.maxHeight&&t.css("max-height",this.opts.maxHeight),this.opts.maxWidth&&t.css({"max-width":this.opts.maxWidth,margin:"auto"})},_buildAccesibility:function(){this.editor.getElement().attr({"aria-labelledby":"redactor-voice-"+this.uuid,role:"presentation"})},_buildPlaceholder:function(){this.placeholder=r.create("editor.placeholder",this.app)},_enableFocus:function(){this.opts.showSource?this._enableFocusSource():this._enableFocusEditor()},_enableFocusSource:function(){var t=this.source.getElement();this.opts.focus?(t.focus(),t.get().setSelectionRange(0,0)):this.opts.focusEnd&&t.focus()},_enableFocusEditor:function(){this.opts.focus?setTimeout(this.editor.startFocus.bind(this.editor),100):this.opts.focusEnd&&setTimeout(this.editor.endFocus.bind(this.editor),100)},_togglePlacehodler:function(){this.placeholder&&this.placeholder.toggle()},_disableBrowsersEditing:function(){try{document.execCommand("enableObjectResizing",!1,!1),document.execCommand("enableInlineTableEditing",!1,!1),document.execCommand("AutoUrlDetect",!1,!1);var t=this.editor.getElement().get();t.addEventListener?t.addEventListener("mscontrolselect",function(e){e.preventDefault()}):t.attachEvent("oncontrolselect",function(e){e.returnValue=!1})}catch{}},_destroyEvents:function(){this.events&&this.events.destroy()},_enableReadOnly:function(){var t=this.editor.getElement();this._getEditables(t).removeAttr("contenteditable"),t.removeAttr("contenteditable"),t.addClass("redactor-read-only"),this.events&&this.events.destroy()},_disableReadOnly:function(){var t=this.editor.getElement();this._getEditables(t).attr({contenteditable:!0}),t.removeClass("redactor-read-only"),t.attr({contenteditable:!0}),this._buildEvents()},_getEditables:function(t){return t.find("figcaption, td, th")}}),r.add("class","editor.placeholder",{init:function(t){this.app=t,this.opts=t.opts,this.editor=t.editor,this.element=t.element,this.build()},build:function(){var t=this.element.getElement(),e=this.editor.getElement();if(this.opts.placeholder!==!1||t.attr("placeholder")){var i=this.opts.placeholder!==!1?this.opts.placeholder:t.attr("placeholder");e.attr("placeholder",i),this.toggle()}},toggle:function(){return this.editor.isEmpty(!0)?this.show():this.hide()},show:function(){this.editor.getElement().addClass("redactor-placeholder")},hide:function(){this.editor.getElement().removeClass("redactor-placeholder")}}),r.add("class","editor.events",{init:function(t){this.app=t,this.opts=t.opts,this.$doc=t.$doc,this.uuid=t.uuid,this.source=t.source,this.editor=t.editor,this.cleaner=t.cleaner,this.container=t.container,this.insertion=t.insertion,this.inspector=t.inspector,this.selection=t.selection,this.component=t.component,this.blurNamespace=".redactor-blur."+this.uuid,this.eventsList=["paste","click","contextmenu","keydown","keyup","mouseup","touchstart","cut","copy","dragenter","dragstart","drop","dragover","dragleave"],this._init()},destroy:function(){this.editor.getElement().off(".redactor-focus"),this.$doc.off("keyup"+this.blurNamespace+" mousedown"+this.blurNamespace),this._loop("off")},focus:function(t){var e=this.container.getElement();this.editor.isPasting()||e.hasClass("redactor-focus")||(e.addClass("redactor-focus"),e.removeClass("redactor-blur"),this.app.broadcast("observe",t),this.app.broadcast("focus",t),this.isFocused=!0,this.isBlured=!1)},blur:function(t){var e=this.container.getElement(),i=r.dom(t.target),s=[".redactor-in-"+this.uuid,".redactor-toolbar",".redactor-dropdown",".redactor-context-toolbar",".redactor-modal-box","#redactor-image-resizer"];this.app.broadcast("originalblur",t),this.app.stopBlur||this.app.isStarted()&&!this.editor.isPasting()&&i.closest(s.join(",")).length===0&&(this.isBlured||e.hasClass("redactor-blur")||(e.removeClass("redactor-focus"),e.addClass("redactor-blur"),this.app.broadcast("blur",t),this.isFocused=!1,this.isBlured=!0))},cut:function(t){var e=this.selection.getCurrent(),i=this.inspector.parse(e);this.app.broadcast("state",t),this.component.isNonEditable(e)&&(this._passSelectionToClipboard(t,i,!0),t.preventDefault())},copy:function(t){var e=this.selection.getCurrent(),i=this.inspector.parse(e);this.app.broadcast("state",t),this.component.isNonEditable(e)&&(this._passSelectionToClipboard(t,i,!1),t.preventDefault())},drop:function(t){if((t=t.originalEvent||t).stopPropagation(),this._removeOverClass(),this.opts.dragUpload!==!1){if(this.app.isDragComponentInside()){var e=r.dom(this.app.getDragComponentInside()),i=e.clone(!0);return this.insertion.insertToPoint(t,i),e.remove(),this.app.setDragComponentInside(!1),this.app.broadcast("state",t),this.app.broadcast("drop",t),this.app.broadcast("image.observe",t),void t.preventDefault()}if(this.app.isDragInside()&&this.opts.input){this.insertion.insertPoint(t);var s=t.dataTransfer.getData("text/html"),n=this.selection.getRange();if(n){var o=this.selection.getBlocks();n.deleteContents();for(var a=0;a<o.length;a++)o[a].innerHTML===""&&r.dom(o[a]).remove()}return r.create("input.paste",this.app,t,!0,s,!0),this.app.broadcast("state",t),this.app.broadcast("drop",t),this.app.setDragInside(!1),void t.preventDefault()}this.app.broadcast("state",t),this.app.broadcast("paste",t,t.dataTransfer),this.app.broadcast("drop",t)}else t.preventDefault()},dragenter:function(t){t.preventDefault()},dragstart:function(t){this.app.setDragComponentInside(!1),this.app.setDragInside(!1);var e=this.inspector.parse(t.target);!e.isComponent()||e.isComponentEditable()||e.isFigcaption()?this.selection.is()&&!this.selection.isCollapsed()&&(this.app.setDragInside(!0),this._setDragData(t)):this.app.setDragComponentInside(e.getComponent()),this.app.broadcast("dragstart",t)},dragover:function(t){this.app.broadcast("dragover",t)},dragleave:function(t){this.app.broadcast("dragleave",t)},paste:function(t){this.app.broadcast("paste",t)},contextmenu:function(t){},click:function(t){if(t.detail===3){t.preventDefault();var e=this.selection.getBlock();if(e){var i=document.createRange();i.selectNodeContents(e),this.selection.setRange(i)}}var s=r.dom(t.target);if(s.hasClass("redactor-in")){var n=s.offset().top,o=parseFloat(s.css("padding-bottom"));n+s.height()-2*o<t.pageY?this.app.broadcast("bottomclick",t):s.hasClass("redactor-placeholder")&&this.editor.startFocus(this.editor)}this.app.broadcast("state",t),this.app.broadcast("click",t)},keydown:function(t){if(this.app.broadcast("state",t),this.app.broadcast("keydown",t)===!1)return t.preventDefault()},keyup:function(t){this.app.broadcast("keyup",t)},mouseup:function(t){this.app.broadcast("observe",t),this.app.broadcast("state",t)},touchstart:function(t){this.app.broadcast("observe",t),this.app.broadcast("state",t)},_init:function(){this.editor.getElement().on("focus.redactor-focus click.redactor-focus",this.focus.bind(this)),this.$doc.on("keyup"+this.blurNamespace+" mousedown"+this.blurNamespace,this.blur.bind(this)),this._loop("on")},_removeOverClass:function(){this.editor.getElement().removeClass("over")},_loop:function(t){for(var e=this.editor.getElement(),i=0;i<this.eventsList.length;i++){var s=this.eventsList[i]+".redactor-events",n=this.eventsList[i];e[t](s,this[n].bind(this))}},_passAllToClipboard:function(t){var e=t.clipboardData,i=this.source.getCode();e.setData("text/html",i),e.setData("text/plain",i.toString().replace(/\n$/,""))},_passSelectionToClipboard:function(t,e,i){var s=t.clipboardData,n=e.getComponent(),o=r.dom(n).clone();o.find(".redactor-component-caret").remove(),o.removeClass("redactor-component-active"),o.removeAttr("contenteditable"),o.removeAttr("tabindex");var a=o.get().outerHTML;i&&this.component.remove(n),s.setData("text/html",a),s.setData("text/plain",a.toString().replace(/\n$/,""))},_setDragData:function(t){var e=(t=t.originalEvent||t).dataTransfer;e.effectAllowed="move",e.setData("text/Html",this.selection.getHtml())}}),r.add("module","container",{init:function(t){this.app=t,this.uuid=t.uuid,this.opts=t.opts,this.lang=t.lang,this.element=t.element,this.container=t.container},start:function(){this._build(),this._buildAccesibility()},stop:function(){var t=this.element.getElement(),e=this.container.getElement();e.after(t),e.remove(),t.show()},_build:function(){var t=this.element.getElement(),e=this.container.getElement();e.addClass("redactor-box"),e.attr("dir",this.opts.direction),this.element.isType("inline")&&e.addClass("redactor-inline"),t.after(e),e.append(t)},_buildAccesibility:function(){var t=this.container.getElement(),e=r.dom("<span />");e.addClass("redactor-voice-label"),e.attr({id:"redactor-voice-"+this.uuid,"aria-hidden":!1}),e.html(this.lang.get("accessibility-help-label")),t.prepend(e)}}),r.add("module","source",{init:function(t){this.app=t,this.uuid=t.uuid,this.opts=t.opts,this.utils=t.utils,this.element=t.element,this.source=t.source,this.editor=t.editor,this.toolbar=t.toolbar,this.cleaner=t.cleaner,this.component=t.component,this.container=t.container,this.autoparser=t.autoparser,this.selection=t.selection,this.syncedHtml=""},onstartcode:function(){var t=this.source.getStartedContent(),e=this.editor.getElement(),i=this.source.getElement();this.opts.autoparse&&this.opts.autoparseStart&&(t=this.autoparser.parse(t));var s=this.cleaner.input(t,!0,!0),n=this.cleaner.output(s);e.html(s),i.val(n),this.syncedHtml=n,this.app.broadcast("placeholder.build"),this.app.broadcast("autoparseobserve"),this.component.executeScripts()},onstartcodeshow:function(){this.show()},ontrytosync:function(){this.sync()},onhardsync:function(){var t=this.editor.getElement().html();t=this.app.broadcast("syncBefore",t),t=this.cleaner.output(t),this._syncing(t)},start:function(){this._build(),this._buildClasses()},stop:function(){var t=this.element.getElement(),e=this.source.getElement();t.removeClass("redactor-source redactor-source-open"),e.off("input.redactor-source"),e.removeAttr("data-gramm_editor"),e.get().classList.length===0&&e.removeAttr("class"),this.source.isNameGenerated()||t.removeAttr("name"),this.element.isType("textarea")||e.remove()},getCode:function(){return this.source.getCode()},toggle:function(){if(this.opts.source)return this.source.getElement().hasClass("redactor-source-open")?this.hide():this.show()},show:function(){if(this.opts.source){var t=this.editor.getElement(),e=this.source.getElement(),i=this.container.getElement(),s=e.val();this.app.isStarted()&&(s=this.app.broadcast("source.open",s));var n=t.height();if(t.hide(),e.height(n),e.val(s.trim()),e.show(),e.addClass("redactor-source-open"),e.on("input.redactor-source-events",this._onChangedSource.bind(this)),e.on("keydown.redactor-source-events",this._onTabKey.bind(this)),e.on("focus.redactor-source-events",this._onFocus.bind(this)),this.opts.source.hasOwnProperty("codemirror")){var o=typeof this.opts.source.codemirror=="object"?this.opts.source.codemirror:{},a=this.opts.source.codemirrorSrc!==void 0?this.opts.source.codemirrorSrc:$;this.codemirror=a.fromTextArea(e.get(),o),this.codemirror.setSize(null,n),this.codemirror.on("change",function(l,h){l.save()}),this.codemirror.on("change",this._onChangedSource.bind(this))}else i.addClass("redactor-source-view");setTimeout((function(){this._disableButtons(),this._setActiveSourceButton()}).bind(this),100),this.app.isStarted()&&this.app.broadcast("source.opened")}},hide:function(){if(this.opts.source){var t=this.editor.getElement(),e=this.source.getElement(),i=this.container.getElement(),s=e.val();this.opts.source.hasOwnProperty("codemirror")&&(s=this.codemirror.getValue(),this.codemirror.toTextArea()),s=this.cleaner.input(s,!0),s=this.utils.isEmptyHtml(s)?this.opts.emptyHtml:s,s=this.app.broadcast("source.close",s),this._enableButtons(),this._setInactiveSourceButton(),e.hide(),e.removeClass("redactor-source-open"),e.off(".redactor-source-events"),t.show(),t.html(s),i.removeClass("redactor-source-view"),setTimeout((function(){this.editor.startFocus(),this.component.executeScripts()}).bind(this),0),this.app.broadcast("source.closed")}},sync:function(){var t=this,e=this.editor.getElement().html();e=this.app.broadcast("syncBefore",e),e=this.cleaner.output(e),this._isSync(e)&&(this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(function(){t._syncing(e)},200))},_build:function(){var t=this.source.getElement(),e=this.element.getElement();t.hide(),this.opts.grammarly||t.attr("data-gramm_editor",!1),this.element.isType("textarea")||e.after(t)},_buildClasses:function(){this.source.getElement().addClass("redactor-source")},_syncing:function(t){t=this.app.broadcast("syncing",t),this.source.getElement().val(t),this.app.broadcast("synced",t),this.app.broadcast("changed",t)},_isSync:function(t){return this.syncedHtml!==t&&(this.syncedHtml=t,!0)},_onChangedSource:function(){var t=this.source.getElement().val();this.app.broadcast("changed",t),this.app.broadcast("source.changed",t)},_onTabKey:function(t){if(t.keyCode!==9)return!0;t.preventDefault();var e=this.source.getElement(),i=e.get(),s=i.selectionStart;e.val(e.val().substring(0,s)+"    "+e.val().substring(i.selectionEnd)),i.selectionStart=i.selectionEnd=s+4},_onFocus:function(){this.app.broadcast("sourcefocus")},_disableButtons:function(){this.toolbar.disableButtons()},_enableButtons:function(){this.toolbar.enableButtons()},_setActiveSourceButton:function(){var t=this.toolbar.getButton("html");t.enable(),t.setActive()},_setInactiveSourceButton:function(){this.toolbar.getButton("html").setInactive()}}),r.add("module","observer",{init:function(t){this.app=t,this.editor=t.editor,this.observerUnit=!1},start:function(){if(window.MutationObserver){var t=this.editor.getElement().get();this.observerUnit=this._build(t),this.observerUnit.observe(t,{attributes:!0,subtree:!0,childList:!0,characterData:!0,characterDataOldValue:!0})}},stop:function(){this.observerUnit&&this.observerUnit.disconnect()},_build:function(t){var e=this;return new MutationObserver(function(i){e._observe(i[i.length-1],t)})},_observe:function(t,e){this.app.isReadOnly()||t.type==="attributes"&&t.target===e||(this.app.broadcast("observe"),this.app.broadcast("trytosync"),this.app.broadcast("placeholder.toggle"))}}),r.add("module","clicktoedit",{init:function(t){this.app=t,this.opts=t.opts,this.source=t.source,this.editor=t.editor,this.container=t.container,this.selection=t.selection},onstartclicktoedit:function(){this.start()},onenablereadonly:function(){this.opts.clickToEdit&&(this._isEnabled()||this.stop())},ondisablereadonly:function(){this.opts.clickToEdit&&(this._isEnabled()||this.start())},onstop:function(){this.stop()},start:function(){this._build()},stop:function(){this.buttonSave&&this.buttonSave.stop(),this.buttonCancel&&this.buttonCancel.stop(),this._destroy(),this.app.broadcast("disable")},enable:function(){this.app.broadcast("clickStart");var t=this.editor.isEmpty();t||this.selection.saveMarkers(),this._setFocus(),this._destroy(),this.app.broadcast("enable"),this.buttonSave.enable(),this.buttonCancel.enable(),t||this.selection.restoreMarkers(),t&&this.editor.focus(),this.container.getElement().addClass("redactor-clicktoedit-enabled"),this.source.rebuildStartedContent(),this.app.broadcast("startcode"),this.app.broadcast("image.observe")},save:function(t){t&&t.preventDefault();var e=this.source.getCode();this.app.broadcast("disable"),this.app.broadcast("clickSave",e),this.app.broadcast("clickStop"),this.app.broadcast("toolbar.removeexternal"),this._build()},cancel:function(t){t&&t.preventDefault();var e=this.saved;this.editor.getElement().html(e),this.saved="",this.app.broadcast("disable"),this.app.broadcast("clickCancel",e),this.app.broadcast("clickStop"),this.app.broadcast("toolbar.removeexternal"),this._build()},_build:function(){this.buttonSave=r.create("clicktoedit.button","save",this.app,this),this.buttonCancel=r.create("clicktoedit.button","cancel",this.app,this),this.buttonSave.stop(),this.buttonCancel.stop();var t=this.editor.getElement(),e=this.container.getElement();t.on("click.redactor-click-to-edit mouseup.redactor-click-to-edit",this.enable.bind(this)),e.addClass("redactor-over"),e.removeClass("redactor-clicktoedit-enabled")},_isEnabled:function(){return this.container.getElement().hasClass("redactor-clicktoedit-enabled")},_destroy:function(){var t=this.editor.getElement(),e=this.container.getElement();t.off(".redactor-click-to-edit"),e.removeClass("redactor-over redactor-clicktoedit-enabled")},_setFocus:function(){this.saved=this.source.getCode(),this.buttonSave.start(),this.buttonCancel.start()}}),r.add("class","clicktoedit.button",{init:function(t,e,i){this.app=e,this.opts=e.opts,this.toolbar=e.toolbar,this.context=i,this.type=t,this.name=t==="save"?"clickToSave":"clickToCancel",this.objected=!1,this.enabled=!1,this.namespace=".redactor-click-to-edit",this._build()},enable:function(){if(this.objected){var t=this.opts[this.name];t.api="module.clicktoedit."+this.type,this.toolbar.addButton(this.type,t),this.enabled=!0}},start:function(){this.objected||(this.$button.off(this.namespace),this.$button.show(),this.$button.on("click"+this.namespace,this.context[this.type].bind(this.context)))},stop:function(){!this.objected&&this.enabled&&this.$button.hide()},_build:function(){this.objected=typeof this.opts[this.name]=="object",this.objected||(this.$button=r.dom(this.opts[this.name]),this.enabled=!0)}}),r.add("module","statusbar",{init:function(t){this.app=t,this.opts=t.opts,this.element=t.element,this.statusbar=t.statusbar,this.container=t.container},start:function(){if(!this.element.isType("inline")){var t=this.statusbar.getElement(),e=this.container.getElement();t.addClass("redactor-statusbar"),e.append(t)}}}),r.add("module","contextbar",{init:function(t){this.app=t,this.opts=t.opts,this.uuid=t.uuid,this.$win=t.$win,this.$doc=t.$doc,this.$body=t.$body,this.editor=t.editor,this.toolbar=t.toolbar,this.detector=t.detector,this.$target=this.toolbar.isTarget()?this.toolbar.getTargetElement():this.$body},onstop:function(){this.stop()},onenablereadonly:function(){this.stop()},ondisablereadonly:function(){this.start()},oncontextbar:{close:function(){this.close()}},start:function(){if(this.opts.toolbarContext){var t=this.editor.getElement();this._build(),t.on("click.redactor-context mouseup.redactor-context",this.open.bind(this)),this.opts.scrollTarget?r.dom(this.opts.scrollTarget).on("scroll.redactor-context",this.close.bind(this)):this.opts.maxHeight!==!1&&t.on("scroll.redactor-context",this.close.bind(this))}},stop:function(){this.editor.getElement().off(".redactor-context"),this.$doc.off(".redactor-context"),this.$win.off(".redactor-context"),this.$contextbar&&this.$contextbar.remove(),this.opts.scrollTarget&&r.dom(this.opts.scrollTarget).off(".redactor-context")},is:function(){return this.$contextbar&&this.$contextbar.hasClass("open")},set:function(t,e,i,s){for(var n in this.$contextbar.html(""),this.$el=r.dom(e),i){var o=r.create("contextbar.button",this.app,i[n]);o.html()!==""&&this.$contextbar.append(o)}var a=this._buildPosition(t,this.$el,s);this.$contextbar.css(a),this.$contextbar.show(),this.$contextbar.addClass("open"),this.$doc.on("click.redactor-context mouseup.redactor-context",this.close.bind(this)),this.$win.on("resize.redactor-context",this.close.bind(this))},open:function(t){setTimeout((function(){this.app.broadcast("contextbar",t,this)}).bind(this),0)},close:function(t){if(this.$contextbar){if(t){var e=r.dom(t.target);if(this.$el&&e.closest(this.$el).length!==0)return}this.$contextbar.hide(),this.$contextbar.removeClass("open"),this.$doc.off(".redactor.context")}},_build:function(){this.$contextbar=r.dom("<div>"),this.$contextbar.attr("id","redactor-context-toolbar-"+this.uuid),this.$contextbar.attr("dir",this.opts.direction),this.$contextbar.addClass("redactor-context-toolbar"),this.$contextbar.hide(),this.$target.append(this.$contextbar)},_buildPosition:function(t,e,i){var s,n,o=this.toolbar.isTarget(),a=o?e.position():e.offset(),l=e.width(),h=e.height(),c=this.$contextbar.width(),d=this.$contextbar.height(),u=o?this.$target.scrollTop()+this.$doc.scrollTop():this.$doc.scrollTop(),p=this.$target.offset(),f=o?p.left:0,v=o?p.top:0;return i?i==="top"?(s=a.top-d,n=a.left+l/2-c/2):i==="bottom"&&(s=a.top+h,n=a.left+l/2-c/2):(s=t.clientY+u-d,n=t.clientX-c/2),n<0&&(n=0),{top:s-v+"px",left:n-f+"px"}}}),r.add("class","contextbar.button",{mixins:["dom"],init:function(t,e){this.app=t,this.obj=e,this._init()},_init:function(){if(this.parse("<a>"),typeof this.obj.title!="string"){var t=this.obj.title.attr("href");this.attr("href",t),t.search(/^#/)===-1&&this.attr("target","_blank"),this.text(this.obj.html||t)}else this.attr("href","#"),this._buildTitle(),this._buildMessage()},_buildTitle:function(){this.html(this.obj.title)},_buildMessage:function(){this.obj.message===void 0&&this.obj.api===void 0||this.on("click",this._toggle.bind(this))},_toggle:function(t){t.preventDefault(),this.obj.message?this.app.broadcast(this.obj.message,this.obj.args):this.obj.api&&this.app.api(this.obj.api,this.obj.args)}}),r.add("module","toolbar",{init:function(t){this.app=t,this.uuid=t.uuid,this.opts=t.opts,this.utils=t.utils,this.toolbar=t.toolbar,this.detector=t.detector,this.buttons=[],this.toolbarModule=!1},onsource:{open:function(){!this.toolbar.isAir()&&this.toolbar.isFixed()&&this.toolbarModule.resetPosition()},opened:function(){this.toolbar.isAir()&&this.toolbarModule&&this.toolbarModule.createSourceHelper(),setTimeout((function(){r.dom(".re-button-tooltip-"+this.uuid).remove()}).bind(this),100)},close:function(){this.toolbar.isAir()&&this.toolbarModule&&this.toolbarModule.destroySourceHelper()},closed:function(){this.toolbar.is()&&this.opts.air&&this.toolbarModule.openSelected()}},ontoolbar:{removeexternal:function(){!this.opts.air&&this.opts.toolbarExternal&&this.opts.clickToEdit&&r.dom(this.opts.toolbarExternal).html("")}},onobserve:function(){this.toolbar.is()&&this.toolbar.observe()},onfocus:function(){this._setExternalOnFocus()},onsourcefocus:function(){this._setExternalOnFocus()},onempty:function(){this.toolbar.isFixed()&&this.toolbarModule.resetPosition()},onenablereadonly:function(){this.toolbar.isAir()&&this.toolbarModule.close()},start:function(){this.toolbar.is()&&(this._buildButtons(),this._initToolbar(),this._initButtons())},stop:function(){this.toolbarModule&&this.toolbarModule.stop(),r.dom(".re-button-tooltip-"+this.uuid).remove(),r.dom(".redactor-dropdown-"+this.uuid).remove()},_buildButtons:function(){this.buttons=this.opts.buttons.concat(),this._buildImageButton(),this._buildFileButton(),this._buildSourceButton(),this._buildAdditionalButtons(),this._buildHiddenButtons()},_buildImageButton:function(){this.opts.imageUpload||this.opts.imageManagerJson||this.utils.removeFromArrayByValue(this.buttons,"image")},_buildFileButton:function(){this.opts.fileUpload||this.utils.removeFromArrayByValue(this.buttons,"file")},_buildSourceButton:function(){this.opts.source||this.utils.removeFromArrayByValue(this.buttons,"html")},_buildAdditionalButtons:function(){var t,e;if(this.opts.buttonsAdd.length!==0&&(this.opts.buttonsAdd=this._removeExistButtons(this.opts.buttonsAdd),this.buttons=this.buttons.concat(this.opts.buttonsAdd)),this.opts.buttonsAddFirst.length!==0&&(this.opts.buttonsAddFirst=this._removeExistButtons(this.opts.buttonsAddFirst),this.buttons.unshift(this.opts.buttonsAddFirst)),this.opts.buttonsAddAfter!==!1){t=this.buttons.indexOf(this.opts.buttonsAddAfter.after)+1,e=this.opts.buttonsAddAfter.buttons;for(var i=0;i<e.length;i++)this.buttons.splice(t+i,0,e[i])}if(this.opts.buttonsAddBefore!==!1)for(t=this.buttons.indexOf(this.opts.buttonsAddBefore.before)+1,e=this.opts.buttonsAddBefore.buttons,i=0;i<e.length;i++)this.buttons.splice(t-(1-i),0,e[i])},_buildHiddenButtons:function(){if(this.opts.buttonsHide.length!==0)for(var t=this.opts.buttonsHide,e=0;e<t.length;e++)this.utils.removeFromArrayByValue(this.buttons,t[e]);if(this.detector.isMobile()&&this.opts.buttonsHideOnMobile.length!==0)for(t=this.opts.buttonsHideOnMobile,e=0;e<t.length;e++)this.utils.removeFromArrayByValue(this.buttons,t[e])},_removeExistButtons:function(t){for(var e=0;e<t.length;e++)this.opts.buttons.indexOf(t[e])!==-1&&this.utils.removeFromArrayByValue(t,t[e]);return t},_setExternalOnFocus:function(){!this.opts.air&&this.opts.toolbarExternal&&this.toolbarModule.setExternal()},_initToolbar:function(){this.toolbarModule=this.opts.air?r.create("toolbar.air",this.app):r.create("toolbar.standard",this.app)},_initButtons:function(){this.toolbar.setButtons(this.buttons);for(var t=0;t<this.buttons.length;t++){var e=this.buttons[t];r.buttons[e]&&this.toolbar.addButton(e,r.extend(!0,{},r.buttons[e]),!1,!1,!0)}}}),r.add("class","toolbar.air",{init:function(t){this.app=t,this.uuid=t.uuid,this.$doc=t.$doc,this.$win=t.$win,this.utils=t.utils,this.editor=t.editor,this.animate=t.animate,this.toolbar=t.toolbar,this.container=t.container,this.inspector=t.inspector,this.selection=t.selection,this.clicks=0,this._init()},stop:function(){this.toolbar.getWrapper().remove(),this.editor.getElement().off(".redactor-air-trigger-"+this.uuid),this.$doc.off(".redactor-air-"+this.uuid),this.$doc.off(".redactor-air-trigger-"+this.uuid),this.toolbar.stopObservers()},createSourceHelper:function(){this.$airHelper=r.dom("<span>"),this.$airHelper.addClass("redactor-air-helper"),this.$airHelper.html('<i class="re-icon-html"></i>'),this.$airHelper.on("click",(function(t){t.preventDefault(),this.app.api("module.source.hide")}).bind(this)),this.container.getElement().append(this.$airHelper)},destroySourceHelper:function(){this.$airHelper&&this.$airHelper.remove()},openSelected:function(){setTimeout((function(){this._isSelection()&&this._open(!1)}).bind(this),0)},close:function(){this.$doc.off(".redactor-air-"+this.uuid);var t=this.toolbar.getElement();t.removeClass("open"),t.hide()},_init:function(){this.toolbar.create();var t=this.toolbar.getWrapper(),e=this.toolbar.getElement(),i=this.editor.getElement(),s=this.container.getElement();t.addClass("redactor-toolbar-wrapper-air"),e.addClass("redactor-air"),e.hide(),t.append(e),s.prepend(t),this.openSelected(),this.$doc.on("mouseup.redactor-air-trigger-"+this.uuid,this._open.bind(this)),i.on("keyup.redactor-air-trigger-"+this.uuid,this._openCmd.bind(this))},_isSelection:function(){return this.selection.is()&&!this.selection.isCollapsed()},_isOpened:function(){return this.toolbar.getElement().hasClass("open")},_open:function(t){var e=!!t&&t.target,i=!!t&&r.dom(t.target),s=this.inspector.parse(e),n=s.isComponent()&&!s.isComponentType("table"),o=s.isFigcaption(),a=i&&i.closest(".redactor-modal").length!==0,l=t&&i.closest(".re-button").length!==0;if(!(t&&i.closest(".redactor-dropdown").length!==0||l||a||o||n||this.toolbar.isContextBar())&&this._isSelection()){var h=this.selection.getPosition();setTimeout((function(){this.app.isReadOnly()||this._isSelection()&&this._doOpen(h)}).bind(this),1)}},_openCmd:function(){if(this.selection.isAll()){var t=this.toolbar.getElement(),e=this.selection.getPosition();e.top=e.top<20?0:e.top-t.height(),e.height=0,this._doOpen(e)}},_doOpen:function(t){var e=this.toolbar.getWrapper(),i=this.toolbar.getElement(),s=this.container.getElement().offset(),n=0,o=this.$win.width(),a=i.width();o<t.left+a&&(n=a-this.selection.getPosition().width),e.css({left:t.left-s.left-n+"px",top:t.top-s.top+t.height+this.$doc.scrollTop()+"px"}),this.app.broadcast("airOpen"),i.addClass("open"),i.show(),this.$doc.on("click.redactor-air-"+this.uuid,this._close.bind(this)),this.$doc.on("keydown.redactor-air-"+this.uuid,this._close.bind(this)),this.app.broadcast("airOpened")},_close:function(t){var e=!!t&&r.dom(t.target),i=t&&e.closest("[data-dropdown], .redactor-dropdown-not-close").length!==0;(!i&&t&&e.closest(".re-button").length!==0||!i&&this._isOpened())&&(this.app.broadcast("airClose"),this.close(),this.app.broadcast("airClosed"))}}),r.add("class","toolbar.fixed",{init:function(t){this.app=t,this.uuid=t.uuid,this.opts=t.opts,this.$doc=t.$doc,this.$win=t.$win,this.editor=t.editor,this.toolbar=t.toolbar,this.detector=t.detector,this.container=t.container,this._init()},stop:function(){this.$fixedTarget.off(".redactor-toolbar-"+this.uuid),this.$win.off(".redactor-toolbar-"+this.uuid)},reset:function(){var t=this.toolbar.getElement();this.toolbar.getWrapper().css("height",""),t.removeClass("redactor-toolbar-fixed"),t.css({position:"",top:"",left:"",width:""});var e=this.toolbar.getDropdown();e&&e.updatePosition()},_init:function(){this.$fixedTarget=this.toolbar.isTarget()?this.toolbar.getTargetElement():this.$win,this._doFixed(),this.toolbar.isTarget()&&(this.$win.on("scroll.redactor-toolbar-"+this.uuid,this._doFixed.bind(this)),this.$win.on("resize.redactor-toolbar-"+this.uuid,this._doFixed.bind(this))),this.$fixedTarget.on("scroll.redactor-toolbar-"+this.uuid,this._doFixed.bind(this)),this.$fixedTarget.on("resize.redactor-toolbar-"+this.uuid,this._doFixed.bind(this))},_doFixed:function(){var t=this.editor.getElement(),e=this.container.getElement(),i=this.toolbar.getElement(),s=this.toolbar.getWrapper();if(!this.editor.isSourceMode()&&e.parents().filter(function(v){return getComputedStyle(v,null).display==="none"&&v}).length===0){var n=t.height()<100,o=this.editor.isEmpty();if(n||o)this.reset();else if(!this.editor.isSourceMode()){var a=i.height(),l=(this.toolbar.isTarget()?e.position():e.offset()).top,h=l+e.height()-60,c=this.$fixedTarget.scrollTop()+this.opts.toolbarFixedTopOffset,d=this.toolbar.isTarget()?this.$fixedTarget.offset().top-this.$win.scrollTop():0;if(this.toolbar.isTarget()&&this.$fixedTarget.css("position")==="fixed"){var u=this.$fixedTarget.hasClass("modal")&&this.$fixedTarget.hasClass("fade")?e.closest(".modal-dialog").position().top:0;d=this.$fixedTarget.scrollTop()-u}if(l<c&&c<h){var p=this.detector.isDesktop()?"fixed":"absolute";d=this.detector.isDesktop()?d:c-l,this.detector.isMobile()&&(this.fixedScrollTimeout&&clearTimeout(this.fixedScrollTimeout),i.hide(),this.fixedScrollTimeout=setTimeout(function(){i.show()},250)),s.height(a),i.addClass("redactor-toolbar-fixed"),e.hasClass("redactor-box-fullscreen")?i.css({position:p,top:"0px",width:e.width()+"px"}):i.css({position:p,top:d+this.opts.toolbarFixedTopOffset+"px",width:e.width()+"px"});var f=this.toolbar.getDropdown();f&&f.updatePosition(),this.app.broadcast("toolbar.fixed")}else this.reset(),this.app.broadcast("toolbar.unfixed")}}}}),r.add("class","toolbar.standard",{init:function(t){this.app=t,this.opts=t.opts,this.uuid=t.uuid,this.$body=t.$body,this.toolbar=t.toolbar,this.container=t.container,this.isExternalMultiple=!1,this.toolbarFixed=!1,this._init()},stop:function(){this.toolbar.getWrapper().remove(),this.toolbarFixed&&this.toolbarFixed.stop(),this.opts.toolbarExternal&&this._findToolbars(),this.toolbar.stopObservers(),this.$body.find(".re-button-tooltip-"+this.uuid).remove()},setExternal:function(){this._findToolbars(),this.isExternalMultiple&&(this.$toolbars.hide(),this.$external.find(".redactor-toolbar-external-"+this.uuid).show())},resetPosition:function(){this.toolbarFixed&&this.toolbarFixed.reset()},_init:function(){this._build(),this.opts.toolbarExternal?this._buildExternal():(this._buildFixed(),this.toolbar.getElement().show())},_build:function(){this.toolbar.create();var t=this.toolbar.getWrapper(),e=this.toolbar.getElement();t.addClass("redactor-toolbar-wrapper"),e.addClass("redactor-toolbar"),e.hide(),t.append(e),this.opts.toolbarExternal||this.container.getElement().prepend(t)},_buildExternal:function(){this._initExternal(),this._findToolbars(),this.isExternalMultiple?this._hideToolbarsExceptFirst():this.toolbar.getElement().show()},_buildFixed:function(){this.opts.toolbarFixed&&(this.toolbarFixed=r.create("toolbar.fixed",this.app))},_initExternal:function(){var t=this.toolbar.getElement(),e=this.toolbar.getElement();t.addClass("redactor-toolbar-external redactor-toolbar-external-"+this.uuid),this.$external=r.dom(this.opts.toolbarExternal),this.$external.append(e)},_findToolbars:function(){this.$toolbars=this.$external.find(".redactor-toolbar-external"),this.isExternalMultiple=1<this.$toolbars.length},_hideToolbarsExceptFirst:function(){this.$toolbars.hide(),this.$toolbars.first().show()}}),r.add("module","line",{init:function(t){this.app=t,this.lang=t.lang,this.component=t.component,this.inspector=t.inspector,this.insertion=t.insertion},oncontextbar:function(t,e){var i=this.inspector.parse(t.target);if(i.isComponentType("line")){var s=i.getComponent(),n={remove:{title:this.lang.get("delete"),api:"module.line.remove",args:s}};e.set(t,s,n,"bottom")}},insert:function(){var t=this.component.create("line");this.insertion.insertRaw(t)},remove:function(t){this.component.remove(t)}}),r.add("class","line.component",{mixins:["dom","component"],init:function(t,e){return this.app=t,e&&e.cmnt!==void 0?e:this._init(e)},_init:function(t){var e,i;if(t!==void 0){var s=r.dom(t),n=s.get();n.tagName==="HR"?i=n:n.tagName==="FIGURE"&&(e=n,i=s.find("hr").get())}this._buildWrapper(e),this._buildElement(i),this._initWrapper()},_buildElement:function(t){t?this.$element=r.dom(t):(this.$element=r.dom("<hr>"),this.append(this.$element))},_buildWrapper:function(t){t=t||"<figure>",this.parse(t)},_initWrapper:function(){this.addClass("redactor-component"),this.attr({"data-redactor-type":"line",tabindex:"-1",contenteditable:!1})}}),r.add("module","link",{modals:{link:'<form action="">                 <div class="form-item">                     <label for="modal-link-url">URL <span class="req">*</span></label>                     <input type="text" id="modal-link-url" name="url">                 </div>                 <div class="form-item">                     <label for="modal-link-text">## text ##</label>                     <input type="text" id="modal-link-text" name="text">                 </div>                 <div class="form-item form-item-title">                     <label for="modal-link-title">## title ##</label>                     <input type="text" id="modal-link-title" name="title">                 </div>                 <div class="form-item form-item-target">                     <label class="checkbox">                         <input type="checkbox" name="target"> ## link-in-new-tab ##                     </label>                 </div>             </form>'},init:function(t){this.app=t,this.opts=t.opts,this.lang=t.lang,this.caret=t.caret,this.utils=t.utils,this.inline=t.inline,this.editor=t.editor,this.inspector=t.inspector,this.insertion=t.insertion,this.selection=t.selection,this.isCurrentLink=!1,this.currentText=!1},onmodal:{link:{open:function(t,e){this._setFormData(e,t)},opened:function(t,e){this._setFormFocus(e)},update:function(t,e){var i=e.getData();this._validateData(e,i)&&this._update(i)},insert:function(t,e){var i=e.getData();this._validateData(e,i)&&this._insert(i)},unlink:function(){this._unlink()}}},onbutton:{link:{observe:function(t){this._observeButton(t)}}},ondropdown:{link:{observe:function(t){this._observeUnlink(t),this._observeEdit(t)}}},oncontextbar:function(t,e){var i=this._getCurrent(),s=this.inspector.parse(i);if(s.isLink()||s.isFile()){var n=s.isFile()?s.getFile():s.getLink(),o=r.dom(n),a=r.dom("<a>"),l=o.attr("href");a.text(this._truncateText(l)),a.attr("href",l),a.attr("target","_blank");var h={link:{title:a,html:this._truncateText(l)},edit:{title:this.lang.get("edit"),api:"module.link.open"},unlink:{title:this.lang.get("unlink"),api:"module.link.unlink"}};e.set(t,n,h,"bottom")}},open:function(){this.$link=this._buildCurrent(),this.app.api("module.modal.build",this._getModalData())},insert:function(t){this._insert(t)},update:function(t){this._update(t)},unlink:function(){this._unlink()},_observeButton:function(t){var e=this.selection.getCurrent(),i=this.inspector.parse(e);i.isPre()||i.isCode()?t.disable():t.enable()},_observeUnlink:function(t){var e=t.getItem("unlink");this._getLinks().length===0?e.disable():e.enable()},_observeEdit:function(t){var e=this._getCurrent(),i=t.getItem("link"),s=this.inspector.parse(e),n=s.isLink()||s.isFile()?this.lang.get("link-edit"):this.lang.get("link-insert");i.setTitle(n)},_unlink:function(){this.app.api("module.modal.close");var t=[],e=this._getLinks();this.selection.save();for(var i=0;i<e.length;i++){var s=r.create("link.component",this.app,e[i]);t.push(this.selection.getElement(e[i])),s.unwrap(),this.app.broadcast("link.deleted",s)}for(this.selection.restore(),i=0;i<t.length;i++){var n=t[i]?t[i]:this.editor.getElement();this.utils.normalizeTextNodes(n)}this._resetCurrent()},_update:function(t){this.app.api("module.modal.close");var e=this._getLinks();this._setLinkData(e,t,"updated"),this._resetCurrent(),this.app.broadcast("link.changed",e)},_insert:function(t){this.app.api("module.modal.close");var e=this._getLinks();this._insertSingle(e,t)||(this._removeInSelection(e),this._insertMultiple(t)),this._resetCurrent()},_removeInSelection:function(t){this.selection.save();for(var e=0;e<t.length;e++){var i=r.create("link.component",this.app,t[e]),s=i.clone();i.unwrap(),this.app.broadcast("link.deleted",s)}this.selection.restore()},_insertMultiple:function(t){var e=this.selection.getRange();e&&this._isCurrentTextChanged(t)&&this._deleteContents(e);var i=this.inline.format({tag:"a"});this._setLinkData(i,t,"inserted")},_insertSingle:function(t,e){var i=this.selection.getInline();if(t.length===1&&(t[0].textContext===this.selection.getText()||i&&i.tagName==="A")){var s=r.create("link.component",this.app,t[0]);return s.setData(e),this.caret.setAfter(s),this.app.broadcast("link.inserted",s),!0}return!1},_setLinkData:function(t,e,i){e.text=e.text.trim()===""?this._truncateText(e.url):e.text;var s=!this.currentText||this.currentText!==e.text;this.selection.save();for(var n=0;n<t.length;n++){var o=r.create("link.component",this.app,t[n]),a={};e.text&&s&&(a.text=e.text),e.url&&(a.url=e.url),e.title!==void 0&&(a.title=e.title),e.target!==void 0&&(a.target=e.target),o.setData(a),this.app.broadcast("link."+i,o)}setTimeout(this.selection.restore.bind(this.selection),0)},_deleteContents:function(t){var e=this.selection.getHtml(),i=this.utils.parseHtml(e).nodes[0];if(i&&i.nodeType!==3){var s=i.tagName.toLowerCase(),n=document.createElement(s);this.insertion.insertNode(n,"start")}else t.deleteContents()},_getModalData:function(){var t;return t=this._isLink()?{update:{title:this.lang.get("save")},unlink:{title:this.lang.get("unlink"),type:"danger"},cancel:{title:this.lang.get("cancel")}}:{insert:{title:this.lang.get("insert")},cancel:{title:this.lang.get("cancel")}},{name:"link",title:this._isLink()?this.lang.get("link-edit"):this.lang.get("link-insert"),handle:this._isLink()?"update":"insert",commands:t}},_isLink:function(){return this.currentLink},_isCurrentTextChanged:function(t){return this.currentText&&this.currentText!==t.text},_buildCurrent:function(){var t,e=this._getCurrent(),i=this.inspector.parse(e);if(i.isLink()||i.isFile())this.currentLink=!0,t=i.isFile()?i.getFile():i.getLink(),t=r.create("link.component",this.app,t);else{this.currentLink=!1,t=r.create("link.component",this.app);var s={text:this.selection.getText()};t.setData(s)}return t},_getCurrent:function(){return this.selection.getInlinesAllSelected({tags:["a"]})[0]},_getLinks:function(){for(var t=this.selection.getInlines({all:!0,tags:["a"]}),e=[],i=0;i<t.length;i++){var s=this.inspector.parse(t[i]);(s.isLink()||s.isFile())&&e.push(t[i])}return e},_resetCurrent:function(){this.isCurrentLink=!1,this.currentText=!1},_truncateText:function(t){return t&&t.length>this.opts.linkSize?t.substring(0,this.opts.linkSize)+"...":t},_validateData:function(t,e){return e.url.trim()!==""||t.setError("url")},_setFormFocus:function(t){t.getField("url").focus()},_setFormData:function(t,e){var i=this.$link.getData(),s={url:i.url,text:i.text,title:i.title,target:this.opts.linkTarget||i.target};this.opts.linkNewTab||e.find(".form-item-target").hide(),this.opts.linkTitle||e.find(".form-item-title").hide(),t.setData(s),this.currentText=t.getField("text").val()}}),r.add("class","link.component",{mixins:["dom","component"],init:function(t,e){return this.app=t,this.opts=t.opts,this.reUrl=/^(?:(?:(?:https?|ftp):)?\/\/)?(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:[/?#]\S*)?$/i,e&&e.cmnt!==void 0?e:this._init(e)},setData:function(t){for(var e in t)this._set(e,t[e])},getData:function(){for(var t=["url","text","target","title"],e={},i=0;i<t.length;i++)e[t[i]]=this._get(t[i]);return e},_init:function(t){var e=r.dom(t);t===void 0?this.parse("<a>"):this.parse(e)},_set:function(t,e){this["_set_"+t](e)},_get:function(t){return this["_get_"+t]()},_get_target:function(){return!!this.attr("target")&&this.attr("target")},_get_url:function(){return this.attr("href")},_get_title:function(){return this.attr("title")},_get_text:function(){return this._getContext().text()},_getContext:function(){return this._findDeepestChild(this).element},_set_target:function(t){t===!1?this.removeAttr("target"):t&&this.attr("target",t===!0?"_blank":t)},_set_text:function(t){t=this._escapeHtml(t),this._getContext().html(t)},_set_title:function(t){t&&t!==""?this.attr("title",t):this.removeAttr("title")},_set_url:function(t){this.opts.linkValidation&&(t=this._cleanUrl(t),this._isMailto(t)?t="mailto:"+t.replace("mailto:",""):this._isUrl(t)&&t.search(/^(ftp|https?)/i)===-1&&(t="http://"+t.replace(/(ftp|https?):\/\//i,""))),this.attr("href",t)},_isMailto:function(t){return t.search("@")!==-1&&/(ftp|https?):\/\//i.test(t)===!1},_isUrl:function(t){return this.reUrl.test(t)},_cleanUrl:function(t){return(t=this._escapeHtml(t)).trim().replace(/[^\W\w\D\d+&\'@#/%?=~_|!:,.;\(\)]/gi,"")},_escapeHtml:function(t){return t.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},_findDeepestChild:function(t){var e={depth:0,element:t};return t.children().each((function(i){var s=r.dom(i);if(i.outerHTML===t.html()){var n=this._findDeepestChild(s);n.depth+1>e.depth&&(e={depth:1+n.depth,element:n.element})}}).bind(this)),e}}),r.add("module","modal",{init:function(t){this.app=t,this.uuid=t.uuid,this.lang=t.lang,this.$doc=t.$doc,this.$win=t.$win,this.$body=t.$body,this.utils=t.utils,this.editor=t.editor,this.animate=t.animate,this.detector=t.detector,this.selection=t.selection,this.$box=!1,this.$modal=!1,this.selectionMarkers=!1,this.defaults={name:!1,url:!1,title:!1,width:"600px",height:!1,handle:!1,commands:!1}},build:function(t){this._open(t)},close:function(){this._close()},onstop:function(){this.$body.find("#redactor-modal-"+this.uuid).remove(),this.$body.find("#redactor-overlay-"+this.uuid).remove()},stop:function(){this.$box&&(this.$box.remove(),this.$box=!1,this.$modal=!1),this.$overlay&&this.$overlay.remove(),this.$doc.off(".redactor.modal"),this.$win.off(".redactor.modal")},resize:function(){this.$modal.setWidth(this.p.width),this.$modal.updatePosition()},_isOpened:function(){return this.$modal&&this.$modal.hasClass("open")},_open:function(t){this._buildDefaults(t),this.p.url?this._openUrl():this._openTemplate()},_openUrl:function(){r.ajax.post({url:this.p.url,success:this._doOpen.bind(this)})},_openTemplate:function(){if(r.modals[this.p.name]!==void 0){var t=this.lang.parse(r.modals[this.p.name]);this._doOpen(t)}},_doOpen:function(t){this.stop(),this.selection.isCollapsed()?(this.selection.save(),this.selectionMarkers=!1):(this.selection.saveMarkers(),this.selectionMarkers=!0),this.detector.isDesktop()||document.activeElement.blur(),this._createModal(t),this._buildModalBox(),this._buildOverlay(),this._buildModal(),this._buildModalForm(),this._buildModalCommands(),this._broadcast("open"),this.$modal.updatePosition(),this._buildModalTabs(),this.animate.start(this.$box,"fadeIn",this._opened.bind(this)),this.animate.start(this.$overlay,"fadeIn")},_opened:function(){this.$modal.addClass("open"),this.$box.on("mousedown.redactor.modal",this._close.bind(this)),this.$doc.on("keyup.redactor.modal",this._handleEscape.bind(this)),this.$win.on("resize.redactor.modal",this.resize.bind(this)),this.$modal.getBody().find("input[type=text],input[type=url],input[type=email]").on("keydown.redactor.modal",this._handleEnter.bind(this)),window.jQuery&&window.jQuery(document).off("focusin.modal"),this._broadcast("opened")},_close:function(t){if(this.$box&&this._isOpened()){if(t){if(!this._needToClose(t.target))return;t.stopPropagation(),t.preventDefault()}this.selectionMarkers?this.selection.restoreMarkers():this.selection.restore(),this.selectionMarkers=!1,this._broadcast("close"),this.animate.start(this.$box,"fadeOut",this._closed.bind(this)),this.animate.start(this.$overlay,"fadeOut")}},_closed:function(){this.$modal.removeClass("open"),this.$box.off(".redactor.modal"),this.$doc.off(".redactor.modal"),this.$win.off(".redactor.modal"),this._broadcast("closed")},_createModal:function(t){this.$modal=r.create("modal.element",this.app,t)},_broadcast:function(t){this.app.broadcast("modal."+t,this.$modal,this.$modalForm),this.app.broadcast("modal."+this.p.name+"."+t,this.$modal,this.$modalForm)},_buildDefaults:function(t){this.p=r.extend({},this.defaults,t)},_buildModalBox:function(){this.$box=r.dom("<div>"),this.$box.attr("id","redactor-modal-"+this.uuid),this.$box.addClass("redactor-modal-box redactor-animate-hide"),this.$box.html(""),this.$body.append(this.$box)},_buildOverlay:function(){this.$overlay=r.dom("#redactor-overlay-"+this.uuid),this.$overlay.length===0&&(this.$overlay=r.dom("<div>"),this.$overlay.attr("id","redactor-overlay-"+this.uuid),this.$overlay.addClass("redactor-overlay redactor-animate-hide"),this.$body.prepend(this.$overlay))},_buildModal:function(){this.$box.append(this.$modal),this.$modal.setTitle(this.p.title),this.$modal.setHeight(this.p.height),this.$modal.setWidth(this.p.width)},_buildModalCommands:function(){if(this.p.commands){var t=this.p.commands,e=this.$modal.getFooter();for(var i in t){var s=r.dom("<button>");s.html(t[i].title),s.attr("data-command",i),i==="cancel"&&(s.attr("data-action","close"),s.addClass("redactor-button-unstyled")),t[i].type!==void 0&&t[i].type==="danger"&&s.addClass("redactor-button-danger"),s.on("click",this._handleCommand.bind(this)),e.append(s)}}},_buildModalTabs:function(){var t=this.$modal.getBody(),e=t.find(".redactor-modal-tab"),i=t.find(".redactor-modal-tabs");1<e.length&&((i=i.length===0?r.dom("<div>"):i.html("")).addClass("redactor-modal-tabs"),e.each((function(s,n){var o=r.dom(s),a=r.dom("<a>");a.attr("href","#"),a.attr("rel",n),a.text(o.attr("data-title")),a.on("click",this._showTab.bind(this)),n===0&&a.addClass("active"),i.append(a)}).bind(this)),t.prepend(i)),e.length===1&&e.show()},_buildModalForm:function(){this.$modalForm=r.create("modal.form",this.app,this.$modal.getForm())},_showTab:function(t){t.preventDefault();var e=r.dom(t.target),i=e.attr("rel"),s=this.$modal.getBody(),n=s.find(".redactor-modal-tab");n.hide(),n.eq(i).show(),s.find(".redactor-modal-tabs a").removeClass("active"),e.addClass("active")},_needToClose:function(t){var e=r.dom(t);return!(e.attr("data-action")!=="close"&&!this.$modal.isCloseNode(t)&&e.closest(".redactor-modal").length!==0)},_handleCommand:function(t){var e=r.dom(t.target).closest("button").attr("data-command");e!=="cancel"&&t.preventDefault(),this._broadcast(e)},_handleEnter:function(t){t.which===13&&this.p.handle&&(t.preventDefault(),this._broadcast(this.p.handle))},_handleEscape:function(t){t.which===27&&this._close()}}),r.add("class","modal.element",{mixins:["dom"],init:function(t,e){this.app=t,this.opts=t.opts,this.$win=t.$win,this._init(e)},getForm:function(){return this.find("form")},getHeader:function(){return this.$modalHeader},getBody:function(){return this.$modalBody},getFooter:function(){return this.$modalFooter},setTitle:function(t){t&&this.$modalHeader.html(t)},setWidth:function(t){t=parseInt(t)>=this.$win.width()?"96%":t,this.css("max-width",t)},setHeight:function(t){t!==!1&&this.$modalBody.css("height",t)},updatePosition:function(){var t=this.width();this.css({left:"50%","margin-left":"-"+t/2+"px"});var e=this.$win.height(),i=this.height(),s=e/2-i/2;i<e&&s!=0&&this.css("margin-top",s+"px")},isCloseNode:function(t){return t===this.$modalClose.get()},_init:function(t){this._build(),this._buildClose(),this._buildHeader(),this._buildBody(),this._buildFooter(),this._buildTemplate(t)},_build:function(){this.parse("<div>"),this.addClass("redactor-modal"),this.attr("dir",this.opts.direction)},_buildClose:function(){this.$modalClose=r.dom("<span>"),this.$modalClose.addClass("redactor-close"),this.append(this.$modalClose)},_buildHeader:function(){this.$modalHeader=r.dom("<div>"),this.$modalHeader.addClass("redactor-modal-header"),this.append(this.$modalHeader)},_buildBody:function(){this.$modalBody=r.dom("<div>"),this.$modalBody.addClass("redactor-modal-body"),this.append(this.$modalBody)},_buildFooter:function(){this.$modalFooter=r.dom("<div>"),this.$modalFooter.addClass("redactor-modal-footer"),this.append(this.$modalFooter)},_buildTemplate:function(t){this.$modalBody.html(t)}}),r.add("class","modal.form",{mixins:["dom"],init:function(t,e){this.app=t,this.build(e)},build:function(t){this.parse(t)},getData:function(){var t={};return this.find("[name]").each(function(e){var i=r.dom(e);t[i.attr("name")]=i.val()}),t},setData:function(t){this.find("[name]").each(function(e){var i=r.dom(e),s=i.attr("name");t.hasOwnProperty(s)&&(e.type&&e.type==="checkbox"?e.checked=t[s]:i.val(t[s]))})},getField:function(t){return this.find("[name="+t+"]")},setError:function(t){var e=this.getField(t);return e.addClass("error"),e.one(this._getFieldEventName(e.get()),this._clearError),!1},_clearError:function(){return r.dom(this).removeClass("error")},_getFieldEventName:function(t){return t.tagName==="SELECT"||t.type==="checkbox"||t.type==="radio"?"change":"keyup"}}),r.add("module","block",{init:function(t){this.app=t,this.block=t.block},format:function(t){var e=this.block.format(t);this.app.broadcast("format","block",e)},clearformat:function(){this.block.clearFormat()},clearstyle:function(){this.block.clearStyle()},clearclass:function(){this.block.clearClass()},clearattr:function(){this.block.clearAttr()},add:function(t,e){this.block.add(t,e)},toggle:function(t,e){this.block.toggle(t,e)},set:function(t,e){this.block.set(t,e)},remove:function(t,e){this.block.remove(t,e)}}),r.add("module","inline",{init:function(t){this.app=t,this.inline=t.inline},format:function(t){var e=this.inline.format(t);this.app.broadcast("format","inline",e)},clearformat:function(){this.inline.clearFormat()},clearstyle:function(){this.inline.clearStyle()},clearclass:function(){this.inline.clearClass()},clearattr:function(){this.inline.clearAttr()},add:function(t,e){this.inline.add(t,e)},toggle:function(t,e){this.inline.toggle(t,e)},set:function(t,e){this.inline.set(t,e)},remove:function(t,e){this.inline.remove(t,e)}}),r.add("module","autosave",{init:function(t){this.app=t,this.opts=t.opts,this.utils=t.utils,this.source=t.source},onsynced:function(){this.opts.autosave&&this._send()},_send:function(){var t=this.opts.autosaveName?this.opts.autosaveName:this.source.getName(),e={};e[t]=this.source.getCode(),e=this.utils.extendData(e,this.opts.autosaveData),r.ajax.request(this.opts.autosaveMethod,{url:this.opts.autosave,data:e,success:(function(i){this._complete(i,t,e)}).bind(this)})},_complete:function(t,e,i){var s=t&&t.error?"autosaveError":"autosave";this.app.broadcast(s,e,i,t)}}),r.add("module","input",{init:function(t){this.app=t,this.opts=t.opts,this.utils=t.utils,this.editor=t.editor,this.keycodes=t.keycodes,this.element=t.element,this.selection=t.selection,this.insertion=t.insertion,this.inspector=t.inspector,this.autoparser=t.autoparser,this.lastShiftKey=!1},onpaste:function(t,e){if(this.opts.input)return r.create("input.paste",this.app,t,e)},onkeydown:function(t){if(this.opts.input){var e=t.which;if(!r.create("input.shortcut",this.app,t).is()){if((t.ctrlKey||t.metaKey)&&!t.altKey&&e===65)return t.preventDefault(),this._selectAll();var i=[this.keycodes.ENTER,this.keycodes.SPACE,this.keycodes.BACKSPACE,this.keycodes.DELETE],s=[this.keycodes.UP,this.keycodes.DOWN,this.keycodes.LEFT,this.keycodes.RIGHT],n=i.indexOf(e)!==-1,o=s.indexOf(e)!==-1,a=(t.ctrlKey||t.metaKey)&&e===88,l=!t.ctrlKey&&!t.metaKey&&(48<=e&&e<=57||65<=e&&e<=90);if(this.selection.isAll()&&o&&(a||!t.ctrlKey&&!t.metaKey&&!t.altKey&&!t.shiftKey)){if(a)return this.editor.disableNonEditables(),void this.app.broadcast("empty");if(this._isArrowKey(e))return!0;if(n&&t.preventDefault(),this.element.isType("inline")?(this.editor.getElement().html(""),this.editor.startFocus()):this.insertion.set(this.opts.emptyHtml),n)return;this.app.broadcast("empty")}if(this.opts.autoparse&&this.autoparser.format(t,e),!l||!this.selection.hasNonEditable())return e===this.keycodes.ENTER?r.create("input.enter",this.app,t,e):t.metaKey&&e===219?(t.preventDefault(),void this.app.api("module.list.outdent")):e===this.keycodes.TAB||t.metaKey&&e===221?r.create("input.tab",this.app,t,e):e===this.keycodes.SPACE?r.create("input.space",this.app,t,e,this.lastShiftKey):this._isDeleteKey(e)?r.create("input.delete",this.app,t,e):this._isArrowKey(e)?r.create("input.arrow",this.app,t,e):void 0;t.preventDefault()}}},onkeyup:function(t){if(this.opts.input){var e=t.which;if(this.lastShiftKey=t.shiftKey,this.app.broadcast("contextbar.close"),!r.create("input.shortcode",this.app,t,e).is()){if(e===this.keycodes.BACKSPACE){var i=this.editor.getElement(),s=this.utils.trimSpaces(i.html());if((s=(s=s.replace(/<br\s?\/?>/g,"")).replace(/<div><\/div>/,""))==="")return t.preventDefault(),this.editor.setEmpty(),void this.editor.startFocus()}this.editor.isEmpty()&&this.app.broadcast("empty")}}},start:function(){this.opts.shortcutsAdd&&(this.opts.shortcuts=r.extend({},!0,this.opts.shortcuts,this.opts.shortcutsAdd))},_selectAll:function(){var t,e=this.selection.getCurrent(),i=this.inspector.parse(e);return i.isComponentType("table")?(t=i.getTable(),void this.selection.setAll(t)):i.isComponentType("code")?(t=i.getComponentCodeElement(),void this.selection.setAll(t)):void this.selection.setAll()},_isArrowKey:function(t){return[this.keycodes.UP,this.keycodes.DOWN,this.keycodes.RIGHT,this.keycodes.LEFT].indexOf(t)!==-1},_isDeleteKey:function(t){return t===this.keycodes.BACKSPACE||t===this.keycodes.DELETE}}),r.add("class","input.arrow",{init:function(t,e,i){this.app=t,this.opts=t.opts,this.utils=t.utils,this.caret=t.caret,this.offset=t.offset,this.marker=t.marker,this.editor=t.editor,this.keycodes=t.keycodes,this.component=t.component,this.inspector=t.inspector,this.selection=t.selection,this.key=i,this._init(e)},_init:function(t){if(!this._isRightLeftKey()||!this._isExitVariable(t)){if(this._isRightDownKey()&&(this._isExitOnDownRight(t)||this._selectComponent(t,"End","next"))||this._isLeftUpKey()&&(this._isExitOnUpLeft(t)||this._selectComponent(t,"Start","prev")))return;this.key===this.keycodes.LEFT?this.utils.trimInvisibleChars("left"):this.key===this.keycodes.RIGHT&&this.utils.trimInvisibleChars("right")}},_isRightDownKey:function(){return[this.keycodes.DOWN,this.keycodes.RIGHT].indexOf(this.key)!==-1},_isLeftUpKey:function(){return[this.keycodes.UP,this.keycodes.LEFT].indexOf(this.key)!==-1},_isRightLeftKey:function(){return[this.keycodes.RIGHT,this.keycodes.LEFT].indexOf(this.key)!==-1},_isExitVariable:function(t){var e=this.selection.getCurrent(),i=this.inspector.parse(e),s=i.getComponent();if(i.isComponentType("variable")&&i.isComponentActive()){t.preventDefault();var n=this.key===this.keycodes.LEFT?"setBefore":"setAfter";this.caret[n](s)}},_isExitOnUpLeft:function(t){var e=this.selection.getCurrent(),i=this.selection.getBlock(e),s=this.inspector.parse(e),n=i.previousElementSibling,o=this.caret.isStart(i);if(o&&n&&n.tagName==="TABLE")return t.preventDefault(),this.caret.setEnd(n),!0;if(s.isFigcaption()){i=s.getFigcaption(),o=this.caret.isStart(i);var a=r.dom(i).closest(".redactor-component");if(o&&a.length!==0)return t.preventDefault(),this.caret.setEnd(a),!0}else{if(s.isTable()&&o)return t.preventDefault(),this.caret.setEnd(i.previousElementSibling),!0;if(!s.isComponentEditable()&&s.isComponent()&&!s.isComponentType("variable")){var l=s.getComponent();if(!l.previousElementSibling)return t.preventDefault(),this.component.clearActive(),this._exitPrevElement(t,s.getComponent());if(l.previousElementSibling)return t.preventDefault(),this.component.clearActive(),this.caret.setEnd(l.previousElementSibling),!0}}},_isExitOnDownRight:function(t){var e,i,s=this.editor.getElement(),n=this.selection.getCurrent(),o=this.inspector.parse(n),a=this.caret.isEnd();if(o.isTable()){if(e=o.getTable(),(i=this.caret.isEnd(e))||a)return this._exitNextElement(t,o.getComponent())}else if(o.isFigcaption()){if(e=o.getFigcaption(),(i=this.caret.isEnd(e))||a)return this._exitNextElement(t,o.getComponent())}else if(o.isComponentType("code")){var l=o.getComponent(),h=r.dom(o.getComponentCodeElement()).closest("pre");i=this.caret.isEnd(e);var c=h&&h.get().nextElementSibling;if(i&&!c)return this._exitNextElement(t,l)}else if(o.isPre()||o.isBlockquote()||o.isDl()){if(a){if(o.isPre())return this._exitNextElement(t,o.getPre());if(o.isBlockquote())return this._exitNextElement(t,o.getBlockquote());if(o.isDl())return this._exitNextElement(t,o.getDl())}}else if(o.isList()){var d=r.dom(n).parents("ul, ol",s).last();if((i=this.caret.isEnd(d))||a)return this._exitNextElement(t,d.get())}else if(o.isComponent()&&!o.isComponentType("variable")&&o.getTag()!=="span")return this.component.clearActive(),this._exitNextElement(t,o.getComponent())},_exitPrevElement:function(t,e){return t.preventDefault(),e.previousElementSibling?this.caret.setEnd(e.previousElementSibling):this.utils.createMarkupBefore(e),!0},_exitNextElement:function(t,e){return t.preventDefault(),e.nextElementSibling?this.caret.setStart(e.nextElementSibling):this.utils.createMarkup(e),!0},_selectComponent:function(t,e,i){var s=this.selection.getCurrent(),n=this.selection.getBlock(s),o=this.utils.findSiblings(s,i),a=this.utils.findSiblings(n,i);o&&this.caret["is"+e](s)?this._selectComponentItem(t,o,e):a&&this.caret["is"+e](n)&&this._selectComponentItem(t,a,e)},_selectComponentItem:function(t,e,i){if(this.component.isNonEditable(e))return t.preventDefault(),this.caret["set"+i](e),!0}}),r.add("class","input.delete",{init:function(t,e,i){this.app=t,this.opts=t.opts,this.caret=t.caret,this.utils=t.utils,this.editor=t.editor,this.marker=t.marker,this.keycodes=t.keycodes,this.component=t.component,this.inspector=t.inspector,this.selection=t.selection,this.insertion=t.insertion,this.key=i,this._init(e)},_init:function(t){if(!this._removeActiveComponent(t)&&!this._removeAllSelectedTable(t)){if(this.key===this.keycodes.BACKSPACE){var e=this.editor.getElement();if(this.utils.trimSpaces(e.html())===this.opts.emptyHtml)return void t.preventDefault()}if(this._detectVariableOrNonEditable()||this.selection.hasNonEditable())t.preventDefault();else{if(this.selection.isAll())return t.preventDefault(),void this.insertion.set(this.opts.emptyHtml);this.selection.isCollapsed()&&(this.key===this.keycodes.BACKSPACE?this._traverseBackspace(t):this.key===this.keycodes.DELETE&&this._traverseDelete(t)),this.key===this.keycodes.BACKSPACE&&this.utils.trimInvisibleChars("left"),this._removeUnwantedStyles(),this._removeEmptySpans(),this._removeSpanTagsInHeadings(),this._removeInlineTagsInPre()}}},_detectVariableOrNonEditable:function(){var t,e=this.selection.getBlock(),i=this.caret.isStart(e),s=this.caret.isEnd(e);if(this.key===this.keycodes.BACKSPACE&&i){if(t=e.previousSibling,this._isNonEditable(t))return!0}else if(this.key===this.keycodes.DELETE&&s&&(t=e.nextSibling,this._isNonEditable(t)))return!0;var n=this.selection.getCurrent(),o=this.caret.isStart(n),a=this.caret.isEnd(n),l=this.selection.getTextBeforeCaret().trim()==="",h=this.selection.getTextAfterCaret().trim()==="";if(this.key===this.keycodes.BACKSPACE&&o&&!l){if(t=n.previousSibling,this._isVariable(t))return this.caret.setEnd(t),!0;if(this._isNonEditable(t))return!0}else if(this.key===this.keycodes.DELETE&&a&&!h){if(t=n.nextSibling,this._isVariable(t))return this.caret.setStart(t),!0;if(this._isNonEditable(t))return!0}},_isVariable:function(t){return r.dom(t).closest('[data-redactor-type="variable"]').length!==0},_isNonEditable:function(t){return r.dom(t).closest(".non-editable").length!==0},_getBlock:function(){var t=this.editor.getElement(),e=this.selection.getBlock(),i=this.inspector.parse(e);return e=i.isList()?r.dom(e).parents("ul, ol",t).last().get():e,e=i.isDl()?i.getDl():e,e=i.isTable()?i.getTable():e},_traverseDelete:function(t){var e,i,s,n=this.selection.getCurrent(),o=this.inspector.parse(n);if(o.isFigcaption()){if(e=o.getFigcaption(),i=this.caret.isEnd(e))return void t.preventDefault()}else if(o.isComponentType("code")&&(e=o.getComponent(),i=this.caret.isEnd(e)))return void t.preventDefault();e=this._getBlock();var a=this.utils.findSiblings(e,"next");if(a){i=this.caret.isEnd(e);var l=this.inspector.parse(a),h=a.tagName==="P"||a.tagName==="DIV";if(i&&l.isComponentType("table"))return t.preventDefault(),void this.caret.setStart(a);if(i&&l.isComponentEditable())return t.preventDefault(),void this.component.remove(a,!1);if(i&&l.isComponent())return t.preventDefault(),this.caret.setStart(a),void(this.utils.isEmptyHtml(e.innerHTML)&&r.dom(e).remove());if(i&&l.isList()){var c=r.dom(e);if(s=r.dom(a),o.isList())return t.preventDefault(),c.append(s),void s.unwrap();var d=s.children("li").first(),u=d.find("ul, ol");if(u.length!==0)return t.preventDefault(),s.prepend(u),u.unwrap(),c.append(d),void d.unwrap()}else if(i&&!o.isList()&&!o.isTable()&&h&&!this.utils.isEmptyHtml(e.innerHTML)){t.preventDefault();var p=r.dom(e);return s=r.dom(a),p.append(s),void s.unwrap()}}},_traverseBackspace:function(t){var e,i,s,n,o=this.selection.getCurrent(),a=this.inspector.parse(o);if(a.isFigcaption()){if(e=a.getFigcaption(),i=this.caret.isStart(e))return void t.preventDefault()}else if(a.isComponentType("code")&&(e=a.getComponent(),(i=this.caret.isStart(e))&&e.previousElementSibling))return t.preventDefault(),this.caret.setEnd(e.previousElementSibling),!0;e=this._getBlock();var l=this.utils.findSiblings(e,"prev");if(l){i=this.caret.isStart(e);var h=this.inspector.parse(l),c=l.tagName==="P"||l.tagName==="DIV";if(i&&h.isComponentType("code"))return t.preventDefault(),void this.component.remove(l,!1);if(i&&h.isComponentType("table"))return t.preventDefault(),void this.caret.setEnd(l);if(i&&h.isComponent())return t.preventDefault(),this.caret.setStart(l),void(this.utils.isEmptyHtml(e.innerHTML)&&r.dom(e).remove());if(i&&a.isList())if(t.preventDefault(),n=r.dom(e),s=r.dom(l),h.isList())n.children("li").first().prepend(this.marker.build("start")),s.append(n),n.unwrap(),this.selection.restoreMarkers();else{var d=n.children("li").first(),u=d.get(),p=d.find("ul, ol"),f=this.utils.replaceToTag(u,this.opts.markup);this.opts.breakline&&f.attr("data-redactor-tag","br"),n.before(f),this.caret.setStart(f),p.length!==0&&(n.prepend(p),p.unwrap())}else if(i&&c){if(t.preventDefault(),this.utils.isEmpty(l))return void(s=r.dom(l)).remove();var v=this.utils.createInvisibleChar(),g=r.dom(e);return s=r.dom(l),this.caret.setEnd(s),g.prepend(v),s.append(g.contents()),void g.remove()}}else setTimeout(this._replaceBlock.bind(this),1)},_replaceBlock:function(){var t=this.selection.getBlock(),e=r.dom(t);if(this.opts.markup==="p"&&t&&this._isNeedToReplaceBlock(t)){var i=document.createElement(this.opts.markup);e.replaceWith(i),this.caret.setStart(i)}this.opts.breakline&&t&&t.tagName==="DIV"&&e.attr("data-redactor-tag","br")},_isNeedToReplaceBlock:function(t){return t.tagName==="DIV"&&this.utils.isEmptyHtml(t.innerHTML)},_removeActiveComponent:function(t){var e=this.selection.getCurrent(),i=this.inspector.parse(e),s=i.getComponent();if(i.isComponent()&&this.component.isActive(s))return t.preventDefault(),this.component.remove(s),!0},_removeAllSelectedTable:function(t){var e=this.selection.getCurrent(),i=this.inspector.parse(e).getTable();if(i&&this.selection.isAll(i))return t.preventDefault(),this.component.remove(i),!0},_removeUnwantedStyles:function(){var t=this.editor.getElement();setTimeout(function(){t.find("*[style]").not("img, figure, figcaption, iframe, [data-redactor-style-cache], [data-redactor-span]").removeAttr("style")},0)},_removeEmptySpans:function(){var t=this.editor.getElement();setTimeout(function(){t.find("span").each(function(e){e.attributes.length===0&&r.dom(e).replaceWith(e.childNodes)})},0)},_removeSpanTagsInHeadings:function(){var t=this.editor.getElement();setTimeout(function(){t.find("h1, h2, h3, h4, h5, h6").each(function(e){var i=r.dom(e);i.closest("figure").length===0&&i.find("span").not(".redactor-component, .non-editable, .redactor-selection-marker, [data-redactor-style-cache], [data-redactor-span]").unwrap()})},1)},_removeInlineTagsInPre:function(){var t=this.editor.getElement(),e=this.opts.inlineTags;setTimeout(function(){t.find("pre").each(function(i){var s=r.dom(i);s.closest("figure").length===0&&s.find(e.join(",")).not("code, .redactor-selection-marker").unwrap()})},1)}}),r.add("class","input.enter",{init:function(t,e){this.app=t,this.opts=t.opts,this.utils=t.utils,this.caret=t.caret,this.editor=t.editor,this.keycodes=t.keycodes,this.detector=t.detector,this.insertion=t.insertion,this.selection=t.selection,this.inspector=t.inspector,this._init(e)},_init:function(t){return this.opts.enterKey?this.app.broadcast("enter",t)===!1?t.preventDefault():this.selection.hasNonEditable()?void t.preventDefault():t.ctrlKey||t.shiftKey?this._insertBreak(t):void(this._isExit(t)||this._traverse(t)):this._disable(t)},_disable:function(t){t.preventDefault();var e=this.selection.getRange();e&&!e.collapsed&&e.deleteContents()},_insertBreak:function(t){t.preventDefault();var e=this.selection.getCurrent(),i=this.selection.getBlock(),s=this.inspector.parse(e);if(s.isHeading()&&this.caret.isStart(i)){var n=r.dom(i),o=n.clone().html("");n.before(o),this.caret.setStart(n)}else{if(s.isComponent()&&!s.isComponentEditable()||s.isCode())return;s.isPre()?this.insertion.insertNewline():this.insertion.insertBreakLine()}},_isExit:function(t){var e=this.editor.getElement(),i=this.selection.getBlock(),s=this.inspector.parse(i),n=this.caret.isEnd(i),o=this.selection.getCurrent(),a=o.previousSibling;if(s.isBlockquote()){var l=n&&this._isExitableBlock(i,"P"),h=n&&this._isExitableDblBreak(a);if(l||h)return this._exitFromElement(t,h?a:i,s.getBlockquote())}else if(!s.isComponentType("code")&&s.isPre()){if(n){var c=i.innerHTML;if((c=this.utils.removeInvisibleChars(c)).match(/(\n\n\n)$/)!==null)return r.dom(a.previousSibling.previousSibling).remove(),this._exitFromElement(t,a,i)}}else if(s.isDl()){if(n&&this._isExitableBlock(i,"DT"))return this._exitFromElement(t,i,s.getDl())}else if(s.isList()){var d=r.dom(o).parents("ul, ol",e).last();if((n=this.caret.isEnd(d))&&this._isExitableBlock(i,"LI"))return this._exitFromElement(t,i,d)}else if(s.isComponent()&&s.isComponentActive()&&!s.isFigcaption()&&!s.isComponentEditable())return this._exitFromElement(t,!1,s.getComponent())},_isExitableDblBreak:function(t){var e=!!t&&t.nextSibling;if(e){var i=this.utils.removeInvisibleChars(e.textContent);return e.nodeType===3&&i.trim()===""}},_isExitableBlock:function(t,e){return t&&t.tagName===e&&this.utils.isEmptyHtml(t.innerHTML)},_exitFromElement:function(t,e,i){return t.preventDefault(),e&&r.dom(e).remove(),this.utils.createMarkup(i),!0},_exitNextElement:function(t,e){return t.preventDefault(),e.nextSibling?this.caret.setStart(e.nextSibling):this.utils.createMarkup(e),!0},_traverse:function(t){var e=this.selection.getCurrent(),i=this.selection.isText(),s=this.selection.getBlock(),n=this.inspector.parse(e),o=!!s&&s.tagName.toLowerCase(),a=r.dom(e).closest("[data-redactor-type=variable]");if(a.length!==0&&this.caret.setAfter(a),n.isPre())return t.preventDefault(),this.insertion.insertNewline();if(n.isBlockquote())return(s=this.selection.getBlock(e))&&s.tagName==="BLOCKQUOTE"?(t.preventDefault(),this.insertion.insertBreakLine()):void 0;if(n.isFigcaption()){s=n.getFigcaption();var l=this.caret.isEnd(s),h=this.caret.isEnd();return l||h?this._exitNextElement(t,n.getComponent()):void t.preventDefault()}if(n.isDl())return t.preventDefault(),this._traverseDl(e);if(this.opts.breakline&&o==="div")setTimeout(this._replaceBlock.bind(this),1);else{if(i)return t.preventDefault(),this.insertion.insertBreakLine();if(!n.isList()){var c=this.detector.isDesktop()?50:1;setTimeout(this._replaceBlock.bind(this),c)}}},_traverseDl:function(t){var e=this.selection.getBlock(t),i=this.inspector.parse(e).getTag(),s=r.dom(e),n=s.get().nextSibling||!1,o=r.dom(n),a=n&&o.is("dd"),l=n&&o.is("dt"),h=this.caret.isEnd(e);if(i==="dt"&&!a&&h){var c=document.createElement("dd");return s.after(c),void this.caret.setStart(c)}if(i!=="dd"||l||!h)return this.insertion.insertBreakLine();var d=document.createElement("dt");return s.after(d),void this.caret.setStart(d)},_replaceBlock:function(){var t=this.selection.getBlock(),e=r.dom(t);if(this.opts.markup==="p"&&t&&this._isNeedToReplaceBlock(t)){var i=document.createElement(this.opts.markup);e.replaceWith(i),this.caret.setStart(i)}else if(t)if(this.utils.isEmptyHtml(t.innerHTML))this._clearBlock(e,t);else{var s=this.utils.getFirstNode(t);s&&s.tagName==="BR"&&(r.dom(s).remove(),this.caret.setStart(t))}e.removeAttr("id"),t&&this._isNeedToCleanBlockStyle(t)&&this.opts.cleanOnEnter&&e.removeAttr("class style"),this.opts.breakline&&t&&t.tagName},_clearBlock:function(t,e){e.tagName==="DIV"&&t.find("br").remove(),!this.opts.cleanInlineOnEnter&&e.innerHTML!=="<br>"||t.html(""),this.caret.setStart(e)},_isNeedToReplaceBlock:function(t){return t.tagName==="DIV"&&this.utils.isEmptyHtml(t.innerHTML)},_isNeedToCleanBlockStyle:function(t){return t.tagName==="P"&&this.utils.isEmptyHtml(t.innerHTML)}}),r.add("class","input.paste",{init:function(t,e,i,s,n){this.app=t,this.opts=t.opts,this.editor=t.editor,this.cleaner=t.cleaner,this.container=t.container,this.inspector=t.inspector,this.insertion=t.insertion,this.selection=t.selection,this.autoparser=t.autoparser,this.pasteHtml=s,this.pointInserted=n,this.dataTransfer=i,this._init(e)},_init:function(t){var e,i=this.dataTransfer||t.clipboardData,s=this.selection.getCurrent(),n=this.inspector.parse(s);if(this.dropPasted=this.dataTransfer,this.isRawCode=n.isPre()||n.isCode(),this.editor.enablePasting(),this.editor.saveScroll(),this.dropPasted||this.selection.saveMarkers(),this.isRawCode||!i)return e=this.isRawCode||i||!window.clipboardData?i.getData("text/plain"):window.clipboardData.getData("text"),t.preventDefault(),void this._insert(t,e);if(this.pasteHtml)t.preventDefault(),this._insert(t,this.pasteHtml);else{var o=i.getData("URL"),a=this._isPlainText(i)?this.cleaner.encodeEntities(i.getData("text/plain")):i.getData("text/html");if(a=o&&o!==""?o:a,i.files!==null&&0<i.files.length&&a===""){for(var l=[],h=0;h<i.files.length;h++){var c=i.files[h]||i.items[h].getAsFile();c&&l.push(c)}if(0<l.length)return t.preventDefault(),void this._insertFiles(t,l)}t.preventDefault(),this._insert(t,a)}},_isPlainText:function(t){var e=t.getData("text/plain"),i=t.getData("text/html");if(!e||!i)return e!==null;var s=document.createElement("div");return s.innerHTML=i,s.textContent===e?!s.querySelector(":not(meta)"):void 0},_restoreSelection:function(){this.editor.restoreScroll(),this.editor.disablePasting(),this.dropPasted||this.selection.restoreMarkers()},_insert:function(t,e){var i=this.app.broadcast("pasteBefore",e);if(e=(e=i===void 0?e:i).trim(),e=(e=this.isRawCode?e:this.cleaner.paste(e)).trim(),e=this.isRawCode?this.cleaner.encodePhpCode(e):e,e=(i=this.app.broadcast("pasting",e))===void 0?e:i,this._restoreSelection(),this.opts.input){this.app.broadcast("state",!1);var s=[];if(this.isRawCode){e=e.replace("&lt;?php","<?php");var n=document.createTextNode(e);s=this.insertion.insertNode(n,"after"),this.app.broadcast("pasted",s)}else this.opts.autoparse&&this.opts.autoparsePaste&&(e=this.autoparser.parse(e)),s=this.dropPasted?this.insertion.insertToPoint(t,e,this.pointInserted):this.insertion.insertHtml(e),this.app.broadcast("pasted",s),this.app.broadcast("autoparseobserve")}},_insertFiles:function(t,e){this._restoreSelection();var i=this.opts.imageTypes.indexOf(e[0].type)!==-1,s=this.dropPasted===void 0;i?this.app.broadcast("dropimage",t,e,s):this.app.broadcast("dropfile",t,e,s)}}),r.add("class","input.shortcode",{init:function(t,e,i){this.app=t,this.opts=t.opts,this.utils=t.utils,this.marker=t.marker,this.keycodes=t.keycodes,this.selection=t.selection,this.worked=!1,i===this.keycodes.SPACE&&this._init()},is:function(){return this.worked},_init:function(){var t=this.selection.getCurrent();if(t&&t.nodeType===3){var e=this.utils.removeInvisibleChars(t.textContent),i=this.opts.shortcodes;for(var s in i){var n=new RegExp("^"+this.utils.escapeRegExp(s));if(e.match(n)!==null&&i[s].format!==void 0)return this._format(i[s].format,t,n)}}},_format:function(t,e,i){var s=(e=this.marker.insert("start").previousSibling).textContent;s=(s=this.utils.trimSpaces(s)).replace(i,""),e.textContent=s;var n=t==="ul"||t==="ol"?"module.list.toggle":"module.block.format";this.app.api(n,t),this.selection.restoreMarkers(),this.worked=!0}}),r.add("class","input.shortcut",{init:function(t,e){this.app=t,this.opts=t.opts,this.worked=!1,this.hotkeys={8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},this.hotkeysShiftNums={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"},this._init(e)},is:function(){return this.worked},_init:function(t){if(this.opts.shortcuts!==!1)for(var e in this.opts.shortcuts)this._build(t,e,this.opts.shortcuts[e]);else!t.ctrlKey&&!t.metaKey||t.which!==66&&t.which!==73||t.preventDefault()},_build:function(t,e,i){for(var s=e.split(","),n=s.length,o=0;o<n;o++)typeof s[o]=="string"&&this._handler(t,s[o].trim(),i)},_handler:function(t,e,i){e=e.toLowerCase().split(" ");for(var s=this.hotkeys[t.keyCode],n=String.fromCharCode(t.which).toLowerCase(),o="",a={},l=["meta","ctrl","alt","shift"],h=0;h<l.length;h++){var c=l[h];t[c+"Key"]&&s!==c&&(o+=c+"+")}s&&(a[o+s]=!0),n&&(a[o+n]=!0,a[o+this.hotkeysShiftNums[n]]=!0,o==="shift+"&&(a[this.hotkeysShiftNums[n]]=!0));var d=e.length;for(h=0;h<d;h++)if(a[e[h]])return t.preventDefault(),this.worked=!0,void(i.message?(this.app.broadcast(i.message,i.args),this.app.broadcast("buffer.trigger")):i.api&&(this.app.api(i.api,i.args),this.app.broadcast("buffer.trigger")))}}),r.add("class","input.space",{init:function(t,e,i,s){this.app=t,this.keycodes=t.keycodes,this.insertion=t.insertion,this.selection=t.selection,this.key=i,this.lastShiftKey=s,this._init(e)},_init:function(t){if(!this.selection.hasNonEditable())return this.lastShiftKey||this.key!==this.keycodes.SPACE||!t.ctrlKey&&!t.shiftKey||t.metaKey?void 0:(t.preventDefault(),void this.insertion.insertChar("&nbsp;"));t.preventDefault()}}),r.add("class","input.tab",{init:function(t,e){this.app=t,this.opts=t.opts,this.inspector=t.inspector,this.insertion=t.insertion,this.selection=t.selection,this._init(e)},_init:function(t){if(this.opts.tabKey){if(this.app.broadcast("tab",t)===!1)return t.preventDefault();this._traverse(t)}},_traverse:function(t){var e=this.selection.getCurrent(),i=this.inspector.parse(e);return!i.isComponent()&&t.shiftKey?this._insertHardTab(t,4):i.isList()?(t.preventDefault(),this.app.api("module.list.indent")):i.isPre()||i.isComponentType("code")&&!i.isFigcaption()?this._tabCode(t):this.opts.tabAsSpaces!==!1?this._insertHardTab(t,this.opts.tabAsSpaces):void 0},_insertHardTab:function(t,e){t.preventDefault();var i=document.createTextNode(Array(e+1).join(" "));return this.insertion.insertNode(i,"end")},_tabCode:function(t){t.preventDefault();var e=this.opts.preSpaces?document.createTextNode(Array(this.opts.preSpaces+1).join(" ")):document.createTextNode("	");return this.insertion.insertNode(e,"end")}}),r.add("module","upload",{init:function(t){this.app=t,this.opts=t.opts,this.lang=t.lang,this.utils=t.utils,this.editor=t.editor,this.progress=t.progress,this.defaults={event:!1,element:!1,name:!1,files:!1,url:!1,data:!1,paramName:!1}},build:function(t){this.p=r.extend(this.defaults,t),this.$el=r.dom(this.p.element),this.$el.get().tagName==="INPUT"?this._buildInput():this._buildBox()},send:function(t){this.p=r.extend(this.defaults,t),this.$uploadbox=this.editor.getElement(),this._send(this.p.event,this.p.files)},complete:function(t,e){this._complete(t,e)},_buildInput:function(){this.box=!1,this.prefix="",this.$uploadbox=r.dom('<div class="upload-redactor-box" />'),this.$el.hide(),this.$el.after(this.$uploadbox),this.opts.multipleUpload?this.$el.attr("multiple","multiple"):this.$el.removeAttr("multiple"),this.p.name!=="file"&&this.$el.attr("accept","image/*"),this._buildPlaceholder(),this._buildEvents()},_buildBox:function(){this.box=!0,this.prefix="box-",this.$uploadbox=this.$el,this.$uploadbox.attr("ondragstart","return false;"),this.$uploadbox.on("drop.redactor.upload",this._onDropBox.bind(this)),this.$uploadbox.on("dragover.redactor.upload",this._onDragOver.bind(this)),this.$uploadbox.on("dragleave.redactor.upload",this._onDragLeave.bind(this))},_buildPlaceholder:function(){this.$placeholder=r.dom('<div class="upload-redactor-placeholder" />'),this.$placeholder.html(this.lang.get("upload-label")),this.$uploadbox.append(this.$placeholder)},_buildEvents:function(){this.$el.on("change.redactor.upload",this._onChange.bind(this)),this.$uploadbox.on("click.redactor.upload",this._onClick.bind(this)),this.$uploadbox.on("drop.redactor.upload",this._onDrop.bind(this)),this.$uploadbox.on("dragover.redactor.upload",this._onDragOver.bind(this)),this.$uploadbox.on("dragleave.redactor.upload",this._onDragLeave.bind(this))},_onClick:function(t){t.preventDefault(),this.$el.click()},_onChange:function(t){this._send(t,this.$el.get().files)},_onDrop:function(t){t.preventDefault(),this._clear(),this._setStatusDrop(),this._send(t)},_onDragOver:function(t){return t.preventDefault(),this._setStatusHover(),!1},_onDragLeave:function(t){return t.preventDefault(),this._removeStatusHover(),!1},_onDropBox:function(t){t.preventDefault(),this._clear(),this._setStatusDrop(),this._send(t)},_removeStatusHover:function(){this.$uploadbox.removeClass("upload-redactor-"+this.prefix+"hover")},_setStatusDrop:function(){this.$uploadbox.addClass("upload-redactor-"+this.prefix+"drop")},_setStatusHover:function(){this.$uploadbox.addClass("upload-redactor-"+this.prefix+"hover")},_setStatusError:function(){this.$uploadbox.addClass("upload-redactor-"+this.prefix+"error")},_setStatusSuccess:function(){this.$uploadbox.addClass("upload-redactor-"+this.prefix+"success")},_clear:function(){for(var t=["drop","hover","error","success"],e=0;e<t.length;e++)this.$uploadbox.removeClass("upload-redactor-"+this.prefix+t[e]);this.$uploadbox.removeAttr("ondragstart")},_send:function(t,e){t=t.originalEvent||t,e=e||t.dataTransfer.files;var i=new FormData,s=this._getUploadParam();i=this._buildData(s,e,i),i=this.utils.extendData(i,this.p.data),this.app.broadcast("upload.start",t,i,e)!==!1&&this._sendData(i,e,t)},_sendData:function(t,e,i){if(this.progress.show(),typeof this.p.url=="function"){var s=this.p.url(t,e,i,this);s instanceof Promise||this._complete(s,i)}else r.ajax.post({url:this.p.url,data:t,before:(function(n){return this.app.broadcast("upload.beforeSend",n)}).bind(this),success:(function(n){this._complete(n,i)}).bind(this),error:(function(n,o,a){this._complete(n,i,a)}).bind(this)})},_getUploadParam:function(){return this.p.paramName?this.p.paramName:"file"},_buildData:function(t,e,i){if(e.length===1)i.append(t+"[]",e[0]);else if(1<e.length&&this.opts.multipleUpload!==!1)for(var s=0;s<e.length;s++)i.append(t+"[]",e[s]);return i},_complete:function(t,e,i){this._clear(),this.progress.hide(),t&&t.error?(this._setStatusError(),this.app.broadcast("upload."+this.p.name+".error",t,e,i),this.app.broadcast("upload.error",t,i)):(this._setStatusSuccess(),this.app.broadcast("upload."+this.p.name+".complete",t,e),this.app.broadcast("upload.complete",t),setTimeout(this._clear.bind(this),500))}}),r.add("class","code.component",{mixins:["dom","component"],init:function(t,e){return this.app=t,e&&e.cmnt!==void 0?e:this._init(e)},_init:function(t){var e;if(t!==void 0){var i=r.dom(t).closest("figure");i.length!==0?this.parse(i):(this.parse("<figure>"),this.append(t)),e=this.find("pre code, pre").last()}else e=r.dom("<pre>"),this.parse("<figure>"),this.append(e);this._initElement(e),this._initWrapper()},_initElement:function(t){t.attr({tabindex:"-1",contenteditable:!0})},_initWrapper:function(){this.addClass("redactor-component"),this.attr({"data-redactor-type":"code",tabindex:"-1",contenteditable:!1})}}),r.add("module","form",{init:function(t){this.app=t,this.lang=t.lang,this.component=t.component,this.inspector=t.inspector},onform:{remove:function(t){this._remove(t)}},oncontextbar:function(t,e){var i=this.inspector.parse(t.target);if(i.isComponentType("form")){var s=i.getComponent(),n={remove:{title:this.lang.get("delete"),api:"module.form.remove",args:s}};e.set(t,s,n,"top")}},_remove:function(t){this.component.remove(t)}}),r.add("class","form.component",{mixins:["dom","component"],init:function(t,e){return this.app=t,this.utils=t.utils,e&&e.cmnt!==void 0?e:this._init(e)},_init:function(t){if(t!==void 0)if(r.dom(t).closest("form").length!==0){var e=this.utils.replaceToTag(t,"figure");this.parse(e)}else this.parse("<figure>"),this.append(t);else this.parse("<figure>");this._initWrapper()},_initWrapper:function(){this.addClass("redactor-component"),this.attr({"data-redactor-type":"form",tabindex:"-1",contenteditable:!1})}}),r.add("module","image",{modals:{image:'<div class="redactor-modal-tab redactor-modal-tab-upload" data-title="## upload ##"><form action="">                 <input type="file" name="file">             </form></div>',imageedit:'<div class="redactor-modal-group">                 <div id="redactor-modal-image-preview" class="redactor-modal-side"></div>                 <form action="" class="redactor-modal-area">                     <div class="form-item">                         <label for="modal-image-title"> ## title ##</label>                         <input type="text" id="modal-image-title" name="title" />                     </div>                     <div class="form-item form-item-caption">                         <label for="modal-image-caption">## caption ##</label>                         <input type="text" id="modal-image-caption" name="caption" aria-label="## caption ##" />                     </div>                     <div class="form-item form-item-align">                         <label>## image-position ##</label>                         <select name="align" aria-label="## image-position ##">                             <option value="none">## none ##</option>                             <option value="left">## left ##</option>                             <option value="center">## center ##</option>                             <option value="right">## right ##</option>                         </select>                     </div>                     <div class="form-item form-item-link">                         <label for="modal-image-url">## link ##</label>                         <input type="text" id="modal-image-url" name="url" aria-label="## link ##" />                     </div>                     <div class="form-item form-item-link">                         <label class="checkbox"><input type="checkbox" name="target" aria-label="## link-in-new-tab ##"> ## link-in-new-tab ##</label>                     </div>                 </form>             </div>'},init:function(t){this.app=t,this.opts=t.opts,this.lang=t.lang,this.caret=t.caret,this.utils=t.utils,this.editor=t.editor,this.storage=t.storage,this.component=t.component,this.inspector=t.inspector,this.insertion=t.insertion,this.selection=t.selection,this.justResized=!1},oninsert:function(){this._observeImages()},onstarted:function(){this.storage.observeImages(),this.opts.imageResizable&&(this.resizer=r.create("image.resize",this.app)),this._observeImages()},ondropimage:function(t,e,i){if(this.opts.imageUpload){var s={url:this.opts.imageUpload,event:!i&&t,files:e,name:"imagedrop",data:this.opts.imageData,paramName:this.opts.imageUploadParam};this.app.api("module.upload.send",s)}},onstop:function(){this.resizer&&this.resizer.stop()},onbottomclick:function(){this.insertion.insertToEnd(this.editor.getLastNode(),"image")},onimageresizer:{stop:function(){this.resizer&&this.resizer.hide()}},onsource:{open:function(){this.resizer&&this.resizer.hide()},closed:function(){this._observeImages(),this.resizer&&this.resizer.rebuild()}},onupload:{complete:function(){this._observeImages()},image:{complete:function(t){this._insert(t)},error:function(t){this._uploadError(t)}},imageedit:{complete:function(t){this._change(t)},error:function(t){this._uploadError(t)}},imagedrop:{complete:function(t,e){this._insert(t,e)},error:function(t){this._uploadError(t)}},imagereplace:{complete:function(t){this._change(t,!1)},error:function(t){this._uploadError(t)}}},onmodal:{image:{open:function(t,e){this._setUpload(t,e)}},imageedit:{open:function(t,e){this._setFormData(t,e)},opened:function(t,e){this._setFormFocus(e)},remove:function(){this._remove(this.$image)},save:function(t,e){this._save(t,e)}}},onimage:{observe:function(){this._observeImages()},resized:function(){this.justResized=!0}},oncontextbar:function(t,e){if(this.justResized)this.justResized=!1;else{var i=this.selection.getCurrent(),s=this.inspector.parse(i),n=r.dom(i).closest("img");if(!s.isFigcaption()&&s.isComponentType("image")||n.length!==0){var o=n.length!==0?n.get():s.getComponent(),a={edit:{title:this.lang.get("edit"),api:"module.image.open"},remove:{title:this.lang.get("delete"),api:"module.image.remove",args:o}};e.set(t,o,a)}}},open:function(){this.$image=this._getCurrent(),this.app.api("module.modal.build",this._getModalData())},insert:function(t){this._insert(t)},remove:function(t){this._remove(t)},_getModalData:function(){return this._isImage()&&this.opts.imageEditable?{name:"imageedit",width:"800px",title:this.lang.get("edit"),handle:"save",commands:{save:{title:this.lang.get("save")},remove:{title:this.lang.get("delete"),type:"danger"},cancel:{title:this.lang.get("cancel")}}}:{name:"image",title:this.lang.get("image")}},_isImage:function(){return this.$image},_getCurrent:function(){var t=this.selection.getCurrent(),e=this.inspector.parse(t),i=r.dom(t).closest("img");return i.length!==0?this.component.create("image",i):!(!e.isComponentType("image")||!e.isComponentActive())&&this.component.create("image",e.getComponent())},_insert:function(t,e){if(this.app.api("module.modal.close"),Array.isArray(t)){for(var i={},s=0;s<t.length;s++)i=r.extend(i,t[s]);t=i}else typeof t=="string"&&(t={file:{url:t}});if(typeof t=="object"){var n=0;for(var o in t)typeof t[o]=="object"&&n++;1<n?this._insertMultiple(t,e):this._insertSingle(t,e)}},_insertSingle:function(t,e){for(var i in t)if(typeof t[i]=="object"){var s=this._createImageAndStore(t[i]),n=e?this.insertion.insertToPoint(e,s,!1,!1):this.insertion.insertHtml(s,!1);this._removeSpaceBeforeFigure(n[0]),this.component.setActive(n[0]),this.app.broadcast("image.uploaded",n[0],t)}},_insertMultiple:function(t,e){var i,s=0,n=[];for(var o in t)if(typeof t[o]=="object"){s++;var a=this._createImageAndStore(t[o]);s===1?n=e?this.insertion.insertToPoint(e,a,!1,!1):this.insertion.insertHtml(a,!1):(r.dom(n[0]).after(a),n=[a.get()],this.app.broadcast("image.inserted",a)),i=n[0],this._removeSpaceBeforeFigure(n[0]),this.app.broadcast("image.uploaded",n[0],t)}this.component.setActive(i)},_createImageAndStore:function(t){var e=this.component.create("image");return e.addClass("redactor-uploaded-figure"),e.setData({src:t.url,id:t.id?t.id:this.utils.getRandomId()}),this.storage.add("image",e.getElement()),e},_removeSpaceBeforeFigure:function(t){if(t){var e=t.previousSibling,i=t.nextSibling,s=r.dom(e),n=r.dom(i);this.opts.breakline&&(i&&n.attr("data-redactor-tag")==="br"&&n.find("br").first().remove(),e&&s.attr("data-redactor-tag")==="br"&&s.find("br").last().remove()),e&&(this._removeInvisibleSpace(e),this._removeInvisibleSpace(e.previousSibling))}},_removeInvisibleSpace:function(t){t&&t.nodeType===3&&this.utils.searchInvisibleChars(t.textContent)!==-1&&t.parentNode.removeChild(t)},_save:function(t,e){var i=e.getData(),s={title:i.title};this.opts.imageLink&&(s.link={url:i.url,target:i.target}),this.opts.imageCaption&&(s.caption=i.caption),this.opts.imagePosition&&(s.align=i.align),this.$image.setData(s),this.resizer&&this.resizer.rebuild(),this.app.broadcast("image.changed",this.$image),this.app.api("module.modal.close")},_change:function(t,e){if(typeof t=="string"&&(t={file:{url:t}}),typeof t=="object"){var i;for(var s in t)if(typeof t[s]=="object"){(i=r.dom("<img>")).attr("src",t[s].url),this.$image.changeImage(t[s]),this.app.broadcast("image.changed",this.$image,t),this.app.broadcast("image.uploaded",this.$image,t),this.app.broadcast("hardsync");break}e!==!1&&i.on("load",(function(){this.$previewBox.html(i)}).bind(this))}},_uploadError:function(t){this.app.broadcast("image.uploadError",t)},_remove:function(t){this.app.api("module.modal.close"),this.component.remove(t)},_observeImages:function(){var t=this.editor.getElement(),e=this;t.find("img").each(function(i){var s=r.dom(i);s.off(".drop-to-replace"),s.on("dragover.drop-to-replace dragenter.drop-to-replace",function(n){n.preventDefault()}),s.on("drop.drop-to-replace",function(n){if(!e.app.isDragComponentInside())return e._setReplaceUpload(n,s)})})},_setFormData:function(t,e){this._buildPreview(t),this._buildPreviewUpload();var i=this.$image.getData(),s={title:i.title};this.opts.imageCaption?s.caption=i.caption:t.find(".form-item-caption").hide(),this.opts.imagePosition?s.align=i.align:t.find(".form-item-align").hide(),this.opts.imageLink?i.link&&(s.url=i.link.url,i.link.target&&(s.target=!0)):t.find(".form-item-link").hide(),e.setData(s)},_setFormFocus:function(t){t.getField("title").focus()},_setReplaceUpload:function(t,e){if((t=t.originalEvent||t).stopPropagation(),t.preventDefault(),this.opts.imageUpload){this.$image=this.component.create("image",e);var i={url:this.opts.imageUpload,files:t.dataTransfer.files,name:"imagereplace",data:this.opts.imageData,paramName:this.opts.imageUploadParam};this.app.api("module.upload.send",i)}},_setUpload:function(t,e){this.opts.imageUpload||t.getBody().find(".redactor-modal-tab-upload").remove();var i={url:this.opts.imageUpload,element:e.getField("file"),name:"image",data:this.opts.imageData,paramName:this.opts.imageUploadParam};this.app.api("module.upload.build",i)},_buildPreview:function(t){this.$preview=t.find("#redactor-modal-image-preview");var e=this.$image.getData(),i=r.dom("<img>");i.attr("src",e.src),this.$previewBox=r.dom("<div>"),this.$previewBox.append(i),this.$preview.html(""),this.$preview.append(this.$previewBox)},_buildPreviewUpload:function(){if(this.opts.imageUpload){var t=r.dom('<div class="desc">');t.html(this.lang.get("upload-change-label")),this.$preview.append(t);var e={url:this.opts.imageUpload,element:this.$previewBox,name:"imageedit",data:this.opts.imageData,paramName:this.opts.imageUploadParam};this.app.api("module.upload.build",e)}}}),r.add("class","image.component",{mixins:["dom","component"],init:function(t,e){return this.app=t,this.opts=t.opts,this.selection=t.selection,e&&e.cmnt!==void 0?e:this._init(e)},setData:function(t){for(var e in t)this._set(e,t[e])},getData:function(){for(var t=["src","title","caption","align","link","id"],e={},i=0;i<t.length;i++)e[t[i]]=this._get(t[i]);return e},getElement:function(){return this.$element},changeImage:function(t){this.$element.attr("src",t.url)},_init:function(t){var e=r.dom(t),i=e.closest("figure");t===void 0?(this.$element=r.dom("<img>"),this.parse("<figure>"),this.append(this.$element)):i.length===0?(this.parse("<figure>"),this.$element=e,this.$element.wrap(this)):(this.parse(i),this.$element=this.find("img")),this._initWrapper()},_set:function(t,e){this["_set_"+t](e)},_get:function(t){return this["_get_"+t]()},_set_src:function(t){this.$element.attr("src",t)},_set_id:function(t){this.opts.imageObserve&&this.$element.attr("data-image",t)},_set_title:function(t){(t=t.trim().replace(/(<([^>]+)>)/gi,""))===""?this.$element.removeAttr("alt"):this.$element.attr("alt",t)},_set_caption:function(t){var e=this.find("figcaption");return e.length===0&&((e=r.dom("<figcaption>")).attr("contenteditable","true"),this.append(e)),t===""?e.remove():e.html(t),e},_set_align:function(t){var e="",i="",s="",n=this,o=this.find("img"),a=this.find("figcaption");if(typeof this.opts.imagePosition=="object"){var l=this.opts.imagePosition;for(var h in l)n.removeClass(l[h]);var c=l[t]!==void 0&&l[t];c&&n.addClass(c)}else{var d=o.width();switch(t){case"left":e="left",i=this.opts.imageFloatMargin;break;case"right":e="right",i=this.opts.imageFloatMargin;break;case"center":s="center",i="auto"}n.css({float:e,width:d+"px",maxWidth:d+"px","margin-left":i,"margin-right":i,"text-align":s}),n.attr("rel",n.attr("style")),t==="none"&&(n.css("max-width",""),n.css("width","")),t==="center"?(n.css("max-width",""),n.css("width",""),a.css("text-align","center")):a.css("text-align","")}},_set_link:function(t){var e=this._findLink();if(t.url!=="")return e||(e=r.dom("<a>"),this.$element.wrap(e)),e.attr("href",t.url),t.target?e.attr("target",t.target===!0?"_blank":t.target):e.removeAttr("target"),e;e&&e.unwrap()},_get_src:function(){return this.$element.attr("src")},_get_id:function(){return this.$element.attr("data-image")},_get_title:function(){var t=this.$element.attr("alt");return t||""},_get_caption:function(){var t=this.find("figcaption");return t.length===0?"":t.html()},_get_align:function(){var t="";if(typeof this.opts.imagePosition=="object"){t="none";var e=this.opts.imagePosition;for(var i in e)if(this.hasClass(e[i])){t=i;break}}else t=this.css("text-align")==="center"?"center":this.css("float");return t},_get_link:function(){var t=this._findLink();if(t){var e=!!t.attr("target");return{url:t.attr("href"),target:e}}},_initWrapper:function(){this.addClass("redactor-component"),this.attr({"data-redactor-type":"image",tabindex:"-1",contenteditable:!1})},_findLink:function(){var t=this.find("a").filter(function(e){return r.dom(e).closest("figcaption").length===0});return t.length!==0&&t}}),r.add("class","image.resize",{init:function(t){this.app=t,this.$doc=t.$doc,this.$win=t.$win,this.$body=t.$body,this.editor=t.editor,this.toolbar=t.toolbar,this.inspector=t.inspector,this.$target=this.toolbar.isTarget()?this.toolbar.getTargetElement():this.$body,this._init()},rebuild:function(){this._setResizerPosition()},hide:function(){this.$target.find("#redactor-image-resizer").remove()},stop:function(){this.editor.getElement().off(".redactor.image-resize"),this.$doc.off(".redactor.image-resize"),this.$win.off("resize.redactor.image-resize"),this.hide()},_init:function(){this.editor.getElement().on("click.redactor.image-resize",this._build.bind(this)),this.$win.on("resize.redactor.image-resize",this._setResizerPosition.bind(this))},_build:function(t){if(this.$target.find("#redactor-image-resizer").remove(),!this.app.isReadOnly()){var e=this.inspector.parse(t.target),i=this.editor.getElement();e.isComponentType("image")&&(this.$resizableBox=i,this.$resizableImage=r.dom(e.getImageElement()),this.$resizer=r.dom("<span>"),this.$resizer.attr("id","redactor-image-resizer"),this.$target.append(this.$resizer),this._setResizerPosition(),this.$resizer.on("mousedown touchstart",this._set.bind(this)))}},_setResizerPosition:function(){if(this.$resizer){var t=this.toolbar.isTarget(),e=this.$target.offset(),i=t?7-e.top+this.$target.scrollTop():7,s=t?7-e.left:7,n=this.$resizableImage.offset(),o=this.$resizableImage.width(),a=this.$resizableImage.height(),l=this.$resizer.width(),h=this.$resizer.height();this.$resizer.css({top:Math.round(n.top+a-h+i)+"px",left:Math.round(n.left+o-l+s)+"px"})}},_set:function(t){t.preventDefault(),this.resizeHandle={x:t.pageX,y:t.pageY,el:this.$resizableImage,$figure:this.$resizableImage.closest("figure"),ratio:this.$resizableImage.width()/this.$resizableImage.height(),h:this.$resizableImage.height()},(t=t.originalEvent||t).targetTouches&&(this.resizeHandle.x=t.targetTouches[0].pageX,this.resizeHandle.y=t.targetTouches[0].pageY),this.app.broadcast("contextbar.close"),this.app.broadcast("image.resize",this.$resizableImage),this._start()},_start:function(){this.$doc.on("mousemove.redactor.image-resize touchmove.redactor.image-resize",this._move.bind(this)),this.$doc.on("mouseup.redactor.image-resize touchend.redactor.image-resize",this._stop.bind(this))},_stop:function(){this.$doc.off(".redactor.image-resize"),this.app.broadcast("image.resized",this.$resizableImage)},_move:function(t){t.preventDefault(),t=t.originalEvent||t;var e=this.resizeHandle.h;t.targetTouches?e+=t.targetTouches[0].pageY-this.resizeHandle.y:e+=t.pageY-this.resizeHandle.y;var i=e*this.resizeHandle.ratio;i=Math.round(i),(e=Math.round(e))<20||i<100||this._getResizableBoxWidth()<=i||(this.resizeHandle.$figure.length!==0&&this.resizeHandle.$figure.css("max-width")!==""&&this.resizeHandle.$figure.css({width:i+"px","max-width":i+"px"}),this.resizeHandle.el.attr({width:i,height:e}),this.resizeHandle.el.width(i),this.resizeHandle.el.css("max-width",i+"px"),this.resizeHandle.el.height(e),this._setResizerPosition())},_getResizableBoxWidth:function(){return this.$resizableBox.width()-parseInt(this.$resizableBox.css("padding-left"))-parseInt(this.$resizableBox.css("padding-right"))}}),r.add("module","file",{modals:{file:'<div class="redactor-modal-tab" data-title="## upload ##"><form action="">                 <div class="form-item form-item-title">                     <label for="modal-file-title"> ## filename ## <span class="desc">(## optional ##)</span></label>                     <input type="text" id="modal-file-title" name="title" />                 </div>                 <input type="file" name="file">             </form></div>'},init:function(t){this.app=t,this.opts=t.opts,this.lang=t.lang,this.caret=t.caret,this.utils=t.utils,this.storage=t.storage,this.component=t.component,this.inspector=t.inspector,this.insertion=t.insertion,this.selection=t.selection},onstarted:function(){this.storage.observeFiles()},ondropfile:function(t,e,i){if(this.opts.fileUpload){var s={url:this.opts.fileUpload,event:!i&&t,files:e,name:"filedrop",data:this.opts.fileData};this.app.api("module.upload.send",s)}},onmodal:{file:{open:function(t,e){this._setFormData(t,e),this._setUpload(e)},opened:function(t,e){this._setFormFocus(e),this.$form=e}}},onupload:{file:{complete:function(t){this._insert(t)},error:function(t){this._uploadError(t)}},filedrop:{complete:function(t,e){this._insert(t,e)},error:function(t){this._uploadError(t)}}},open:function(){this._open()},insert:function(t){this._insert(t)},remove:function(t){this._remove(t)},_open:function(){this.app.api("module.modal.build",this._getModalData())},_getModalData:function(){return{name:"file",title:this.lang.get("file")}},_insert:function(t,e){if(this.app.api("module.modal.close"),typeof t=="object"){if(Array.isArray(t)){for(var i={},s=0;s<t.length;s++)i=r.extend(i,t[s]);t=i}1<Object.keys(t).length?this._insertMultiple(t,e):this._insertSingle(t,e),this.$form=!1}},_insertSingle:function(t,e){var i=[];for(var s in t){var n=this._createFileAndStore(t[s]);i=this.opts.fileAttachment?this._insertAsAttachment(n):e?this.insertion.insertToPoint(e,n):this.insertion.insertRaw(n),this.app.broadcast("file.uploaded",i[0],t)}},_insertMultiple:function(t,e){var i,s=0,n=[];for(var o in t){s++;var a=this._createFileAndStore(t[o]);this.opts.fileAttachment?n=this._insertAsAttachment(a,t):s===1?n=e?this.insertion.insertToPoint(e,a):this.insertion.insertRaw(a):(r.dom(n[0]).after(a).after(" "),n=[a.get()],this.app.broadcast("file.inserted",a)),i=a,this.app.broadcast("file.uploaded",n[0],t)}this.opts.fileAttachment||this.caret.setAfter(i)},_insertAsAttachment:function(t,e){var i=r.dom(this.opts.fileAttachment),s=t.wrapAttachment();i.append(s);var n=[s.get()];return this.app.broadcast("file.appended",n[0],e),n},_createFileAndStore:function(t){var e=!!this.$form&&this.$form.getData(),i=t.name?t.name:t.url,s=!this.opts.fileAttachment&&e&&e.title!==""?e.title:this._truncateUrl(i),n=this.component.create("file");return n.attr("href",t.url),n.attr("data-file",t.id?t.id:this.utils.getRandomId()),n.attr("data-name",t.name),n.html(s),this.storage.add("file",n),n},_remove:function(t){this.selection.save();var e=this.component.create("file",t);this.app.broadcast("file.delete",e)!==!1?(e.unwrap(),this.selection.restore(),this.app.broadcast("file.deleted",e)):this.selection.restore()},_truncateUrl:function(t){return t.search(/^http/)!==-1&&20<t.length?t.substring(0,20)+"...":t},_setUpload:function(t){var e={url:this.opts.fileUpload,element:t.getField("file"),name:"file",data:this.opts.fileData,paramName:this.opts.fileUploadParam};this.app.api("module.upload.build",e)},_setFormData:function(t,e){this.opts.fileAttachment?t.find(".form-item-title").hide():e.setData({title:this.selection.getText()})},_setFormFocus:function(t){t.getField("title").focus()},_uploadError:function(t){this.app.broadcast("file.uploadError",t)}}),r.add("class","file.component",{mixins:["dom","component"],init:function(t,e){return this.app=t,this.opts=t.opts,e&&e.cmnt!==void 0?e:this._init(e)},wrapAttachment:function(){return this.$wrapper=r.dom('<span class="redactor-file-item">'),this.$remover=r.dom('<span class="redactor-file-remover">'),this.$remover.html("&times;"),this.$remover.on("click",this.removeAttachment.bind(this)),this.$wrapper.append(this),this.$wrapper.append(this.$remover),this.$wrapper},removeAttachment:function(t){t.preventDefault(),this.app.broadcast("file.delete",this,this.$wrapper)!==!1&&(this.$wrapper.remove(),this.app.broadcast("file.deleted",this),this.app.broadcast("file.removeAttachment",this))},_init:function(t){if(t===void 0)this.parse("<a>");else{var e=r.dom(t).closest("a");this.parse(e)}}}),r.add("module","buffer",{init:function(t){this.app=t,this.opts=t.opts,this.editor=t.editor,this.offset=t.offset,this.keycodes=t.keycodes,this.selection=t.selection,this.state=!1,this.passed=!1,this.keyPressed=!1,this.undoStorage=[],this.redoStorage=[]},onkeydown:function(t){this._listen(t)},onsyncing:function(){this.keyPressed||this.trigger(),this.keyPressed=!1},onbuffer:{trigger:function(){this.trigger()}},onstate:function(t,e,i){t&&(t.ctrlKey||t.metaKey)||t&&(this._isUndo(t)||this._isRedo(t))||(this.passed=!1,this._saveState(e,i),t===!1&&this._setUndo())},onenable:function(){this.clear()},clear:function(){this.state=!1,this.undoStorage=[],this.redoStorage=[]},undo:function(){this._getUndo()},redo:function(){this._getRedo()},trigger:function(){this.state&&this.passed===!1&&this._setUndo()},_saveState:function(t,e){var i=this.editor.getElement();this.state={html:t||i.html(),offset:e||this.offset.get()}},_listen:function(t){var e=t.which,i=t.ctrlKey||t.metaKey,s=i||t.shiftKey||t.altKey,n=[this.keycodes.SPACE,this.keycodes.ENTER,this.keycodes.BACKSPACE,this.keycodes.DELETE,this.keycodes.TAB,this.keycodes.LEFT,this.keycodes.RIGHT,this.keycodes.UP,this.keycodes.DOWN];return this._isUndo(t)?(t.preventDefault(),void this.undo()):this._isRedo(t)?(t.preventDefault(),void this.redo()):((i||n.indexOf(e)===-1)&&(!i||e!==88&&e!==67)||(s=!0,this.trigger()),s||this._hasUndo()||this.trigger(),void(this.keyPressed=!0))},_isUndo:function(t){var e=t.which;return(t.ctrlKey||t.metaKey)&&e===90&&!t.shiftKey&&!t.altKey},_isRedo:function(t){var e=t.which;return(t.ctrlKey||t.metaKey)&&(e===90&&t.shiftKey||e===89&&!t.shiftKey)&&!t.altKey},_setUndo:function(){var t=this.undoStorage[this.undoStorage.length-1];t!==void 0&&t[0]===this.state.html||(this.undoStorage.push([this.state.html,this.state.offset]),this._removeOverStorage())},_setRedo:function(){var t=this.editor.getElement(),e=this.offset.get(),i=t.html();this.redoStorage.push([i,e]),this.redoStorage=this.redoStorage.slice(0,this.opts.bufferLimit)},_getUndo:function(){if(this._hasUndo()){this.passed=!0;var t=this.editor.getElement(),e=this.undoStorage.pop();this._setRedo(),t.html(e[0]),this.offset.set(e[1]),this._saveState(e[0],e[1]),this.selection.restore(),this.app.broadcast("undo",e[0],e[1])}},_getRedo:function(){if(this._hasRedo()){this.passed=!0;var t=this.editor.getElement(),e=this.redoStorage.pop();this._setUndo(),t.html(e[0]),this.offset.set(e[1]),this._saveState(e[0],e[1]),this.app.broadcast("redo",e[0],e[1])}},_removeOverStorage:function(){this.undoStorage.length>this.opts.bufferLimit&&(this.undoStorage=this.undoStorage.slice(0,this.undoStorage.length-this.opts.bufferLimit))},_hasUndo:function(){return this.undoStorage.length!==0},_hasRedo:function(){return this.redoStorage.length!==0}}),r.add("module","list",{init:function(t){this.app=t,this.uuid=t.uuid,this.opts=t.opts,this.utils=t.utils,this.block=t.block,this.editor=t.editor,this.toolbar=t.toolbar,this.inspector=t.inspector,this.selection=t.selection},onbutton:{list:{observe:function(t){this._observeButton(t)}}},ondropdown:{list:{observe:function(t){this._observeDropdown(t)}}},toggle:function(t){var e=this._getBlocks(),i=this.selection.getBlock(),s=r.dom(i).parents("ul, ol",this.editor.getElement()).last();return e.length===0&&s.length!==0&&(e=[s.get()]),!i||i.tagName!=="TD"&&i.tagName!=="TH"||(e=this.block.format("div")),this.selection.saveMarkers(),e=e.length!==0&&this._isUnformat(t,e)?this._unformat(t,e):this._format(t,e),this.selection.restoreMarkers(),e},indent:function(){var t=this.selection.isCollapsed(),e=this.selection.getCurrent(),i=this.inspector.parse(e),s=!!i.isList()&&i.getListItem(),n=r.dom(s),o=n.prevElement(),a=o.get();if(t&&s&&a&&a.tagName==="LI"){this.selection.saveMarkers();var l=(o=r.dom(a)).children("ul, ol"),h=n.closest("ul, ol");if(l.length!==0)l.append(n);else{var c=h.get().tagName.toLowerCase(),d=r.dom("<"+c+">");d.append(n),o.append(d)}this.selection.restoreMarkers(),this.utils.isEmptyHtml(n.html())&&this.app.caret.setStart(n)}},outdent:function(){var t=this.selection.isCollapsed(),e=this.selection.getCurrent(),i=this.inspector.parse(e),s=!!i.isList()&&i.getListItem(),n=r.dom(s);if(t&&s){var o,a,l,h=n.parent(),c=h.closest("li",".redactor-in-"+this.uuid),d=n.prevElement(),u=n.nextElement(),p=d.get(),f=u.get(),v=p===!1,g=p!==!1&&f!==!1,b=!v&&f===!1;if(this.selection.saveMarkers(),c.length!==0)if(g){o=this._getAllNext(n.get()),l=r.dom("<"+h.get().tagName.toLowerCase()+">");for(var T=0;T<o.length;T++)l.append(o[T]);c.after(n),n.append(l)}else c.after(n),h.children().length===0?h.remove():v&&n.append(h);else{var w=this._createUnformatContainer(n),I=w.find("ul, ol").first();if(v)h.before(w);else if(b)h.after(w);else if(g){for(l=r.dom("<"+h.get().tagName.toLowerCase()+">"),o=this._getAllNext(n.get()),T=0;T<o.length;T++)l.append(o[T]);h.after(w),w.after(l)}I.length!==0&&((a=w.nextElement().get())&&a.tagName===h.get().tagName?(r.dom(a).prepend(I),I.unwrap()):w.after(I)),n.remove()}this.selection.restoreMarkers()}},_getAllNext:function(t){for(var e=[];t;){if(!(t=r.dom(t).nextElement().get()))return e;e.push(t)}return e},_isUnformat:function(t,e){for(var i=0,s=0;s<e.length;s++)if(e[s].nodeType!==3){var n=e[s].tagName.toLowerCase();n!==t&&n!=="figure"||i++}return i===e.length},_format:function(t,e){var i=this._uniteBlocks(e,["p","div","blockquote","pre","h1","h2","h3","h4","h5","h6","ul","ol"]),s=[];for(var n in i){for(var o=i[n],a=this._createList(t,i[n]),l=0;l<o.length;l++){var h;if(o[l].nodeType===3||o[l].tagName!=="UL"&&o[l].tagName!=="OL"){var c=(h=this._createListItem(o[l])).get().lastChild;c&&c.tagName==="BR"&&r.dom(c).remove(),this.utils.normalizeTextNodes(h),a.append(h)}else{var d=r.dom(o[l]);h=d.contents(),a.append(h),this.utils.isEmpty(d)&&d.remove()}}s.push(a.get())}return s},_uniteBlocks:function(t,e){for(var i=0,s={0:[]},n=!1,o=0;o<t.length;o++){var a=r.dom(t[o]).closest("th, td");a.length!==0?(a.get()!==n&&(s[++i]=[]),this._isUniteBlock(t[o],e)&&s[i].push(t[o])):this._isUniteBlock(t[o],e)?s[i].push(t[o]):s[++i]=[],n=a.get()}return s},_isUniteBlock:function(t,e){return t.nodeType===3||e.indexOf(t.tagName.toLowerCase())!==-1},_createList:function(t,e){var i=e[e.length-1],s=r.dom(i),n=r.dom("<"+t+">");return s.after(n),n},_createListItem:function(t){var e=r.dom("<li>");if(t.nodeType===3)e.append(t);else{var i=r.dom(t);e.append(i.contents()),i.remove()}return e},_unformat:function(t,e){if(e.length===1){var i=r.dom(e[0]),s=i.find("li"),n=this.selection.getNodes({tags:["li"]}),o=this.selection.getBlock(),a=r.dom(o).closest("li");if(n.length===0&&a.length!==0&&(n=[a.get()]),n.length===s.length)return this._unformatEntire(e[0]);var l=this._getItemsPosition(s,n);if(l==="Top")return this._unformatAtSide("before",n,i);if(l==="Bottom")return n.reverse(),this._unformatAtSide("after",n,i);if(l==="Middle"){var h=r.dom(n[n.length-1]),c=!1,d=!1,u=r.dom("<"+i.get().tagName.toLowerCase()+">");s.each(function(g){if(c){var b=r.dom(g);b.closest(".redactor-split-item").length!==0||d!==!1&&b.closest(d).length!==0||b.addClass("redactor-split-item"),d=b}g===h.get()&&(c=!0)}),s.filter(".redactor-split-item").each(function(g){r.dom(g).removeClass("redactor-split-item"),u.append(g)}),i.after(u),n.reverse();for(var p=0;p<n.length;p++){var f=r.dom(n[p]),v=this._createUnformatContainer(f);i.after(v),v.find("ul, ol").remove(),f.remove()}return}}else for(p=0;p<e.length;p++)e[p].nodeType!==3&&e[p].tagName.toLowerCase()===t&&this._unformatEntire(e[p])},_unformatEntire:function(t){var e=r.dom(t);e.find("li").each((function(i){var s=r.dom(i),n=this._createUnformatContainer(s);s.remove(),e.before(n)}).bind(this)),e.remove()},_unformatAtSide:function(t,e,i){for(var s=0;s<e.length;s++){var n=r.dom(e[s]),o=this._createUnformatContainer(n);i[t](o);var a=o.find("ul, ol").first();n.append(a),a.each(function(l){var h=r.dom(l),c=h.closest("li");c.get()===e[s]&&(h.unwrap(),c.addClass("r-unwrapped"))}),this.utils.isEmptyHtml(n.html())&&n.remove()}i.find(".r-unwrapped").each(function(l){var h=r.dom(l);h.html().trim()===""?h.remove():h.removeClass("r-unwrapped")})},_getItemsPosition:function(t,e){var i="Middle",s=e[0],n=e[e.length-1],o=t.first().get(),a=t.last().get();return o===s&&a!==n?i="Top":o!==s&&a===n&&(i="Bottom"),i},_createUnformatContainer:function(t){var e=r.dom("<"+this.opts.markup+">");return this.opts.breakline&&e.attr("data-redactor-tag","br"),e.append(t.contents()),e},_getBlocks:function(){return this.selection.getBlocks({first:!0})},_observeButton:function(){var t=this.selection.getCurrent(),e=this.inspector.parse(t),i=e.isPre()||e.isCode()||e.isFigcaption();this._observeButtonsList(i,["lists","ul","ol","outdent","indent"]);var s=this.toolbar.getButton("outdent"),n=this.toolbar.getButton("indent");this._observeIndent(n,s)},_observeDropdown:function(t){var e=t.getItem("outdent"),i=t.getItem("indent");this._observeIndent(i,e)},_observeIndent:function(t,e){var i=this.selection.isCollapsed(),s=this.selection.getCurrent(),n=this.inspector.parse(s),o=!!n.isList()&&n.getListItem(),a=r.dom(o).prevElement().get(),l=i&&o&&a&&a.tagName==="LI";e&&(o&&i?e.enable():e.disable()),t&&(o&&l?t.enable():t.disable())},_observeButtonsList:function(t,e){for(var i=0;i<e.length;i++){var s=this.toolbar.getButton(e[i]);s&&(t?s.disable():s.enable())}}}),r.add("class","video.component",{mixins:["dom","component"],init:function(t,e){return this.app=t,e&&e.cmnt!==void 0?e:this._init(e)},_init:function(t){if(t!==void 0){var e=r.dom(t).closest("figure");e.length!==0?this.parse(e):(this.parse("<figure>"),this.append(t))}else this.parse("<figure>");this._initWrapper()},_initWrapper:function(){this.addClass("redactor-component"),this.attr({"data-redactor-type":"video",tabindex:"-1",contenteditable:!1})}}),r.add("class","widget.component",{mixins:["dom","component"],init:function(t,e){return this.app=t,e&&e.cmnt!==void 0?e:this._init(e)},getData:function(){return{html:this._getHtml()}},_init:function(t){if(t!==void 0){var e=r.dom(t).closest("figure");e.length!==0?this.parse(e):(this.parse("<figure>"),this.html(t))}else this.parse("<figure>");this._initWrapper()},_getHtml:function(){var t=r.dom("<div>");return t.html(this.html()),t.find(".redactor-component-caret").remove(),t.html()},_initWrapper:function(){this.addClass("redactor-component"),this.attr({"data-redactor-type":"widget",tabindex:"-1",contenteditable:!1})}});var D=r;window.Redactor=window.$R=r,window.addEventListener("load",function(){r("[data-redactor]")}),typeof module=="object"&&module.exports&&(module.exports=D,module.exports.Redactor=D)})();const H=["name","placeholder","value"],R={__name:"RichTextRedactor",props:{modelValue:{default:"",type:String},placeholder:{type:String,default:null},name:{type:String,default:null},config:{default:{callbacks:{}},type:Object}},emits:["update:modelValue"],setup(x,{emit:E}){const m=window.Redactor,_=C.ref(!1),F=E,k=x;return C.onMounted(()=>{k.config.callbacks={changed:function(y){return F("update:modelValue",y),y}},_.value=m(_.value,k.config)}),C.onUnmounted(()=>{m(_.value,"destroy"),_.value=null}),C.watch(k.modelValue,(y,r)=>{var S,A,N;(S=_.value)!=null&&S.editor.isFocus()||(A=_.value)!=null&&A.editor.isSourceMode()||(N=_.value)==null||N.source.setCode(y)}),(y,r)=>(C.openBlock(),C.createElementBlock("textarea",{ref_key:"redactor",ref:_,name:x.name,placeholder:x.placeholder,value:x.modelValue},null,8,H))}};window.__goplaidVueComponentRegisters=window.__goplaidVueComponentRegisters||[],window.__goplaidVueComponentRegisters.push((x,E)=>{x.component("redactor",R)})});
